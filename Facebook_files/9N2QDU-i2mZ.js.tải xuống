;/*FB_PKG_DELIM*/

__d("EBAPIQPLPoints",["QPLUserFlow"],(function(a,b,c,d,e,f,g){"use strict";e={CREATE_WORKER_NETWORK_EXECUTE_END:"create_worker_network_execute_end",CREATE_WORKER_NETWORK_EXECUTE_START:"create_worker_network_execute_start",GRAPHQL_QUERY_END:"graphql_query_end",GRAPHQL_QUERY_START:"graphql_query_start"};f={CLIENT_STATE_RETRIEVED:"client_state_retrieved",EB_NOT_ENABLED:"eb_not_enabled",EBLS_NOT_INITIALIZED:"ebls_not_initialized",EMPTY_DECRYPTION_RESPONSE:"empty_decryption_response",INVALID_CLIENT_STATE:"invalid_client_state",INVALID_GRAPHQL_RESPONSE:"invalid_graphql_response",INVALID_PARAMETERS:"invalid_parameters",LSDB_SINGLETON_RETRIEVED:"lsdb_singleton_retrieved",NO_CLIENT_STATE:"no_client_state",RUNTIME_ERROR:"runtime_error",UNSUPPORTED_CONTEXT:"unsupported_context"};var h=babelHelpers["extends"]({},e),i=babelHelpers["extends"]({},e,f,{BACKUP_ID_NULL:"backup_id_null",BATCH_RESTORE_AND_DECRYPT_FAILURE:"batch_restore_and_decrypt_failure",DECRYPT_MESSAGES_ECHO_AND_PROTOBUF_END:"decrypt_messages_echo_and_protobuf_end",DECRYPT_MESSAGES_ECHO_AND_PROTOBUF_START:"decrypt_messages_echo_and_protobuf_start",DECRYPT_MESSAGES_ECHO_END:"decrypt_messages_echo_end",DECRYPT_MESSAGES_ECHO_START:"decrypt_messages_echo_start",DECRYPT_MESSAGES_PROTOBUF_END:"decrypt_messages_protobuf_end",DECRYPT_MESSAGES_PROTOBUF_START:"decrypt_messages_protobuf_start",DECRYPTED_PROTOBUFS_NULL:"decrypted_protobufs_null",DELETE_MAILBOX:"delete_mailbox",DERIVE_AND_STORE_EPOCHS_END:"derive_and_store_epochs_end",DERIVE_AND_STORE_EPOCHS_START:"derive_and_store_epochs_start",ECHO_DECODE_END:"echo_decode_end",ECHO_DECODE_START:"echo_decode_start",ECHO_DECRYPTION_FAILURE:"echo_decryption_failure",ECHO_TO_PROTOBUF_CONVERSION_END:"echo_to_protobuf_conversion_end",ECHO_TO_PROTOBUF_CONVERSION_FAILURE:"echo_to_protobuf_conversion_failure",ECHO_TO_PROTOBUF_CONVERSION_START:"echo_to_protobuf_conversion_start",GRAPHQL_QUERY_EXCEPTION:"graphql_query_exception",MISSING_RANGE_INFO:"missing_range_info",NO_MESSAGES_TO_RESTORE:"no_messages_to_restore",NULL_MESSAGES:"null_messages",PROCESS_AND_DECRYPT_MESSAGES_END:"process_and_decrypt_messages_end",PROCESS_AND_DECRYPT_MESSAGES_FAILURE:"process_and_decrypt_messages_failure",PROCESS_AND_DECRYPT_MESSAGES_START:"process_and_decrypt_messages_start",PROTOBUF_DECRYPTION_FAILURE:"protobuf_decryption_failure",RESTORING_MIXED_ECHO_PROTOBUF_PAYLOAD:"restoring_mixed_echo_protobuf_payload",SERVER_SIDE_EXCEPTION:"server_side_exception",THREAD_NOT_FOUND_ON_SERVER:"thread_not_found_on_server"}),j={ADDED_ATTACHMENT_CONTEXT:"added_attachment_context",ADDED_ATTACHMENT_CONTEXT_LEGACY:"added_attachment_context_legacy",DEQUEUE:"added_to_queue_end",ENQUEUE:"added_to_queue_start",GENERATE_BACKUP_DIRECTIVE_END:"generate_backup_directive_end",GENERATE_BACKUP_DIRECTIVE_START:"generate_backup_directive_start",GENERATE_REPORTING_META_END:"generate_reporting_meta_end",GENERATE_REPORTING_META_START:"generate_reporting_meta_start",GET_ATTACHMENT_CONTEXT_END:"get_attachment_context_end",GET_ATTACHMENT_CONTEXT_START:"get_attachment_context_start",MESSAGE_RESULT_FAILURE_OR_NULL:"message_result_failure_or_null",NO_INCOMING_MESSAGES:"no_incoming_messages",NO_PROCESSED_MESSAGES:"no_processed_messages",PROCESSED_MESSAGES:"processed_messages",RUNTIME_ERROR:"runtime_error",SUCCESSFULLY_PROCESSED_MESSAGE:"successfully_processed_message",UKNOWN_MESSAGE_VERSION_OR_PROTOCOL:"unknown_message_version_or_protocol",UNABLE_TO_CREATE_BACKUP_DIRECTIVE:"unable_to_create_backup_directive",UNKNOWN_MESSAGE_TYPE:"unknown_message_type",UNSUPPORTED_MESSAGE_TYPE:"unsupported_message_type",UPLOAD_DELETED_MESSAGE:"upload_deleted_message",UPLOAD_PAYLOAD_CREATED:"upload_payload_creation_success",UPLOAD_PAYLOAD_CREATION_FAILURE:"upload_payload_creation_failure",UPLOAD_PAYLOAD_CREATION_START:"upload_payload_creation_start"},k={ADD_DEVICE_CHECK_CLIENT_STATE_AUTHORITATIVE:"add_device_check_client_state_authoritative",ADD_DEVICE_CHECK_RC_STATUS:"add_device_check_rc_status",ADD_DEVICE_COULD_NOT_FIND_BACKUP:"add_device_could_not_find_backup",ADD_DEVICE_FAILED_DEVICE_REGISTRATION_ID_NULL:"add_device_failed_device_registration_id_null",ADD_DEVICE_FAILED_TO_GET_RC_STATUS:"add_device_failed_to_get_rc_status",ADD_DEVICE_FAILURE_BACKUP_NOT_FOUND:"add_device_failure_backup_not_found",ADD_DEVICE_OPTIMISTIC_STATUS:"add_device_optimistic_status",ADD_DEVICE_RUNTIME_ERROR:"add_device_runtime_error",ADD_DEVICE_SPROC_END:"add_device_sproc_end",ADD_DEVICE_SPROC_FAILURE:"add_device_sproc_failure",ADD_DEVICE_SPROC_START:"add_device_sproc_start",ADD_DEVICE_TASK_END:"add_device_task_end",ADD_DEVICE_TASK_START:"add_device_task_start",ADD_DEVICE_TIMEOUT:"add_device_timeout",INVALID_RECOVERY_CODE:"invalid_recovery_code",ON_START_BEGIN:"on_start_start",ON_START_SUCCESS:"on_start_end"},l={ADD_DEVICE_FETCH_VD_GRAPHQL_END:"add_device_fetch_vd_graphql_end",ADD_DEVICE_FETCH_VD_GRAPHQL_FAIL:"add_device_fetch_vd_graphql_fail",ADD_DEVICE_FETCH_VD_GRAPHQL_START:"add_device_fetch_vd_graphql_start",ADD_DEVICE_GQL_END:"add_device_gql_end",ADD_DEVICE_GQL_FAIL:"add_device_gql_fail",ADD_DEVICE_GQL_START:"add_device_gql_start",ADD_DEVICE_MISSING_GRAPHQL_FIELDS:"add_device_missing_graphql_fields",ADD_DEVICE_PARSE_RECOVERY_CODE_END:"add_device_parse_recovery_code_end",ADD_DEVICE_PARSE_RECOVERY_CODE_FAIL:"add_device_parse_recovery_code_fail",ADD_DEVICE_PARSE_RECOVERY_CODE_START:"add_device_parse_recovery_code_start",ADD_DEVICE_VIRTUAL_DEVICE_KEY_SPROC_END:"add_device_vd_key_sproc_end",ADD_DEVICE_VIRTUAL_DEVICE_KEY_SPROC_FAIL:"add_device_vd_key_sproc_fail",ADD_DEVICE_VIRTUAL_DEVICE_KEY_SPROC_START:"add_device_vd_key_sproc_start"},m={FETCH_BACKUP_IDS_END:"fetch_backup_ids_end",FETCH_BACKUP_IDS_START:"fetch_backup_ids_start",INITIALIZE_BACKUP_END:"initialize_backup_end",INITIALIZE_BACKUP_SPROC_END:"initialize_backup_sproc_end",INITIALIZE_BACKUP_SPROC_FAIL:"initialize_backup_sproc_fail",INITIALIZE_BACKUP_SPROC_START:"initialize_backup_sproc_start",INITIALIZE_BACKUP_START:"initialize_backup_start",OPTIMISTIC_CLIENT_STATE:"optimistic_client_state"};function a(a,b,d,e,f){c("QPLUserFlow").addPoint(b,d,{data:babelHelpers["extends"]({},e,{bool:{runningInWorker:a}}),instanceKey:f})}function b(a,b,d,e,f){c("QPLUserFlow").endFailure(b,d,{annotations:babelHelpers["extends"]({},f,{bool:{runningInWorker:a}}),instanceKey:e})}function d(a,b,d,e){c("QPLUserFlow").endSuccess(b,{annotations:babelHelpers["extends"]({},e,{bool:{runningInWorker:a}}),instanceKey:d})}g.EBAPIQPLCommonPoints=e;g.EBAPIQPLCommonErrorPoints=f;g.EBMessageMetadataQPLPoints=h;g.EBMessageRestoreQueryQPLPoints=i;g.EBUploadQueueQPLPoints=j;g.EBAddDeviceQPLPoints=k;g.EBAddDeviceGraphqlQPLPoints=l;g.EBBackupInitQPLPoints=m;g.ebAPIAddQPLPoint=a;g.ebAPIEndFailure=b;g.ebAPIEndSuccess=d}),98);
__d("LSDeleteAndReenrollDeviceStateStoredProcedure",["LSDeleteAndReenrollDeviceState","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSDeleteAndReenrollDeviceState"),e.targetDeviceId,e.reenrollmentReason);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSMEBDeviceReenrollmentReason",[],(function(a,b,c,d,e,f){a=Object.freeze({UNIT_TEST:1,UPLOAD_FAILED_WITH_NO_DEVICE_FOUND:2,LOCAL_DEVICE_ID_NOT_IN_FETCH_BACKUPS_RESULT:3,RESTORE_FAILED_WITH_NO_DEVICE_FOUND:4,EPOCH_DOWNLOAD_UNRECOVERABLE_ERROR:5,OPT_OUT_DELTA_FROM_DEVICE_PRUNING:6,UPLOAD_FAILED_WITH_INCORRECT_FINGERPRINT_FROM_CORRUPT_EPOCH:7,INIT_SEV_REMEDIATION:8,INIT_SEV_REMEDIATION_V2:9,GRAPHQL_INIT_SEV_REMEDIATION:10,DELETE_DELTA_TRIGGER:11});f["default"]=a}),66);
__d("MAWRotateDTSG",["CSRFGuard","DTSG","WATagsLogger","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error rotating DTSG: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Getting new DTSG token"]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS(["MAWRotateDTSG"]),k=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;j.LOG(i());var b=new Request("/ajax/dtsg/?__a=true",{credentials:"include",method:"GET"});b=(yield self.fetch(b));if(b.status!==200)throw c("err")("Unable to get new DTSG token: "+b.status);b=(yield b.text());b=d("CSRFGuard").clean(b);var e=JSON.parse(b);a=e==null?void 0:(a=e.payload)==null?void 0:a.token;e=e==null?void 0:(e=e.payload)==null?void 0:e.valid_for;if(a==null||e==null)throw c("err")("DTSG response is not valid: "+b+"'");return{token:a,validFor:e}});return function(){return a.apply(this,arguments)}}(),l=null;function m(){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){self.clearTimeout(l);try{var a=(yield k()),b=a.token;a=a.validFor;l=self.setTimeout(m,a/2*1e3);d("DTSG").setToken(b);return!0}catch(a){j.ERROR(h(),a);l=self.setTimeout(m,10*60*1e3);return!1}});return n.apply(this,arguments)}g.getNewDTSG=k;g.tryRotateDTSG=m}),98);
__d("EncryptedBackupsSymmetricEncryptionUtils",[],(function(a,b,c,d,e,f){"use strict";a=16;b=28;c=16;d=128;f.hChaCha20SubKeyNonceLengthInBytes=a;f.totalNonceLengthInBytes=b;f.aesGcmTagLengthInBytes=c;f.aesGcmTagLength=d}),66);
__d("HChaCha20",["err"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){}a.fromHexString=function(a){var b=a.match(/[A-Fa-f0-9]{1,2}/g);if(a.length===0||a.length%2!==0||b==null)throw c("err")('The string "'+a+'" is not valid hex.');return new Uint8Array(b.map(function(a){return parseInt(a,16)}))};a.bufferToUint32Array=function(a){var b=new DataView(a),c=[];a=a.byteLength/4;for(var d=0;d<a;d++)c.push(new DataView(b.buffer.slice(d*4,d*4+4)).getInt32(0));return Uint32Array.from(c)};a.rotate=function(a,b){a=a&4294967295;b=b&31;return(a<<b|a>>>32-b)>>>0};a.quarterRound=function(b,c,d,e){b=b;c=c;d=d;e=e;b=b+c&4294967295;e=a.rotate(e^b,16);d=d+e&4294967295;c=a.rotate(c^d,12);b=b+c&4294967295;e=a.rotate(e^b,8);d=d+e&4294967295;c=a.rotate(c^d,7);return[b>>>0,c>>>0,d>>>0,e>>>0]};var b=a.prototype;b.createHCtx=function(b,d){var e=new Uint32Array(16),f=a.fromHexString("657870616e642033322d62797465206b");if(f.byteLength!==16)throw c("err")("Could not create context. Invalid constant buffer length of "+f.byteLength+". Expected a length of 16");else if(b.byteLength!==32)throw c("err")("Could not create context. Invalid key buffer length of "+b.byteLength+". Expected a length of 32");else if(d.byteLength!==16)throw c("err")("Could not create context. Invalid nonce buffer length of "+d.byteLength+". Expected a length of 16");f=a.bufferToUint32Array(f.buffer);b=a.bufferToUint32Array(b);d=a.bufferToUint32Array(d);e.set(f);e.set(b,f.length);e.set(d,f.length+b.length);return e.buffer};b.hChaCha20Bytes=function(b,c){c=new DataView(this.createHCtx(c,b));b=c.getInt32(0);var d=c.getInt32(1<<2),e=c.getInt32(2<<2),f=c.getInt32(3<<2),g=c.getInt32(4<<2),h=c.getInt32(5<<2),i=c.getInt32(6<<2),j=c.getInt32(7<<2),k=c.getInt32(8<<2),l=c.getInt32(9<<2),m=c.getInt32(10<<2),n=c.getInt32(11<<2),o=c.getInt32(12<<2),p=c.getInt32(13<<2),q=c.getInt32(14<<2);c=c.getInt32(15<<2);for(var r=0;r<10;r++){var s=a.quarterRound(b,g,k,o);b=s[0];g=s[1];k=s[2];o=s[3];s=a.quarterRound(d,h,l,p);d=s[0];h=s[1];l=s[2];p=s[3];s=a.quarterRound(e,i,m,q);e=s[0];i=s[1];m=s[2];q=s[3];s=a.quarterRound(f,j,n,c);f=s[0];j=s[1];n=s[2];c=s[3];s=a.quarterRound(b,h,m,c);b=s[0];h=s[1];m=s[2];c=s[3];s=a.quarterRound(d,i,n,o);d=s[0];i=s[1];n=s[2];o=s[3];s=a.quarterRound(e,j,k,p);e=s[0];j=s[1];k=s[2];p=s[3];s=a.quarterRound(f,g,l,q);f=s[0];g=s[1];l=s[2];q=s[3]}return Uint32Array.from([b,d,e,f,o,p,q,c]).buffer};return a}();g.HChaCha20=a}),98);
__d("SymmetricEncryptionPaddingUtils",["XPlatReactTextEncoder"],(function(a,b,c,d,e,f,g){"use strict";function h(a){if(a<10)return 10-a;var b=Math.floor(Math.log2(a)),c=Math.floor(Math.log2(b))+1;b=b-c;c=(1<<b)-1;b=a+c&(c^-1);return b-a}function i(a){var b=Uint32Array.BYTES_PER_ELEMENT,c=a.byteLength,d=h(c);d=b+c+d;d=new DataView(new ArrayBuffer(d));d.setUint32(0,c);c=new Uint8Array(d.buffer);c.set(new Uint8Array(a),b);return c.buffer}function a(a){var b=new(d("XPlatReactTextEncoder").TextEncoder)();b=b.encode(a).buffer;return i(b)}function b(a){var b=Uint32Array.BYTES_PER_ELEMENT,c=new DataView(a);if(c.byteLength<b)return;var d=a.byteLength;c=c.getUint32(0);d=d-b;if(c>=0&&c<=d)return a.slice(b,b+c)}g.getPaddingLength=h;g.padData=i;g.pad=a;g.stripPadding=b}),98);
__d("LSSymmetricEncryptionCreateDecryptedData.nop",["CryptoLogger","EncryptedBackupsSymmetricEncryptionUtils","HChaCha20","Promise","RetUtil","SymmetricEncryptionPaddingUtils","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("CryptoLogger").CryptoLogger("symmetric_encryption_create_decrypted_data");a=function(a,c,e,f,g){if(g.byteLength<d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes+d("EncryptedBackupsSymmetricEncryptionUtils").aesGcmTagLengthInBytes){i.mustfix("cipher text is invalid");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())}a=new Uint8Array(g);var j=a.slice(0,d("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes);c=new(d("HChaCha20").HChaCha20)();var k=a.slice(d("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes).buffer;g=c.hChaCha20Bytes(j.slice(0,d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer,e);return d("XPlatReactCrypto").subtleImportKey("raw",g,"AES-GCM",!1,["decrypt"]).then(function(a){return d("XPlatReactCrypto").subtleDecrypt({additionalData:f,iv:new Uint8Array(j.slice(d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer),name:"AES-GCM",tagLength:d("EncryptedBackupsSymmetricEncryptionUtils").aesGcmTagLength},a,k)}).then(function(a){a=d("SymmetricEncryptionPaddingUtils").stripPadding(a);a==null&&i.mustfix("Failed to strip padding for symmetric decryption");return d("RetUtil").getNullableRetResult(a)})["catch"](function(a){d("CryptoLogger").captureError(i,a).mustfix("symmetric data decryption failed");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())})};a.__nop_name__="LSSymmetricEncryptionCreateDecryptedData";g["default"]=a}),98);
__d("LSDecryptProtobuf",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Decode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSIsMobileClient","LSLogMebClientEvent.nop","LSSymmetricEncryptionCreateDecryptedData.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][decryptProtobuf] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[8]=a[1]==null?c.i64.cast([0,0]):a[1],d[2]=c.i64.of_int32(a[3].length),c.i64.eq(d[2],c.i64.cast([0,1]))?c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[3],c.i64.cast([0,0])).then(function(a){return a=a,d[12]=a[0],d[13]=a[1],a})},function(e){return d[14]=d[12].get("epoch_anon_id"),d[15]=d[12].get("epoch_root_key"),d[16]=c.createArray(),d[26]=(d[16].push(c.i64.cast([0,32])),d[16]),c.i64.ge(d[8],c.i64.cast([0,3]))?c.resolve(d[17]=void 0):c.sequence([function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[2]).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[17]=d[26]}])},function(e){return c.i64.ge(d[8],c.i64.cast([0,4]))?(d[26]="_",d[18]=["message_key_in_epoch",d[26],c.blobs.to_string(d[14]),d[26],"cipher_version",d[26],c.i64.to_string(d[8]),d[26],"thread",d[26],a[2]==null?"":a[2]].join("")):(c.i64.ge(d[8],c.i64.cast([0,3]))?(d[27]="_",d[26]=["message_key_in_epoch",d[27],c.blobs.to_string(d[14]),d[27],"cipher_version",d[27],c.i64.to_string(d[8]),d[27],"thread",d[27],a[2]==null?"":a[2]].join("")):(c.i64.ge(d[8],c.i64.cast([0,2]))?(d[28]="_",d[27]=["message_key_in_epoch",d[28],c.blobs.to_string(d[14]),d[28],"cipher_version",d[28],c.i64.to_string(d[8])].join("")):d[27]=["message_key_in_epoch","_",c.blobs.to_string(d[14])].join(""),d[26]=d[27]),d[18]=d[26]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[18]).then(function(a){return a=a,d[19]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[19],d[17],d[15],d[16]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[21]=!1:d[21]=!0,d[21]?c.resolve(d[22]=void 0):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[20],c.i64.cast([0,0])).then(function(a){return a=a,d[26]=a[0],d[27]=a[1],a})},function(a){return d[22]=d[26]}])},function(e){return c.blobs.neq(d[22],void 0)?c.sequence([function(e){return c.nativeOperation(b("LSBase64Decode.nop"),a[0]).then(function(a){return a=a,d[26]=a[0],a})},function(e){return c.blobs.neq(d[26],void 0)?c.sequence([function(e){return c.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedData.nop"),d[22],c.blobs.of_string(["message_thread","_",a[2]].join("")),d[26]).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[27]=d[29]}]):c.resolve(d[27]=void 0)},function(a){return c.blobs.neq(d[27],void 0)?c.resolve(d[28]=d[27]):c.sequence([function(a){return d[29]=["Failed to decrypt message. Epoch Anon ID: ",c.blobs.to_string(d[14]),", Encryption Version: ",c.i64.to_string(d[8])].join(""),function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsDecryptProtobufStoredProcedure] ","",d[29]].join("")),d[30]=c.createArray(),void 0!==void 0?d[31]=(d[30].push(void 0),d[30]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDecryptProtobufStoredProcedure",[d[29]].join(""),d[30],c.i64.cast([0,3]))},function(a){return d[28]=void 0}])},function(a){return d[23]=d[28]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptProtobufStoredProcedure] Decryption message key is null"),void 0!==void 0?c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,85]),c.i64.cast([0,2]),"[EncryptedBackups][LSEncryptedBackupsDecryptProtobufStoredProcedure] Decryption message key is null",void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[27]=a[0],a})},function(a){return d[27]?d[28]=!0:d[28]=!1,d[28]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[30]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[30]].join("")),d[29]=c.createArray(),void 0!==void 0?d[31]=(d[29].push(void 0),d[29]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[30],d[29],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[26]=c.createArray(),void 0!==void 0?d[27]=(d[26].push(void 0),d[26]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDecryptProtobufStoredProcedure","Decryption message key is null",d[26],c.i64.cast([0,3]))},function(a){return d[23]=void 0}])},function(a){return c.blobs.neq(d[23],void 0)?(a=[d[23],void 0],d[24]=a[0],d[25]=a[1],a):(d[26]=new c.Map(),d[26].set("error_code",c.i64.cast([0,101])),d[26].set("stored_procedure","LSEncryptedBackupsDecryptProtobufStoredProcedure"),d[26].set("error_message",""),a=[void 0,d[26]],d[24]=a[0],d[25]=a[1],a),a=[d[24],d[25]],d[3]=a[0],d[4]=a[1],a}]):c.resolve((d[12]=c.i64.of_int32(a[3].length),c.i64.eq(d[12],c.i64.cast([0,0]))?(d[15]=new c.Map(),d[15].set("error_code",c.i64.cast([0,102])),d[15].set("stored_procedure","LSEncryptedBackupsDecryptProtobufStoredProcedure"),d[15].set("error_message",""),e=[void 0,d[15]],d[13]=e[0],d[14]=e[1],e):(d[15]=new c.Map(),d[15].set("error_code",c.i64.cast([0,103])),d[15].set("stored_procedure","LSEncryptedBackupsDecryptProtobufStoredProcedure"),d[15].set("error_message",""),e=[void 0,d[15]],d[13]=e[0],d[14]=e[1],e),e=[d[13],d[14]],d[3]=e[0],d[4]=e[1],e))},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[11]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][decryptProtobuf] ",d[7],d[9],d[7],d[10],d[7],d[11]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[12]=",",d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"decryptProtobuf",[d[9],d[12],d[10],d[12],d[11]].join(""),d[13],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[3],d[4]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDecryptProtobufStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSDecryptSupplementalKey",["LSArrayGetObjectAt","LSBase64Decode.nop","LSCreateDerivedKeys.nop","LSLogMebClientEvent.nop","LSSymmetricEncryptionCreateDecryptedData.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][decryptSupplementalKey] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.nativeOperation(b("LSBase64Decode.nop"),a[0]).then(function(a){return a=a,d[2]=a[0],a})},function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[1],c.i64.cast([0,0])).then(function(a){return a=a,d[3]=a[0],d[4]=a[1],a})},function(a){return c.blobs.neq(d[2],void 0)?c.sequence([function(a){return d[13]=d[3].get("epoch_root_key"),d[14]=c.createArray(),d[21]=(d[14].push(c.i64.cast([0,32])),d[14]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5zdXBwbGVtZW50YWxfZW5jX2tleQ=="),void 0,d[13],d[14]).then(function(a){return a=a,d[15]=a[0],a})},function(a){return d[15]!==void 0?c.sequence([function(a){return d[21]=c.i64.of_int32(d[15].length),c.i64.ge(d[21],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[15],c.i64.cast([0,0])).then(function(a){return a=a,d[23]=a[0],d[24]=a[1],a})},function(a){return d[22]=d[23]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[24]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",d[24]].join("")),d[23]=c.createArray(),void 0!==void 0?d[25]=(d[23].push(void 0),d[23]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",d[24],d[23],c.i64.cast([0,3]))},function(a){return d[22]=void 0}])},function(a){return d[16]=d[22]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[22]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",d[22]].join("")),d[21]=c.createArray(),void 0!==void 0?d[23]=(d[21].push(void 0),d[21]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",d[22],d[21],c.i64.cast([0,3]))},function(a){return d[16]=void 0}])},function(a){return c.blobs.neq(d[16],void 0)?d[17]=!0:d[17]=!1,d[17]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedData.nop"),d[16],c.blob("c3VwcGxlbWVudGFsX2VuY19hYWQ="),d[2]).then(function(a){return a=a,d[18]=a[0],a})},function(a){return c.blobs.neq(d[18],void 0)?(a=[c.blobs.to_string(d[18]),void 0],d[19]=a[0],d[20]=a[1],a):(d[21]=new c.Map(),d[21].set("error_code",c.i64.cast([0,109])),d[21].set("stored_procedure","LSEncryptedBackupsDecryptSupplementalKeyStoredProcedure"),d[21].set("error_message",""),a=[void 0,d[21]],d[19]=a[0],d[20]=a[1],a),a=[d[19],d[20]],d[5]=a[0],d[6]=a[1],a}]):c.resolve((d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,109])),d[13].set("stored_procedure","LSEncryptedBackupsDecryptSupplementalKeyStoredProcedure"),d[13].set("error_message",""),a=[void 0,d[13]],d[5]=a[0],d[6]=a[1],a))},function(a){return d[7]=c.i64.of_float(Date.now()),d[8]=c.i64.random(),d[10]="Finishing execution. Execution time: ",d[11]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[12]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][decryptSupplementalKey] ",d[9],d[10],d[9],d[11],d[9],d[12]].join("")),c.i64.eq(c.i64.mod_(d[8],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[13]=",",d[14]=c.createArray(),void 0!==void 0?d[15]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"decryptSupplementalKey",[d[10],d[13],d[11],d[13],d[12]].join(""),d[14],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[5],d[6]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDecryptSupplementalKeyStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSDecryptMessageProtobufs",["LSArrayGetObjectAt","LSDecryptProtobuf","LSDecryptSupplementalKey","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][decryptMessageProtobufs] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[15]=new c.Map(),d[15].set("error_msg","Expected a nonempty query result"),d[15].set("code",c.i64.cast([0,3])),d[15].set("src_line","MEBClientStateUtils.php:244 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[16]=c.createArray(),d[17]=(d[16].push(d[15]),d[16]),e=[void 0,d[16]],d[2]=e[0],d[3]=e[1],e):(b=a.item,d[15]=new c.Map(),d[15].set("backup_id",b.backupId),d[15].set("device_public_key_blob",b.devicePublicKeyBlob),d[15].set("device_private_key_blob",b.devicePrivateKeyBlob),d[15].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[15].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[15].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[15].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[15].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[15].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[15].set("orf_client_state_v2_blob",void 0),d[15].set("orf_v2_authority_level",void 0),d[15].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[15].set("device_id",b.deviceId),d[15].set("backup_tenancy",b.backupTenancy),d[15].set("encryption_version",b.encryptionVersion),d[15].set("revision_version",b.revisionVersion),d[15].set("initialize_restore_result",void 0),d[15].set("authority_level",b.authorityLevel),e=[d[15],void 0],d[2]=e[0],d[3]=e[1],e)})},function(e){return d[5]=new c.Map(),d[5].set("value",d[2]),d[5].set("errors",d[3]),d[6]=d[5].get("value"),d[6]!==void 0?c.sequence([function(e){return d[15]=d[6].get("backup_id"),d[16]=d[6].get("device_public_key_blob"),d[17]=d[6].get("device_private_key_blob"),d[18]=d[6].get("epoch_storage_public_key_blob"),d[19]=d[6].get("epoch_storage_private_key_blob"),d[20]=d[6].get("epoch_auth_public_key_blob"),d[21]=d[6].get("epoch_auth_private_key_blob"),d[22]=d[6].get("mailbox_root_key_blob"),d[23]=d[6].get("ocmf_client_state_blob"),d[24]=d[6].get("orf_client_state_v2_blob"),d[25]=d[6].get("orf_v2_authority_level"),d[26]=d[6].get("oblivious_validation_token_blob"),d[27]=d[6].get("device_id"),d[28]=d[6].get("backup_tenancy"),d[29]=d[6].get("encryption_version"),d[30]=d[6].get("revision_version"),d[31]=d[6].get("initialize_restore_result"),d[32]=d[6].get("authority_level"),c.i64.neq(d[27],void 0)?c.sequence([function(a){return d[35]=void 0,c.i64.neq(d[35],void 0)?c.resolve(d[36]=d[35]):c.sequence([function(a){return d[46]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[47]?d[56]=(d[46].push(c.i64.cast([0,0])),d[46]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[48]=a[0],a})},function(a){return d[48]?d[56]=(d[46].push(c.i64.cast([0,2])),d[46]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[49]?d[56]=(d[46].push(c.i64.cast([0,3])),d[46]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[50]=a[0],a})},function(a){return d[50]?d[56]=(d[46].push(c.i64.cast([0,4])),d[46]):0,d[51]=c.createArray(),d[52]=c.i64.of_int32(d[46].length),c.i64.gt(d[52],c.i64.cast([0,0]))?c.loopAsync(d[52],function(a){return d[56]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[46],d[56]).then(function(a){return a=a,d[57]=a[0],d[58]=a[1],a})},function(a){return d[59]=(d[51].push(d[57]),d[51])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[56]=c.createArray(),d[57]=c.i64.of_int32(d[51].length),c.i64.gt(d[57],c.i64.cast([0,0]))?c.loopAsync(d[57],function(a){return d[59]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[51],d[59]).then(function(a){return a=a,d[60]=a[0],d[61]=a[1],a})},function(a){return d[62]=(d[56].push(c.i64.to_string(d[60])),d[56])}])}):c.resolve()},function(a){return d[58]=d[56].join(","),d[53]=d[58]}])},function(a){return d[51].some(function(a){return c.i64.eq(d[29],a)})?d[54]=d[29]:d[54]=void 0,c.i64.neq(d[54],void 0)?d[55]=d[54]:d[55]=void 0,d[36]=d[55]}])},function(e){return c.i64.neq(d[36],void 0)?d[37]=d[36]:d[37]=c.i64.cast([0,0]),c.i64.neq(d[28],void 0)?d[38]=d[28]:d[38]=c.i64.cast([0,1]),d[39]=c.createArray(),d[40]=c.createArray(),d[41]=new c.Map(),d[42]=c.i64.of_int32(a[0].length),c.i64.gt(d[42],c.i64.cast([0,0]))?c.loopAsync(d[42],function(e){return d[46]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[46]).then(function(a){return a=a,d[47]=a[0],d[48]=a[1],a})},function(a){return d[49]=d[47].get("encrypted_protobufs"),d[50]=d[49].get("toplevel_protobuf"),d[51]=d[50].get("epoch_id"),d[52]=d[50].get("epoch_anon_id"),d[53]=d[41].get(c.blobs.to_string(d[52])),d[53]!==void 0?c.resolve(d[54]=d[53]):c.sequence([function(a){return c.i64.neq(d[51],void 0)?c.sequence([function(a){return d[61]=c.createArray(),c.count(c.db.table(169).fetch([[[d[51]]]])).then(function(a){return d[62]=a})},function(a){return c.i64.le(d[62],c.i64.cast([0,1]))?c.sequence([function(a){return c.db.table(169).fetch([[[d[51]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[72]=new c.Map(),d[72].set("error_msg","Expected a nonempty query result"),d[72].set("code",c.i64.cast([0,3])),d[72].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[73]=c.createArray(),d[74]=(d[73].push(d[72]),d[73]),e=[void 0,d[73]],d[68]=e[0],d[69]=e[1],e):(b=a.item,d[72]=new c.Map(),d[72].set("epoch_id",b.epochId),d[72].set("backup_id",b.backupId),d[72].set("epoch_anon_id_blob",b.epochAnonIdBlob),d[72].set("epoch_root_key_blob",b.epochRootKeyBlob),d[72].set("epoch_status",b.epochStatus),d[72].set("epoch_head",b.epochHead),d[72].set("authority_level",b.authorityLevel),e=[d[72],void 0],d[68]=e[0],d[69]=e[1],e)})},function(a){return d[71]=new c.Map(),d[71].set("value",d[68]),d[71].set("errors",d[69]),d[63]=d[71]}]):c.resolve((d[68]=new c.Map(),d[68].set("error_msg","Expected at most one result"),d[68].set("code",c.i64.cast([0,4])),d[68].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[69]=c.createArray(),d[71]=(d[69].push(d[68]),d[69]),d[70]=new c.Map(),d[70].set("value",void 0),d[70].set("errors",d[69]),d[63]=d[70]))},function(a){return d[64]=d[63].get("value"),d[64]!==void 0?(d[68]=d[64].get("epoch_id"),d[69]=d[64].get("backup_id"),d[70]=d[64].get("epoch_anon_id_blob"),d[71]=d[64].get("epoch_root_key_blob"),d[72]=d[64].get("epoch_status"),d[73]=d[64].get("epoch_head"),d[74]=d[64].get("authority_level"),c.i64.eq(d[74],c.i64.cast([0,80]))?d[75]=d[63]:(d[76]=new c.Map(),d[76].set("error_msg","NONE"),d[76].set("code",c.i64.cast([0,0])),d[76].set("src_line","MEBEpochClientUtils.php:315 Closure$MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly#2()"),d[77]=c.createArray(),d[79]=(d[77].push(d[76]),d[77]),d[78]=new c.Map(),d[78].set("value",void 0),d[78].set("errors",d[77]),d[75]=d[78]),d[65]=d[75]):(d[68]=d[63].get("errors"),d[69]=d[63].get("errors"),d[70]=new c.Map(),d[70].set("value",void 0),d[70].set("errors",d[68]),d[65]=d[70]),d[66]=d[65].get("value"),d[66]!==void 0?(d[68]=d[66].get("epoch_id"),d[69]=d[66].get("backup_id"),d[70]=d[66].get("epoch_anon_id_blob"),d[71]=d[66].get("epoch_root_key_blob"),d[72]=d[66].get("epoch_status"),d[73]=d[66].get("epoch_head"),d[74]=d[66].get("authority_level"),c.i64.eq(d[69],d[15])&&c.i64.eq(d[74],c.i64.cast([0,80]))?(d[75]=new c.Map(),d[75].set("epoch_root_key",d[71]),d[75].set("epoch_anon_id",d[70]),d[76]=(d[61].push(d[75]),d[61])):0,d[67]=!0):(d[68]=d[65].get("errors"),d[69]=d[65].get("errors"),d[67]=!1),d[60]=d[61]}]):c.sequence([function(a){return d[61]=c.createArray(),c.filter(c.db.table(169).fetch(),function(a){return c.blobs.eq(a.epochAnonIdBlob,d[52])}).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[68]=new c.Map(),d[68].set("error_msg","Expected a nonempty query result"),d[68].set("code",c.i64.cast([0,3])),d[68].set("src_line","MEBEpochClientUtils.php:556 MEBEpochClientUtils::maybeEpochWithAnonIDFromPersistentEpochsTableDirectly()"),d[69]=c.createArray(),d[70]=(d[69].push(d[68]),d[69]),e=[void 0,d[69]],d[62]=e[0],d[63]=e[1],e):(b=a.item,d[68]=new c.Map(),d[68].set("epoch_id",b.epochId),d[68].set("backup_id",b.backupId),d[68].set("epoch_anon_id_blob",b.epochAnonIdBlob),d[68].set("epoch_root_key_blob",b.epochRootKeyBlob),d[68].set("epoch_status",b.epochStatus),d[68].set("epoch_head",b.epochHead),d[68].set("authority_level",b.authorityLevel),e=[d[68],void 0],d[62]=e[0],d[63]=e[1],e)})},function(a){return d[65]=new c.Map(),d[65].set("value",d[62]),d[65].set("errors",d[63]),d[66]=d[65].get("value"),d[66]!==void 0?(d[68]=d[66].get("epoch_id"),d[69]=d[66].get("backup_id"),d[70]=d[66].get("epoch_anon_id_blob"),d[71]=d[66].get("epoch_root_key_blob"),d[72]=d[66].get("epoch_status"),d[73]=d[66].get("epoch_head"),d[74]=d[66].get("authority_level"),c.i64.eq(d[69],d[15])&&c.i64.eq(d[74],c.i64.cast([0,80]))?(d[75]=new c.Map(),d[75].set("epoch_root_key",d[71]),d[75].set("epoch_anon_id",d[70]),d[76]=(d[61].push(d[75]),d[61])):0,d[67]=!0):(d[68]=d[65].get("errors"),d[69]=d[65].get("errors"),d[67]=!1),d[60]=d[61]}])},function(a){return d[54]=d[60]}])},function(e){return d[55]=d[50].get("epoch_anon_id"),d[41].set(c.blobs.to_string(d[55]),d[54]),d[56]=d[50].get("encrypted_protobuf"),d[57]=d[50].get("encryption_version"),c.storedProcedure(b("LSDecryptProtobuf"),d[56],d[57],a[1],d[54]).then(function(a){return a=a,d[58]=a[0],d[59]=a[1],a})},function(e){return c.blobs.neq(d[58],void 0)?c.sequence([function(e){return d[60]=d[47].get("encrypted_protobufs"),d[61]=d[60].get("supplemental_protobufs"),d[62]=new c.Map(),d[63]=d[61].keys(),d[64]=c.i64.of_int32(d[63].length),c.i64.gt(d[64],c.i64.cast([0,0]))?c.loopAsync(d[64],function(e){return d[70]=e,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[63],d[70]).then(function(a){return a=a,d[71]=a[0],d[72]=a[1],a})},function(e){return d[73]=d[61].get(d[71]),d[73]!==void 0?c.sequence([function(a){return d[74]=d[73].get("epoch_id"),d[75]=d[73].get("epoch_anon_id"),d[76]=d[41].get(c.blobs.to_string(d[75])),d[76]!==void 0?c.resolve(d[77]=d[76]):c.sequence([function(a){return c.i64.neq(d[74],void 0)?c.sequence([function(a){return d[83]=c.createArray(),c.count(c.db.table(169).fetch([[[d[74]]]])).then(function(a){return d[84]=a})},function(a){return c.i64.le(d[84],c.i64.cast([0,1]))?c.sequence([function(a){return c.db.table(169).fetch([[[d[74]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[94]=new c.Map(),d[94].set("error_msg","Expected a nonempty query result"),d[94].set("code",c.i64.cast([0,3])),d[94].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[95]=c.createArray(),d[96]=(d[95].push(d[94]),d[95]),e=[void 0,d[95]],d[90]=e[0],d[91]=e[1],e):(b=a.item,d[94]=new c.Map(),d[94].set("epoch_id",b.epochId),d[94].set("backup_id",b.backupId),d[94].set("epoch_anon_id_blob",b.epochAnonIdBlob),d[94].set("epoch_root_key_blob",b.epochRootKeyBlob),d[94].set("epoch_status",b.epochStatus),d[94].set("epoch_head",b.epochHead),d[94].set("authority_level",b.authorityLevel),e=[d[94],void 0],d[90]=e[0],d[91]=e[1],e)})},function(a){return d[93]=new c.Map(),d[93].set("value",d[90]),d[93].set("errors",d[91]),d[85]=d[93]}]):c.resolve((d[90]=new c.Map(),d[90].set("error_msg","Expected at most one result"),d[90].set("code",c.i64.cast([0,4])),d[90].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[91]=c.createArray(),d[93]=(d[91].push(d[90]),d[91]),d[92]=new c.Map(),d[92].set("value",void 0),d[92].set("errors",d[91]),d[85]=d[92]))},function(a){return d[86]=d[85].get("value"),d[86]!==void 0?(d[90]=d[86].get("epoch_id"),d[91]=d[86].get("backup_id"),d[92]=d[86].get("epoch_anon_id_blob"),d[93]=d[86].get("epoch_root_key_blob"),d[94]=d[86].get("epoch_status"),d[95]=d[86].get("epoch_head"),d[96]=d[86].get("authority_level"),c.i64.eq(d[96],c.i64.cast([0,80]))?d[97]=d[85]:(d[98]=new c.Map(),d[98].set("error_msg","NONE"),d[98].set("code",c.i64.cast([0,0])),d[98].set("src_line","MEBEpochClientUtils.php:315 Closure$MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly#2()"),d[99]=c.createArray(),d[101]=(d[99].push(d[98]),d[99]),d[100]=new c.Map(),d[100].set("value",void 0),d[100].set("errors",d[99]),d[97]=d[100]),d[87]=d[97]):(d[90]=d[85].get("errors"),d[91]=d[85].get("errors"),d[92]=new c.Map(),d[92].set("value",void 0),d[92].set("errors",d[90]),d[87]=d[92]),d[88]=d[87].get("value"),d[88]!==void 0?(d[90]=d[88].get("epoch_id"),d[91]=d[88].get("backup_id"),d[92]=d[88].get("epoch_anon_id_blob"),d[93]=d[88].get("epoch_root_key_blob"),d[94]=d[88].get("epoch_status"),d[95]=d[88].get("epoch_head"),d[96]=d[88].get("authority_level"),c.i64.eq(d[91],d[15])&&c.i64.eq(d[96],c.i64.cast([0,80]))?(d[97]=new c.Map(),d[97].set("epoch_root_key",d[93]),d[97].set("epoch_anon_id",d[92]),d[98]=(d[83].push(d[97]),d[83])):0,d[89]=!0):(d[90]=d[87].get("errors"),d[91]=d[87].get("errors"),d[89]=!1),d[82]=d[83]}]):c.sequence([function(a){return d[83]=c.createArray(),c.filter(c.db.table(169).fetch(),function(a){return c.blobs.eq(a.epochAnonIdBlob,d[75])}).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[90]=new c.Map(),d[90].set("error_msg","Expected a nonempty query result"),d[90].set("code",c.i64.cast([0,3])),d[90].set("src_line","MEBEpochClientUtils.php:556 MEBEpochClientUtils::maybeEpochWithAnonIDFromPersistentEpochsTableDirectly()"),d[91]=c.createArray(),d[92]=(d[91].push(d[90]),d[91]),e=[void 0,d[91]],d[84]=e[0],d[85]=e[1],e):(b=a.item,d[90]=new c.Map(),d[90].set("epoch_id",b.epochId),d[90].set("backup_id",b.backupId),d[90].set("epoch_anon_id_blob",b.epochAnonIdBlob),d[90].set("epoch_root_key_blob",b.epochRootKeyBlob),d[90].set("epoch_status",b.epochStatus),d[90].set("epoch_head",b.epochHead),d[90].set("authority_level",b.authorityLevel),e=[d[90],void 0],d[84]=e[0],d[85]=e[1],e)})},function(a){return d[87]=new c.Map(),d[87].set("value",d[84]),d[87].set("errors",d[85]),d[88]=d[87].get("value"),d[88]!==void 0?(d[90]=d[88].get("epoch_id"),d[91]=d[88].get("backup_id"),d[92]=d[88].get("epoch_anon_id_blob"),d[93]=d[88].get("epoch_root_key_blob"),d[94]=d[88].get("epoch_status"),d[95]=d[88].get("epoch_head"),d[96]=d[88].get("authority_level"),c.i64.eq(d[91],d[15])&&c.i64.eq(d[96],c.i64.cast([0,80]))?(d[97]=new c.Map(),d[97].set("epoch_root_key",d[93]),d[97].set("epoch_anon_id",d[92]),d[98]=(d[83].push(d[97]),d[83])):0,d[89]=!0):(d[90]=d[87].get("errors"),d[91]=d[87].get("errors"),d[89]=!1),d[82]=d[83]}])},function(a){return d[77]=d[82]}])},function(a){return d[78]=d[73].get("epoch_anon_id"),d[41].set(c.blobs.to_string(d[78]),d[77]),d[79]=d[73].get("sk_ciphertext"),c.storedProcedure(b("LSDecryptSupplementalKey"),d[79]==null?"":d[79],d[77]).then(function(a){return a=a,d[80]=a[0],d[81]=a[1],a})},function(e){return d[80]!==void 0?c.sequence([function(e){return d[82]=d[73].get("encrypted_protobuf"),d[83]=d[73].get("encryption_version"),c.storedProcedure(b("LSDecryptProtobuf"),d[82],d[83],a[1],d[77]).then(function(a){return a=a,d[84]=a[0],d[85]=a[1],a})},function(a){return c.blobs.neq(d[84],void 0)?(d[86]=d[73].get("protobuf_timestamp_ms"),d[87]=new c.Map(),d[87].set("decrypted_protobuf",d[84]),d[87].set("protobuf_timestamp_ms",d[86]),d[62].set(d[80],d[87])):d[86]=(d[40].push(d[85]),d[40])}]):c.resolve((d[82]=new c.Map(),d[82].set("error_code",c.i64.cast([0,109])),d[82].set("stored_procedure","LSEncryptedBackupsDecryptMessageProtobufsStoredProcedure"),d[82].set("error_message",""),d[83]=(d[40].push(d[82]),d[40])))}]):c.resolve()}])}):c.resolve()},function(a){return d[65]=d[47].get("otid"),d[66]=d[50].get("protobuf_timestamp_ms"),d[67]=new c.Map(),d[67].set("decrypted_protobuf",d[58]),d[67].set("protobuf_timestamp_ms",d[66]),d[68]=d[47].get("message_tags"),d[69]=new c.Map(),d[69].set("otid",d[65]),d[69].set("toplevel_protobuf",d[67]),d[69].set("supplemental_protobufs",d[62]),d[69].set("message_tags",d[68]),d[70]=(d[39].push(d[69]),d[39])}]):c.resolve(d[60]=(d[40].push(d[59]),d[40]))}])}):c.resolve()},function(a){return d[43]=c.i64.of_int32(d[40].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[40],c.i64.cast([0,0])).then(function(a){return a=a,d[46]=a[0],d[47]=a[1],a})},function(a){return a=[void 0,d[46]],d[44]=a[0],d[45]=a[1],a}]):c.resolve((a=[d[39],void 0],d[44]=a[0],d[45]=a[1],a))},function(a){return a=[d[44],d[45]],d[33]=a[0],d[34]=a[1],a}]):c.resolve((d[35]=new c.Map(),d[35].set("error_code",c.i64.cast([0,24])),d[35].set("stored_procedure","LSEncryptedBackupsDecryptMessageProtobufsStoredProcedure"),d[35].set("error_message",""),e=[void 0,d[35]],d[33]=e[0],d[34]=e[1],e))},function(a){return a=[d[33],d[34]],d[7]=a[0],d[8]=a[1],a}]):c.resolve((d[15]=d[5].get("errors"),d[16]=d[5].get("errors"),d[17]=new c.Map(),d[17].set("error_code",c.i64.cast([0,1])),d[17].set("stored_procedure","LSEncryptedBackupsDecryptMessageProtobufsStoredProcedure"),d[17].set("error_message",""),e=[void 0,d[17]],d[7]=e[0],d[8]=e[1],e))},function(a){return d[9]=c.i64.of_float(Date.now()),d[10]=c.i64.random(),d[12]="Finishing execution. Execution time: ",d[13]=c.i64.to_string(c.i64.sub(d[9],d[0])),d[14]=" ms",d[11]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][decryptMessageProtobufs] ",d[11],d[12],d[11],d[13],d[11],d[14]].join("")),c.i64.eq(c.i64.mod_(d[10],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[15]=",",d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"decryptMessageProtobufs",[d[12],d[15],d[13],d[15],d[14]].join(""),d[16],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[7],d[8]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDecryptMessageProtobufsStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSDecryptMessageProtobufsStoredProcedure",["LSDecryptMessageProtobufs","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSDecryptMessageProtobufs"),e.encryptedMessagesWithProtobufs,e.actThreadId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSDecryptMessageV2",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSIsMobileClient","LSLogMebClientEvent.nop","LSSymmetricEncryptionCreateDecryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][decryptMessageV2] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[8]=a[2]==null?c.i64.cast([0,0]):a[2],d[2]=c.i64.of_int32(a[3].length),c.i64.eq(d[2],c.i64.cast([0,1]))?c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[3],c.i64.cast([0,0])).then(function(a){return a=a,d[12]=a[0],d[13]=a[1],a})},function(e){return d[14]=d[12].get("epoch_anon_id"),d[15]=d[12].get("epoch_root_key"),d[16]=c.createArray(),d[26]=(d[16].push(c.i64.cast([0,32])),d[16]),c.i64.ge(d[8],c.i64.cast([0,3]))?c.resolve(d[17]=void 0):c.sequence([function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[1]).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[17]=d[26]}])},function(e){return c.i64.ge(d[8],c.i64.cast([0,4]))?(d[26]="_",d[18]=["message_key_in_epoch",d[26],c.blobs.to_string(d[14]),d[26],"cipher_version",d[26],c.i64.to_string(d[8]),d[26],"thread",d[26],a[1]==null?"":a[1]].join("")):(c.i64.ge(d[8],c.i64.cast([0,3]))?(d[27]="_",d[26]=["message_key_in_epoch",d[27],c.blobs.to_string(d[14]),d[27],"cipher_version",d[27],c.i64.to_string(d[8]),d[27],"thread",d[27],a[1]==null?"":a[1]].join("")):(c.i64.ge(d[8],c.i64.cast([0,2]))?(d[28]="_",d[27]=["message_key_in_epoch",d[28],c.blobs.to_string(d[14]),d[28],"cipher_version",d[28],c.i64.to_string(d[8])].join("")):d[27]=["message_key_in_epoch","_",c.blobs.to_string(d[14])].join(""),d[26]=d[27]),d[18]=d[26]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[18]).then(function(a){return a=a,d[19]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[19],d[17],d[15],d[16]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[21]=!1:d[21]=!0,d[21]?c.resolve(d[22]=void 0):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[20],c.i64.cast([0,0])).then(function(a){return a=a,d[26]=a[0],d[27]=a[1],a})},function(a){return d[22]=d[26]}])},function(e){return c.blobs.neq(d[22],void 0)?c.sequence([function(e){return c.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),d[22],c.blobs.of_string(["message_thread","_",a[1]].join("")),a[0]).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[26]!==void 0?c.resolve(d[27]=d[26]):c.sequence([function(a){return d[28]=["Failed to decrypt message. Epoch Anon ID: ",c.blobs.to_string(d[14]),", Encryption Version: ",c.i64.to_string(d[8])].join(""),function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsDecryptMessageV2StoredProcedure] ","",d[28]].join("")),d[29]=c.createArray(),void 0!==void 0?d[30]=(d[29].push(void 0),d[29]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDecryptMessageV2StoredProcedure",[d[28]].join(""),d[29],c.i64.cast([0,3]))},function(a){return d[27]=void 0}])},function(a){return d[23]=d[27]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptMessageV2StoredProcedure] Decryption message key is null"),void 0!==void 0?c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,85]),c.i64.cast([0,2]),"[EncryptedBackups][LSEncryptedBackupsDecryptMessageV2StoredProcedure] Decryption message key is null",void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[27]=a[0],a})},function(a){return d[27]?d[28]=!0:d[28]=!1,d[28]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[30]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[30]].join("")),d[29]=c.createArray(),void 0!==void 0?d[31]=(d[29].push(void 0),d[29]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[30],d[29],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(a){return d[26]=c.createArray(),void 0!==void 0?d[27]=(d[26].push(void 0),d[26]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDecryptMessageV2StoredProcedure","Decryption message key is null",d[26],c.i64.cast([0,3]))},function(a){return d[23]=void 0}])},function(a){return d[23]!==void 0?(a=[d[23],void 0],d[24]=a[0],d[25]=a[1],a):(d[26]=new c.Map(),d[26].set("error_code",c.i64.cast([0,101])),d[26].set("stored_procedure","LSEncryptedBackupsDecryptMessageV2StoredProcedure"),d[26].set("error_message",""),a=[void 0,d[26]],d[24]=a[0],d[25]=a[1],a),a=[d[24],d[25]],d[3]=a[0],d[4]=a[1],a}]):c.resolve((d[12]=c.i64.of_int32(a[3].length),c.i64.eq(d[12],c.i64.cast([0,0]))?(d[15]=new c.Map(),d[15].set("error_code",c.i64.cast([0,102])),d[15].set("stored_procedure","LSEncryptedBackupsDecryptMessageV2StoredProcedure"),d[15].set("error_message",""),e=[void 0,d[15]],d[13]=e[0],d[14]=e[1],e):(d[15]=new c.Map(),d[15].set("error_code",c.i64.cast([0,103])),d[15].set("stored_procedure","LSEncryptedBackupsDecryptMessageV2StoredProcedure"),d[15].set("error_message",""),e=[void 0,d[15]],d[13]=e[0],d[14]=e[1],e),e=[d[13],d[14]],d[3]=e[0],d[4]=e[1],e))},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[11]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][decryptMessageV2] ",d[7],d[9],d[7],d[10],d[7],d[11]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[12]=",",d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"decryptMessageV2",[d[9],d[12],d[10],d[12],d[11]].join(""),d[13],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[3],d[4]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDecryptMessageV2StoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSDecryptMessages",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSDecryptMessageV2","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][decryptMessages] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[15]=new c.Map(),d[15].set("error_msg","Expected a nonempty query result"),d[15].set("code",c.i64.cast([0,3])),d[15].set("src_line","MEBClientStateUtils.php:244 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[16]=c.createArray(),d[17]=(d[16].push(d[15]),d[16]),e=[void 0,d[16]],d[2]=e[0],d[3]=e[1],e):(b=a.item,d[15]=new c.Map(),d[15].set("backup_id",b.backupId),d[15].set("device_public_key_blob",b.devicePublicKeyBlob),d[15].set("device_private_key_blob",b.devicePrivateKeyBlob),d[15].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[15].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[15].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[15].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[15].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[15].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[15].set("orf_client_state_v2_blob",void 0),d[15].set("orf_v2_authority_level",void 0),d[15].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[15].set("device_id",b.deviceId),d[15].set("backup_tenancy",b.backupTenancy),d[15].set("encryption_version",b.encryptionVersion),d[15].set("revision_version",b.revisionVersion),d[15].set("initialize_restore_result",void 0),d[15].set("authority_level",b.authorityLevel),e=[d[15],void 0],d[2]=e[0],d[3]=e[1],e)})},function(e){return d[5]=new c.Map(),d[5].set("value",d[2]),d[5].set("errors",d[3]),d[6]=d[5].get("value"),d[6]!==void 0?c.sequence([function(e){return d[15]=d[6].get("backup_id"),d[16]=d[6].get("device_public_key_blob"),d[17]=d[6].get("device_private_key_blob"),d[18]=d[6].get("epoch_storage_public_key_blob"),d[19]=d[6].get("epoch_storage_private_key_blob"),d[20]=d[6].get("epoch_auth_public_key_blob"),d[21]=d[6].get("epoch_auth_private_key_blob"),d[22]=d[6].get("mailbox_root_key_blob"),d[23]=d[6].get("ocmf_client_state_blob"),d[24]=d[6].get("orf_client_state_v2_blob"),d[25]=d[6].get("orf_v2_authority_level"),d[26]=d[6].get("oblivious_validation_token_blob"),d[27]=d[6].get("device_id"),d[28]=d[6].get("backup_tenancy"),d[29]=d[6].get("encryption_version"),d[30]=d[6].get("revision_version"),d[31]=d[6].get("initialize_restore_result"),d[32]=d[6].get("authority_level"),c.i64.neq(d[27],void 0)?c.sequence([function(a){return d[35]=void 0,c.i64.neq(d[35],void 0)?c.resolve(d[36]=d[35]):c.sequence([function(a){return d[46]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[47]?d[56]=(d[46].push(c.i64.cast([0,0])),d[46]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[48]=a[0],a})},function(a){return d[48]?d[56]=(d[46].push(c.i64.cast([0,2])),d[46]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[49]?d[56]=(d[46].push(c.i64.cast([0,3])),d[46]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[50]=a[0],a})},function(a){return d[50]?d[56]=(d[46].push(c.i64.cast([0,4])),d[46]):0,d[51]=c.createArray(),d[52]=c.i64.of_int32(d[46].length),c.i64.gt(d[52],c.i64.cast([0,0]))?c.loopAsync(d[52],function(a){return d[56]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[46],d[56]).then(function(a){return a=a,d[57]=a[0],d[58]=a[1],a})},function(a){return d[59]=(d[51].push(d[57]),d[51])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[56]=c.createArray(),d[57]=c.i64.of_int32(d[51].length),c.i64.gt(d[57],c.i64.cast([0,0]))?c.loopAsync(d[57],function(a){return d[59]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[51],d[59]).then(function(a){return a=a,d[60]=a[0],d[61]=a[1],a})},function(a){return d[62]=(d[56].push(c.i64.to_string(d[60])),d[56])}])}):c.resolve()},function(a){return d[58]=d[56].join(","),d[53]=d[58]}])},function(a){return d[51].some(function(a){return c.i64.eq(d[29],a)})?d[54]=d[29]:d[54]=void 0,c.i64.neq(d[54],void 0)?d[55]=d[54]:d[55]=void 0,d[36]=d[55]}])},function(e){return c.i64.neq(d[36],void 0)?d[37]=d[36]:d[37]=c.i64.cast([0,0]),c.i64.neq(d[28],void 0)?d[38]=d[28]:d[38]=c.i64.cast([0,1]),d[39]=c.createArray(),d[40]=c.createArray(),d[41]=new c.Map(),d[42]=c.i64.of_int32(a[0].length),c.i64.gt(d[42],c.i64.cast([0,0]))?c.loopAsync(d[42],function(e){return d[46]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[46]).then(function(a){return a=a,d[47]=a[0],d[48]=a[1],a})},function(a){return d[49]=d[47].get("epoch_anon_id"),d[50]=d[41].get(c.blobs.to_string(d[49])),d[50]!==void 0?c.resolve(d[51]=d[50]):c.sequence([function(a){return d[56]=d[47].get("epoch_anon_id"),d[57]=d[47].get("epoch_id"),c.i64.neq(d[57],void 0)?c.sequence([function(a){return d[60]=c.createArray(),c.count(c.db.table(169).fetch([[[d[57]]]])).then(function(a){return d[61]=a})},function(a){return c.i64.le(d[61],c.i64.cast([0,1]))?c.sequence([function(a){return c.db.table(169).fetch([[[d[57]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[71]=new c.Map(),d[71].set("error_msg","Expected a nonempty query result"),d[71].set("code",c.i64.cast([0,3])),d[71].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[72]=c.createArray(),d[73]=(d[72].push(d[71]),d[72]),e=[void 0,d[72]],d[67]=e[0],d[68]=e[1],e):(b=a.item,d[71]=new c.Map(),d[71].set("epoch_id",b.epochId),d[71].set("backup_id",b.backupId),d[71].set("epoch_anon_id_blob",b.epochAnonIdBlob),d[71].set("epoch_root_key_blob",b.epochRootKeyBlob),d[71].set("epoch_status",b.epochStatus),d[71].set("epoch_head",b.epochHead),d[71].set("authority_level",b.authorityLevel),e=[d[71],void 0],d[67]=e[0],d[68]=e[1],e)})},function(a){return d[70]=new c.Map(),d[70].set("value",d[67]),d[70].set("errors",d[68]),d[62]=d[70]}]):c.resolve((d[67]=new c.Map(),d[67].set("error_msg","Expected at most one result"),d[67].set("code",c.i64.cast([0,4])),d[67].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[68]=c.createArray(),d[70]=(d[68].push(d[67]),d[68]),d[69]=new c.Map(),d[69].set("value",void 0),d[69].set("errors",d[68]),d[62]=d[69]))},function(a){return d[63]=d[62].get("value"),d[63]!==void 0?(d[67]=d[63].get("epoch_id"),d[68]=d[63].get("backup_id"),d[69]=d[63].get("epoch_anon_id_blob"),d[70]=d[63].get("epoch_root_key_blob"),d[71]=d[63].get("epoch_status"),d[72]=d[63].get("epoch_head"),d[73]=d[63].get("authority_level"),c.i64.eq(d[73],c.i64.cast([0,80]))?d[74]=d[62]:(d[75]=new c.Map(),d[75].set("error_msg","NONE"),d[75].set("code",c.i64.cast([0,0])),d[75].set("src_line","MEBEpochClientUtils.php:315 Closure$MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly#2()"),d[76]=c.createArray(),d[78]=(d[76].push(d[75]),d[76]),d[77]=new c.Map(),d[77].set("value",void 0),d[77].set("errors",d[76]),d[74]=d[77]),d[64]=d[74]):(d[67]=d[62].get("errors"),d[68]=d[62].get("errors"),d[69]=new c.Map(),d[69].set("value",void 0),d[69].set("errors",d[67]),d[64]=d[69]),d[65]=d[64].get("value"),d[65]!==void 0?(d[67]=d[65].get("epoch_id"),d[68]=d[65].get("backup_id"),d[69]=d[65].get("epoch_anon_id_blob"),d[70]=d[65].get("epoch_root_key_blob"),d[71]=d[65].get("epoch_status"),d[72]=d[65].get("epoch_head"),d[73]=d[65].get("authority_level"),c.i64.eq(d[68],d[15])&&c.i64.eq(d[73],c.i64.cast([0,80]))?(d[74]=new c.Map(),d[74].set("epoch_root_key",d[70]),d[74].set("epoch_anon_id",d[69]),d[75]=(d[60].push(d[74]),d[60])):0,d[66]=!0):(d[67]=d[64].get("errors"),d[68]=d[64].get("errors"),d[66]=!1),d[58]=d[60]}]):c.sequence([function(a){return d[60]=c.createArray(),c.filter(c.db.table(169).fetch(),function(a){return c.blobs.eq(a.epochAnonIdBlob,d[56])}).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[67]=new c.Map(),d[67].set("error_msg","Expected a nonempty query result"),d[67].set("code",c.i64.cast([0,3])),d[67].set("src_line","MEBEpochClientUtils.php:556 MEBEpochClientUtils::maybeEpochWithAnonIDFromPersistentEpochsTableDirectly()"),d[68]=c.createArray(),d[69]=(d[68].push(d[67]),d[68]),e=[void 0,d[68]],d[61]=e[0],d[62]=e[1],e):(b=a.item,d[67]=new c.Map(),d[67].set("epoch_id",b.epochId),d[67].set("backup_id",b.backupId),d[67].set("epoch_anon_id_blob",b.epochAnonIdBlob),d[67].set("epoch_root_key_blob",b.epochRootKeyBlob),d[67].set("epoch_status",b.epochStatus),d[67].set("epoch_head",b.epochHead),d[67].set("authority_level",b.authorityLevel),e=[d[67],void 0],d[61]=e[0],d[62]=e[1],e)})},function(a){return d[64]=new c.Map(),d[64].set("value",d[61]),d[64].set("errors",d[62]),d[65]=d[64].get("value"),d[65]!==void 0?(d[67]=d[65].get("epoch_id"),d[68]=d[65].get("backup_id"),d[69]=d[65].get("epoch_anon_id_blob"),d[70]=d[65].get("epoch_root_key_blob"),d[71]=d[65].get("epoch_status"),d[72]=d[65].get("epoch_head"),d[73]=d[65].get("authority_level"),c.i64.eq(d[68],d[15])&&c.i64.eq(d[73],c.i64.cast([0,80]))?(d[74]=new c.Map(),d[74].set("epoch_root_key",d[70]),d[74].set("epoch_anon_id",d[69]),d[75]=(d[60].push(d[74]),d[60])):0,d[66]=!0):(d[67]=d[64].get("errors"),d[68]=d[64].get("errors"),d[66]=!1),d[58]=d[60]}])},function(a){return d[59]=c.i64.of_int32(d[58].length),c.i64.gt(d[59],c.i64.cast([0,0]))?(d[60]=d[47].get("epoch_anon_id"),d[41].set(c.blobs.to_string(d[60]),d[58])):0,d[51]=d[58]}])},function(e){return d[52]=d[47].get("value"),d[53]=d[47].get("encryption_version"),c.storedProcedure(b("LSDecryptMessageV2"),d[52],a[1],d[53],d[51]).then(function(a){return a=a,d[54]=a[0],d[55]=a[1],a})},function(a){return d[54]!==void 0?c.resolve((d[56]=d[47].get("otid"),d[57]=d[47].get("message_tags"),d[58]=new c.Map(),d[58].set("value",d[54]),d[58].set("otid",d[56]),d[58].set("message_tags",d[57]),d[59]=(d[39].push(d[58]),d[39]))):c.sequence([function(a){return d[55]!==void 0?c.sequence([function(a){return d[56]=c.i64.of_int32(d[51].length),c.i64.gt(d[56],c.i64.cast([0,0]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[51],c.i64.cast([0,0])).then(function(a){return a=a,d[66]=a[0],d[67]=a[1],a})},function(a){return d[68]=d[66].get("epoch_root_key"),d[69]=c.createArray(),d[74]=(d[69].push(c.i64.cast([0,18])),d[69]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[68],d[69]).then(function(a){return a=a,d[70]=a[0],a})},function(a){return d[70]!==void 0?c.sequence([function(a){return d[74]=c.i64.of_int32(d[70].length),c.i64.ge(d[74],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[70],c.i64.cast([0,0])).then(function(a){return a=a,d[76]=a[0],d[77]=a[1],a})},function(a){return d[75]=d[76]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[77]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[77]].join("")),d[76]=c.createArray(),void 0!==void 0?d[78]=(d[76].push(void 0),d[76]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[77],d[76],c.i64.cast([0,3]))},function(a){return d[75]=void 0}])},function(a){return d[71]=d[75]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[75]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[75]].join("")),d[74]=c.createArray(),void 0!==void 0?d[76]=(d[74].push(void 0),d[74]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[75],d[74],c.i64.cast([0,3]))},function(a){return d[71]=void 0}])},function(a){return c.blobs.neq(d[71],void 0)?d[72]=!0:d[72]=!1,d[72]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.blobs.neq(d[71],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[71]).then(function(a){return a=a,d[74]=a[0],a})},function(a){return d[73]=d[74]==null?"[encodingFailed]":d[74]}]):c.resolve(d[73]="[null]")},function(a){return d[57]=d[73]}]):c.resolve(d[57]="[noEpochs]")},function(a){return d[58]=d[47].get("otid"),d[59]=d[47].get("epoch_anon_id"),d[60]=d[47].get("encryption_version"),c.i64.neq(d[60],void 0)?d[61]=c.i64.to_string(d[60]):d[61]="null",d[62]=c.i64.of_int32(d[51].length),d[63]=d[47].get("epoch_fingerprint"),c.blobs.neq(d[63],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[63]).then(function(a){return a=a,d[66]=a[0],a})},function(a){return d[64]=d[66]==null?"[encodingFailed]":d[66]}]):c.resolve(d[64]="[null]")},function(a){return d[65]="",d[55].set("error_message",["Decryption failed for message with otid:",d[65],d[58],d[65]," epoch:",d[65],c.blobs.to_string(d[59]),d[65]," version:",d[65],d[61],d[65]," epoch_key_count:",d[65],c.i64.to_string(d[62]),d[65]," vsr_fingerprint:",d[65],d[64],d[65]," local_fingerprint:",d[65],d[57],d[65]," local_backup_id:",d[65],c.i64.to_string(d[15]),d[65]," local_device_id:",d[65],c.i64.to_string(d[27])].join(""))}]):c.resolve()},function(a){return d[56]=(d[40].push(d[55]),d[40])}])}])}):c.resolve()},function(a){return d[43]=c.i64.of_int32(d[40].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[40],c.i64.cast([0,0])).then(function(a){return a=a,d[46]=a[0],d[47]=a[1],a})},function(a){return a=[void 0,d[46]],d[44]=a[0],d[45]=a[1],a}]):c.resolve((a=[d[39],void 0],d[44]=a[0],d[45]=a[1],a))},function(a){return a=[d[44],d[45]],d[33]=a[0],d[34]=a[1],a}]):c.resolve((d[35]=new c.Map(),d[35].set("error_code",c.i64.cast([0,24])),d[35].set("stored_procedure","LSEncryptedBackupsDecryptMessagesStoredProcedure"),d[35].set("error_message",""),e=[void 0,d[35]],d[33]=e[0],d[34]=e[1],e))},function(a){return a=[d[33],d[34]],d[7]=a[0],d[8]=a[1],a}]):c.resolve((d[15]=d[5].get("errors"),d[16]=d[5].get("errors"),d[17]=new c.Map(),d[17].set("error_code",c.i64.cast([0,1])),d[17].set("stored_procedure","LSEncryptedBackupsDecryptMessagesStoredProcedure"),d[17].set("error_message",""),e=[void 0,d[17]],d[7]=e[0],d[8]=e[1],e))},function(a){return d[9]=c.i64.of_float(Date.now()),d[10]=c.i64.random(),d[12]="Finishing execution. Execution time: ",d[13]=c.i64.to_string(c.i64.sub(d[9],d[0])),d[14]=" ms",d[11]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][decryptMessages] ",d[11],d[12],d[11],d[13],d[11],d[14]].join("")),c.i64.eq(c.i64.mod_(d[10],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[15]=",",d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"decryptMessages",[d[12],d[15],d[13],d[15],d[14]].join(""),d[16],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[7],d[8]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDecryptMessagesStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSDecryptMessagesStoredProcedure",["LSDecryptMessages","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSDecryptMessages"),e.encryptedMessages,e.actThreadId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSGetNextEpochAnonId.nop",["CryptoLogger","LSCryptoUtils","LSResult","Promise","XPlatReactTextDecoder"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e,f){a=d("LSCryptoUtils").strToBuf("0");if(f!=null){e=f;if(e.byteLength===0)f=a;else{var g=new(d("XPlatReactTextDecoder").TextDecoder)();g=g.decode(e);e=Number.parseInt(g,10);g=e+1;f=d("LSCryptoUtils").strToBuf(String(g))}}else f=a;return(h||(h=b("Promise"))).resolve(c("LSResult")(f))["catch"](function(a){d("CryptoLogger").captureError(d("CryptoLogger").CryptoLogger("get_next_epoch_anonid"),a).mustfix("Getting next epoch anon id failed");throw a})};a.__nop_name__="LSGetNextEpochAnonId";g["default"]=a}),98);
__d("PublicKeyEncryptionUtils",["Promise","UInt8Array","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){}function c(a){if(a!=null)return a;else return new Uint8Array(0).buffer}function e(a,b,c,e,f){return d("UInt8Array").concatBytes([a,b,c,e,f]).buffer}function f(a,b,c,e){return d("XPlatReactCrypto").subtleImportKey("raw",a.buffer,"HKDF",!1,["deriveKey"]).then(function(a){return d("XPlatReactCrypto").subtleDeriveKey({hash:"SHA-256",info:c,name:"HKDF",salt:b},a,{length:256,name:"AES-GCM"},!1,[e])})}var i="key length is not "+32;function j(a,b){if(a.length!==32)return b(i)}function k(a){return new(h||(h=b("Promise")))(function(b,c){j(a,c);return b()})}var l=32;g.assertValidCurvePoint=a;g.getSalt=c;g.concatAad=e;g.getAesKey=f;g.testKeyLength=j;g.assertKeyLength=k;g.keyLength=l}),98);
__d("PublicEncryptionCreateDecryptedData",["CryptoLogger","Promise","PublicKeyEncryptionUtils","RetUtil","XPlatReactCrypto","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("PublicKeyCrypto").__setRef("PublicEncryptionCreateDecryptedData"),j=c("requireDeferred")("X25519").__setRef("PublicEncryptionCreateDecryptedData");function k(a,b){var c=1+d("PublicKeyEncryptionUtils").keyLength+16;a=a.length;a<1+d("PublicKeyEncryptionUtils").keyLength+16&&b("CipherText length is "+a+", < "+c)}function l(a,b,c){b=b[0];if(b!==a)return c("Unexpected version "+b)}function m(a){return new(h||(h=b("Promise")))(function(b,c){l(1,a,c);k(a,c);return b()})}function n(a,c){return new(h||(h=b("Promise")))(function(b,e){d("PublicKeyEncryptionUtils").assertValidCurvePoint(a,e);d("PublicKeyEncryptionUtils").assertValidCurvePoint(c,e);return b()})}function a(a,c,e,f,g,k){var l=new Uint8Array(g),o=new Uint8Array([1]),p=d("PublicKeyEncryptionUtils").getSalt(f),q=new Uint8Array(a),r=new Uint8Array(e),s=new Uint8Array(c),t=new Uint8Array(k);return(h||(h=b("Promise"))).all([d("PublicKeyEncryptionUtils").assertKeyLength(q),d("PublicKeyEncryptionUtils").assertKeyLength(s),d("PublicKeyEncryptionUtils").assertKeyLength(r)]).then(function(){return m(t)}).then(function(){return j.load()}).then(function(a){var c=t.slice(1,d("PublicKeyEncryptionUtils").keyLength+1),e=a.publicKeyFromBytes(c,a.KeyPurpose.Encryption);return n(e,r).then(function(){var f=d("PublicKeyEncryptionUtils").concatAad(o,r,q,c,l),g=function(c,d,f){c=a.publicKeyFromBytes(c,a.KeyPurpose.Encryption);d=a.publicKeyFromBytes(d,a.KeyPurpose.Encryption);f=a.secretKeyFromBytes(f,a.KeyPurpose.Encryption);return c==null||d==null||f==null||e==null?(h||(h=b("Promise"))).resolve():(h||(h=b("Promise"))).resolve([c,d,f,e])};return g(q,r,s).then(function(a){if(a==null)return;return{ephemeralPub:a[3],innerAad:f,receiverPriv:a[2],receiverPub:a[0],senderPub:a[1]}})})}).then(function(a){if(a==null)return;var b=a.ephemeralPub,c=a.receiverPriv,e=a.senderPub,f=a.innerAad;return i.load().then(function(a){return a.receiverDeriveSharedSecret(c,b,e)}).then(function(a){if(a==null)return null;else return d("PublicKeyEncryptionUtils").getAesKey(a,p,f,"decrypt")}).then(function(a){if(a==null)return;var b=new Uint8Array(12).buffer,c=t.slice(d("PublicKeyEncryptionUtils").keyLength+1).buffer;return d("XPlatReactCrypto").subtleDecrypt({additionalData:f,iv:new Uint8Array(b),name:"AES-GCM",tagLength:128},a,c)})}).then(function(a){return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult(a))})["catch"](function(a){var c=d("CryptoLogger").CryptoLogger("public_encryption_create_decrypted_data");d("CryptoLogger").captureError(c,a).mustfix("Creation of decrypted data for public encryption failed");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult(void 0))})}g["default"]=a}),98);
__d("LSPublicEncryptionCreateDecryptedData.nop",["PublicEncryptionCreateDecryptedData"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,d,e,f,g,h,i){return c("PublicEncryptionCreateDecryptedData")(d,e,f,g,h,i)};a.__nop_name__="LSPublicEncryptionCreateDecryptedData";g["default"]=a}),98);
__d("LSRecordEpochSyncStatus",["LSArrayGetObjectAt","LSBase64Encode.nop","LSIssueNewEbTaskAndGetTaskIDV2"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return a[7]?c.sequence([function(e){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsRecordEpochSyncStatusStoredProcedure] Issue record epoch sync task"),d[0]=c.createArray(),d[1]=c.i64.of_int32(a[6].length),c.i64.gt(d[1],c.i64.cast([0,0]))?c.loopAsync(d[1],function(e){return d[5]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[6],d[5]).then(function(a){return a=a,d[6]=a[0],d[7]=a[1],a})},function(a){return d[8]=d[6].get("from"),d[9]=d[6].get("to"),d[10]=d[8].get("epoch_anon_id"),c.nativeOperation(b("LSBase64Encode.nop"),d[10]).then(function(a){return a=a,d[11]=a[0],a})},function(a){return d[11]!==void 0?d[12]=d[11]:d[12]="",d[13]=d[8].get("epoch_id"),d[14]=new c.Map(),d[14].set("anon_id",d[12]),d[14].set("epoch_id",d[13]),d[15]=d[9].get("epoch_anon_id"),c.nativeOperation(b("LSBase64Encode.nop"),d[15]).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]!==void 0?d[17]=d[16]:d[17]="",d[18]=d[9].get("epoch_id"),d[19]=new c.Map(),d[19].set("anon_id",d[17]),d[19].set("epoch_id",d[18]),d[20]=d[6].get("has_forward_edge"),d[21]=d[6].get("has_backward_edge"),d[22]=d[6].get("result_code"),d[23]=d[6].get("error_message"),d[24]=new c.Map(),d[24].set("from",d[14]),d[24].set("to",d[19]),d[24].set("has_forward_edge",d[20]),d[24].set("has_backward_edge",d[21]),d[24].set("result_code",d[22]),d[24].set("error_message",d[23]),d[25]=(d[0].push(d[24]),d[0])}])}):c.resolve()},function(e){return d[2]=new c.Map(),d[2].set("local_device_id",a[0]),d[2].set("decryption_device_id",a[1]),d[2].set("target_device_id",a[2]),d[2].set("epoch_sync_reason",a[3]),d[2].set("start_ms",a[4]),d[2].set("end_ms",a[5]),d[2].set("results",d[0]),d[3]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"meb_record_epoch_sync",c.i64.cast([0,50039]),d[3],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[4]=a[0],a})}]):c.sequence([function(e){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsRecordEpochSyncStatusStoredProcedure] Issue record epoch sync task"),d[0]=c.createArray(),d[1]=c.i64.of_int32(a[6].length),c.i64.gt(d[1],c.i64.cast([0,0]))?c.loopAsync(d[1],function(e){return d[5]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[6],d[5]).then(function(a){return a=a,d[6]=a[0],d[7]=a[1],a})},function(a){return d[8]=d[6].get("from"),d[9]=d[6].get("to"),d[10]=d[8].get("epoch_anon_id"),c.nativeOperation(b("LSBase64Encode.nop"),d[10]).then(function(a){return a=a,d[11]=a[0],a})},function(a){return d[11]!==void 0?d[12]=d[11]:d[12]="",d[13]=d[8].get("epoch_id"),d[14]=new c.Map(),d[14].set("anon_id",d[12]),d[14].set("epoch_id",d[13]),d[15]=d[9].get("epoch_anon_id"),c.nativeOperation(b("LSBase64Encode.nop"),d[15]).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]!==void 0?d[17]=d[16]:d[17]="",d[18]=d[9].get("epoch_id"),d[19]=new c.Map(),d[19].set("anon_id",d[17]),d[19].set("epoch_id",d[18]),d[20]=d[6].get("has_forward_edge"),d[21]=d[6].get("has_backward_edge"),d[22]=d[6].get("result_code"),d[23]=d[6].get("error_message"),d[24]=new c.Map(),d[24].set("from",d[14]),d[24].set("to",d[19]),d[24].set("has_forward_edge",d[20]),d[24].set("has_backward_edge",d[21]),d[24].set("result_code",d[22]),d[24].set("error_message",d[23]),d[25]=(d[0].push(d[24]),d[0])}])}):c.resolve()},function(e){return d[2]=new c.Map(),d[2].set("local_device_id",a[0]),d[2].set("decryption_device_id",a[1]),d[2].set("target_device_id",a[2]),d[2].set("epoch_sync_reason",a[3]),d[2].set("start_ms",a[4]),d[2].set("end_ms",a[5]),d[2].set("results",d[0]),d[3]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"meb_record_epoch_sync",c.i64.cast([0,50039]),d[3],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[4]=a[0],a})}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsRecordEpochSyncStatusStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSStoreEpoch",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.sequence([function(d){return c[1]="Storing newly derived epoch ",c[2]=b.blobs.to_string(a[2]),c[3]=" authority_level:",c[4]=b.i64.to_string(a[5]),c[5]=" status:",c[6]=b.i64.to_string(a[4]),c[0]="",function(a){b.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsStoreEpochStoredProcedure] ",c[0],c[1],c[0],c[2],c[0],c[3],c[0],c[4],c[0],c[5],c[0],c[6]].join("")),b.resolve()},function(c){return a[6]?(function(a){b.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsStoreEpochStoredProcedure] Storing epoch in epochs table (regular execution)"),b.filter(b.db.table(169).fetch([[[a[0]]]]),function(c){return b.i64.eq(c.epochId,a[0])&&b.i64.gt(c.authorityLevel,a[5])}).next().then(function(c){var d=c.done;c.value;return d?b.db.table(169).put({epochId:a[0],backupId:a[1],epochAnonIdBlob:a[2],epochRootKeyBlob:a[3],epochStatus:a[4],authorityLevel:a[5]}):0})):(function(a){b.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsStoreEpochStoredProcedure] Storing epoch in epochs table (regular execution)"),b.filter(b.db.table(169).fetch([[[a[0]]]]),function(c){return b.i64.eq(c.epochId,a[0])&&b.i64.gt(c.authorityLevel,a[5])}).next().then(function(c){var d=c.done;c.value;return d?b.db.table(169).put({epochId:a[0],backupId:a[1],epochAnonIdBlob:a[2],epochRootKeyBlob:a[3],epochStatus:a[4],authorityLevel:a[5]}):0}))}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSEncryptedBackupsStoreEpochStoredProcedure";a.__tables__=["secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSDeriveAndStoreEpochs",["LSArrayGetObjectAt","LSBase64Decode.nop","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSGetNextEpochAnonId.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop","LSPublicEncryptionCreateDecryptedData.nop","LSRecordEpochSyncStatus","LSStoreEpoch","LSSymmetricEncryptionCreateDecryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure] Beginning execution."),d[1]=c.i64.of_int32(a[0].length),c.i64.gt(d[1],c.i64.cast([0,0]))?c.sequence([function(a){return d[8]=c.i64.random(),d[25]=c.i64.to_string(d[8]),d[9]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[26]=new c.Map(),d[26].set("error_msg","Expected a nonempty query result"),d[26].set("code",c.i64.cast([0,3])),d[26].set("src_line","MEBClientStateUtils.php:244 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[27]=c.createArray(),d[28]=(d[27].push(d[26]),d[27]),e=[void 0,d[27]],d[10]=e[0],d[11]=e[1],e):(b=a.item,d[26]=new c.Map(),d[26].set("backup_id",b.backupId),d[26].set("device_public_key_blob",b.devicePublicKeyBlob),d[26].set("device_private_key_blob",b.devicePrivateKeyBlob),d[26].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[26].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[26].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[26].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[26].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[26].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[26].set("orf_client_state_v2_blob",void 0),d[26].set("orf_v2_authority_level",void 0),d[26].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[26].set("device_id",b.deviceId),d[26].set("backup_tenancy",b.backupTenancy),d[26].set("encryption_version",b.encryptionVersion),d[26].set("revision_version",b.revisionVersion),d[26].set("initialize_restore_result",void 0),d[26].set("authority_level",b.authorityLevel),e=[d[26],void 0],d[10]=e[0],d[11]=e[1],e)})},function(e){return d[13]=new c.Map(),d[13].set("value",d[10]),d[13].set("errors",d[11]),d[14]=d[13].get("value"),d[14]!==void 0?c.sequence([function(e){return d[26]=d[14].get("backup_id"),d[27]=d[14].get("device_public_key_blob"),d[28]=d[14].get("device_private_key_blob"),d[29]=d[14].get("epoch_storage_public_key_blob"),d[30]=d[14].get("epoch_storage_private_key_blob"),d[31]=d[14].get("epoch_auth_public_key_blob"),d[32]=d[14].get("epoch_auth_private_key_blob"),d[33]=d[14].get("mailbox_root_key_blob"),d[34]=d[14].get("ocmf_client_state_blob"),d[35]=d[14].get("orf_client_state_v2_blob"),d[36]=d[14].get("orf_v2_authority_level"),d[37]=d[14].get("oblivious_validation_token_blob"),d[38]=d[14].get("device_id"),d[39]=d[14].get("backup_tenancy"),d[40]=d[14].get("encryption_version"),d[41]=d[14].get("revision_version"),d[42]=d[14].get("initialize_restore_result"),d[43]=d[14].get("authority_level"),c.i64.neq(d[38],void 0)?c.sequence([function(a){return d[53]=void 0,c.i64.neq(d[53],void 0)?c.resolve(d[54]=d[53]):c.sequence([function(a){return d[67]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[68]=a[0],a})},function(a){return d[68]?d[77]=(d[67].push(c.i64.cast([0,0])),d[67]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[69]=a[0],a})},function(a){return d[69]?d[77]=(d[67].push(c.i64.cast([0,2])),d[67]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[70]=a[0],a})},function(a){return d[70]?d[77]=(d[67].push(c.i64.cast([0,3])),d[67]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[71]=a[0],a})},function(a){return d[71]?d[77]=(d[67].push(c.i64.cast([0,4])),d[67]):0,d[72]=c.createArray(),d[73]=c.i64.of_int32(d[67].length),c.i64.gt(d[73],c.i64.cast([0,0]))?c.loopAsync(d[73],function(a){return d[77]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[67],d[77]).then(function(a){return a=a,d[78]=a[0],d[79]=a[1],a})},function(a){return d[80]=(d[72].push(d[78]),d[72])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[77]=c.createArray(),d[78]=c.i64.of_int32(d[72].length),c.i64.gt(d[78],c.i64.cast([0,0]))?c.loopAsync(d[78],function(a){return d[80]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[72],d[80]).then(function(a){return a=a,d[81]=a[0],d[82]=a[1],a})},function(a){return d[83]=(d[77].push(c.i64.to_string(d[81])),d[77])}])}):c.resolve()},function(a){return d[79]=d[77].join(","),d[74]=d[79]}])},function(a){return d[72].some(function(a){return c.i64.eq(d[40],a)})?d[75]=d[40]:d[75]=void 0,c.i64.neq(d[75],void 0)?d[76]=d[75]:d[76]=void 0,d[54]=d[76]}])},function(e){return c.i64.neq(d[54],void 0)?d[55]=d[54]:d[55]=c.i64.cast([0,0]),c.i64.neq(d[39],void 0)?d[56]=d[39]:d[56]=c.i64.cast([0,1]),c.i64.neq(a[1],void 0)?c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[73]=new c.Map(),d[73].set("error_msg","Expected a nonempty query result"),d[73].set("code",c.i64.cast([0,3])),d[73].set("src_line","MEBClientStateUtils.php:244 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[74]=c.createArray(),d[75]=(d[74].push(d[73]),d[74]),e=[void 0,d[74]],d[67]=e[0],d[68]=e[1],e):(b=a.item,d[73]=new c.Map(),d[73].set("backup_id",b.backupId),d[73].set("device_public_key_blob",b.devicePublicKeyBlob),d[73].set("device_private_key_blob",b.devicePrivateKeyBlob),d[73].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[73].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[73].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[73].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[73].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[73].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[73].set("orf_client_state_v2_blob",void 0),d[73].set("orf_v2_authority_level",void 0),d[73].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[73].set("device_id",b.deviceId),d[73].set("backup_tenancy",b.backupTenancy),d[73].set("encryption_version",b.encryptionVersion),d[73].set("revision_version",b.revisionVersion),d[73].set("initialize_restore_result",void 0),d[73].set("authority_level",b.authorityLevel),e=[d[73],void 0],d[67]=e[0],d[68]=e[1],e)})},function(e){return d[70]=new c.Map(),d[70].set("value",d[67]),d[70].set("errors",d[68]),d[71]=d[70].get("value"),d[71]!==void 0?c.sequence([function(e){return d[73]=d[71].get("backup_id"),d[74]=d[71].get("device_public_key_blob"),d[75]=d[71].get("device_private_key_blob"),d[76]=d[71].get("epoch_storage_public_key_blob"),d[77]=d[71].get("epoch_storage_private_key_blob"),d[78]=d[71].get("epoch_auth_public_key_blob"),d[79]=d[71].get("epoch_auth_private_key_blob"),d[80]=d[71].get("mailbox_root_key_blob"),d[81]=d[71].get("ocmf_client_state_blob"),d[82]=d[71].get("orf_client_state_v2_blob"),d[83]=d[71].get("orf_v2_authority_level"),d[84]=d[71].get("oblivious_validation_token_blob"),d[85]=d[71].get("device_id"),d[86]=d[71].get("backup_tenancy"),d[87]=d[71].get("encryption_version"),d[88]=d[71].get("revision_version"),d[89]=d[71].get("initialize_restore_result"),d[90]=d[71].get("authority_level"),c.i64.neq(d[85],void 0)?c.sequence([function(a){return d[92]=void 0,c.i64.neq(d[92],void 0)?c.resolve(d[93]=d[92]):c.sequence([function(a){return d[96]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[97]=a[0],a})},function(a){return d[97]?d[106]=(d[96].push(c.i64.cast([0,0])),d[96]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[98]=a[0],a})},function(a){return d[98]?d[106]=(d[96].push(c.i64.cast([0,2])),d[96]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[99]=a[0],a})},function(a){return d[99]?d[106]=(d[96].push(c.i64.cast([0,3])),d[96]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[100]=a[0],a})},function(a){return d[100]?d[106]=(d[96].push(c.i64.cast([0,4])),d[96]):0,d[101]=c.createArray(),d[102]=c.i64.of_int32(d[96].length),c.i64.gt(d[102],c.i64.cast([0,0]))?c.loopAsync(d[102],function(a){return d[106]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[96],d[106]).then(function(a){return a=a,d[107]=a[0],d[108]=a[1],a})},function(a){return d[109]=(d[101].push(d[107]),d[101])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[106]=c.createArray(),d[107]=c.i64.of_int32(d[101].length),c.i64.gt(d[107],c.i64.cast([0,0]))?c.loopAsync(d[107],function(a){return d[109]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[101],d[109]).then(function(a){return a=a,d[110]=a[0],d[111]=a[1],a})},function(a){return d[112]=(d[106].push(c.i64.to_string(d[110])),d[106])}])}):c.resolve()},function(a){return d[108]=d[106].join(","),d[103]=d[108]}])},function(a){return d[101].some(function(a){return c.i64.eq(d[87],a)})?d[104]=d[87]:d[104]=void 0,c.i64.neq(d[104],void 0)?d[105]=d[104]:d[105]=void 0,d[93]=d[105]}])},function(b){return c.i64.neq(d[93],void 0)?d[94]=d[93]:d[94]=c.i64.cast([0,0]),c.i64.neq(d[86],void 0)?d[95]=d[86]:d[95]=c.i64.cast([0,1]),d[91]=c.i64.neq(d[85],a[1])}]):c.resolve(d[91]=!1)},function(a){return d[72]=d[91]}]):c.resolve((d[73]=d[70].get("errors"),d[74]=d[70].get("errors"),d[72]=!1))},function(a){return d[57]=d[72]}]):c.resolve(d[57]=!1)},function(e){return d[57]?c.sequence([function(e){return d[67]=c.createArray(),d[68]=c.i64.of_int32(a[0].length),c.i64.gt(d[68],c.i64.cast([0,0]))?c.loopAsync(d[68],function(e){return d[69]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[69]).then(function(a){return a=a,d[70]=a[0],d[71]=a[1],a})},function(a){return d[72]=d[70].get("from_epoch"),d[73]=d[72].get("epoch_anon_id"),d[74]=d[70].get("from_epoch"),d[75]=d[74].get("epoch_id"),d[76]=new c.Map(),d[76].set("epoch_anon_id",d[73]),d[76].set("epoch_id",d[75]),d[77]=d[70].get("to_epoch"),d[78]=d[77].get("epoch_anon_id"),d[79]=d[70].get("to_epoch"),d[80]=d[79].get("epoch_id"),d[81]=new c.Map(),d[81].set("epoch_anon_id",d[78]),d[81].set("epoch_id",d[80]),d[82]=d[70].get("forward_edge"),d[82]?d[83]=!1:d[83]=!0,d[83]?d[84]=!1:d[84]=!0,d[85]=d[70].get("backward_edge"),c.blobs.neq(d[85],void 0)?d[86]=!0:d[86]=!1,d[87]=new c.Map(),d[87].set("from",d[76]),d[87].set("to",d[81]),d[87].set("has_forward_edge",d[84]),d[87].set("has_backward_edge",d[86]),d[87].set("result_code",c.i64.cast([0,8])),d[87].set("error_message",void 0),d[88]=(d[67].push(d[87]),d[67])}])}):c.resolve()},function(b){return b=[d[38],d[38],a[1],a[2],c.i64.cast([0,0]),c.i64.cast([0,0]),d[67],!1,void 0],d[58]=b[0],d[59]=b[1],d[60]=b[2],d[61]=b[3],d[62]=b[4],d[63]=b[5],d[64]=b[6],d[65]=b[7],d[66]=b[8],b}]):c.sequence([function(e){return d[67]=c.createArray(),d[68]=c.i64.of_int32(a[0].length),c.i64.gt(d[68],c.i64.cast([0,0]))?c.loopAsync(d[68],function(e){return d[69]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[69]).then(function(a){return a=a,d[70]=a[0],d[71]=a[1],a})},function(a){return d[72]=d[70].get("from_epoch"),d[73]=d[72].get("epoch_id"),c.count(c.db.table(169).fetch([[[d[73]]]])).then(function(a){return d[74]=a})},function(a){return c.i64.le(d[74],c.i64.cast([0,1]))?c.sequence([function(a){return c.db.table(169).fetch([[[d[73]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[102]=new c.Map(),d[102].set("error_msg","Expected a nonempty query result"),d[102].set("code",c.i64.cast([0,3])),d[102].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[103]=c.createArray(),d[104]=(d[103].push(d[102]),d[103]),e=[void 0,d[103]],d[98]=e[0],d[99]=e[1],e):(b=a.item,d[102]=new c.Map(),d[102].set("epoch_id",b.epochId),d[102].set("backup_id",b.backupId),d[102].set("epoch_anon_id_blob",b.epochAnonIdBlob),d[102].set("epoch_root_key_blob",b.epochRootKeyBlob),d[102].set("epoch_status",b.epochStatus),d[102].set("epoch_head",b.epochHead),d[102].set("authority_level",b.authorityLevel),e=[d[102],void 0],d[98]=e[0],d[99]=e[1],e)})},function(a){return d[101]=new c.Map(),d[101].set("value",d[98]),d[101].set("errors",d[99]),d[75]=d[101]}]):c.resolve((d[98]=new c.Map(),d[98].set("error_msg","Expected at most one result"),d[98].set("code",c.i64.cast([0,4])),d[98].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[99]=c.createArray(),d[101]=(d[99].push(d[98]),d[99]),d[100]=new c.Map(),d[100].set("value",void 0),d[100].set("errors",d[99]),d[75]=d[100]))},function(a){return d[76]=d[75].get("value"),d[76]!==void 0?(d[98]=d[76].get("epoch_id"),d[99]=d[76].get("backup_id"),d[100]=d[76].get("epoch_anon_id_blob"),d[101]=d[76].get("epoch_root_key_blob"),d[102]=d[76].get("epoch_status"),d[103]=d[76].get("epoch_head"),d[104]=d[76].get("authority_level"),d[105]=d[75],d[77]=d[105]):(d[98]=d[75].get("errors"),d[99]=d[75].get("errors"),d[100]=new c.Map(),d[100].set("value",void 0),d[100].set("errors",d[98]),d[77]=d[100]),d[78]=d[77].get("value"),d[78]!==void 0?(d[98]=d[78].get("epoch_id"),d[99]=d[78].get("backup_id"),d[100]=d[78].get("epoch_anon_id_blob"),d[101]=d[78].get("epoch_root_key_blob"),d[102]=d[78].get("epoch_status"),d[103]=d[78].get("epoch_head"),d[104]=d[78].get("authority_level"),d[79]=d[77]):(d[98]=d[77].get("errors"),d[99]=d[77].get("errors"),d[100]=new c.Map(),d[100].set("error_msg","EB_EPOCH_SRC_EPOCH_MISSING"),d[100].set("code",c.i64.cast([0,10003])),d[100].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:343 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processEdge()"),d[102]=(d[98].push(d[100]),d[98]),d[101]=new c.Map(),d[101].set("value",void 0),d[101].set("errors",d[98]),d[79]=d[101]),d[80]=d[79].get("value"),d[80]!==void 0?(d[98]=d[80].get("epoch_id"),d[99]=d[80].get("backup_id"),d[100]=d[80].get("epoch_anon_id_blob"),d[101]=d[80].get("epoch_root_key_blob"),d[102]=d[80].get("epoch_status"),d[103]=d[80].get("epoch_head"),d[104]=d[80].get("authority_level"),d[105]=d[70].get("from_epoch"),d[106]=d[105].get("epoch_anon_id"),c.blobs.eq(d[106],d[100])?d[107]=d[79]:(d[108]=new c.Map(),d[108].set("error_msg","EB_EPOCH_DERIVATION_SRC_ANON_ID_MISMATCH"),d[108].set("code",c.i64.cast([0,10007])),d[108].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:348 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processEdge#2()"),d[109]=c.createArray(),d[111]=(d[109].push(d[108]),d[109]),d[110]=new c.Map(),d[110].set("value",void 0),d[110].set("errors",d[109]),d[107]=d[110]),d[81]=d[107]):(d[98]=d[79].get("errors"),d[99]=d[79].get("errors"),d[100]=new c.Map(),d[100].set("value",void 0),d[100].set("errors",d[98]),d[81]=d[100]),d[82]=d[81].get("value"),d[82]!==void 0?c.sequence([function(a){return d[98]=d[82].get("epoch_id"),d[99]=d[82].get("backup_id"),d[100]=d[82].get("epoch_anon_id_blob"),d[101]=d[82].get("epoch_root_key_blob"),d[102]=d[82].get("epoch_status"),d[103]=d[82].get("epoch_head"),d[104]=d[82].get("authority_level"),d[105]=d[70].get("from_epoch_fingerprint"),d[106]=c.createArray(),d[111]=(d[106].push(c.i64.cast([0,18])),d[106]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[101],d[106]).then(function(a){return a=a,d[107]=a[0],a})},function(a){return d[107]!==void 0?c.sequence([function(a){return d[111]=c.i64.of_int32(d[107].length),c.i64.ge(d[111],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[107],c.i64.cast([0,0])).then(function(a){return a=a,d[113]=a[0],d[114]=a[1],a})},function(a){return d[112]=d[113]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[114]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[114]].join("")),d[113]=c.createArray(),void 0!==void 0?d[115]=(d[113].push(void 0),d[113]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[114],d[113],c.i64.cast([0,3]))},function(a){return d[112]=void 0}])},function(a){return d[108]=d[112]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[112]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[112]].join("")),d[111]=c.createArray(),void 0!==void 0?d[113]=(d[111].push(void 0),d[111]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[112],d[111],c.i64.cast([0,3]))},function(a){return d[108]=void 0}])},function(a){return c.blobs.neq(d[108],void 0)?d[109]=!0:d[109]=!1,d[109]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.blobs.eq(d[105],void 0)||c.blobs.eq(d[105],d[108])?d[110]=d[81]:(d[111]=new c.Map(),d[111].set("error_msg","EB_EPOCH_DERIVATION_SRC_FINGERPRINT_MISMATCH"),d[111].set("code",c.i64.cast([0,10002])),d[111].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:357 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processEdge#4()"),d[112]=c.createArray(),d[114]=(d[112].push(d[111]),d[112]),d[113]=new c.Map(),d[113].set("value",void 0),d[113].set("errors",d[112]),d[110]=d[113]),d[83]=d[110]}]):c.resolve((d[98]=d[81].get("errors"),d[99]=d[81].get("errors"),d[100]=new c.Map(),d[100].set("value",void 0),d[100].set("errors",d[98]),d[83]=d[100]))},function(a){return d[84]=d[70].get("forward_edge"),d[84]!==void 0?c.sequence([function(a){return d[98]=d[83].get("value"),d[98]!==void 0?c.sequence([function(a){return d[112]=d[98].get("epoch_id"),d[113]=d[98].get("backup_id"),d[114]=d[98].get("epoch_anon_id_blob"),d[115]=d[98].get("epoch_root_key_blob"),d[116]=d[98].get("epoch_status"),d[117]=d[98].get("epoch_head"),d[118]=d[98].get("authority_level"),c.nativeOperation(b("LSGetNextEpochAnonId.nop"),d[114]).then(function(a){return a=a,d[119]=a[0],a})},function(a){return d[120]=d[70].get("to_epoch"),d[121]=d[120].get("epoch_anon_id"),c.blobs.eq(d[119],d[121])?d[122]=d[83]:(d[123]=new c.Map(),d[123].set("error_msg","EB_EPOCH_FORWARD_EDGE_NOT_CONSECUTIVE"),d[123].set("code",c.i64.cast([0,10009])),d[123].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:114 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processForwardEdge()"),d[124]=c.createArray(),d[126]=(d[124].push(d[123]),d[124]),d[125]=new c.Map(),d[125].set("value",void 0),d[125].set("errors",d[124]),d[122]=d[125]),d[99]=d[122]}]):c.resolve((d[112]=d[83].get("errors"),d[113]=d[83].get("errors"),d[114]=new c.Map(),d[114].set("value",void 0),d[114].set("errors",d[112]),d[99]=d[114]))},function(a){return d[100]=d[99].get("value"),d[100]!==void 0?c.sequence([function(a){return d[112]=d[100].get("epoch_id"),d[113]=d[100].get("backup_id"),d[114]=d[100].get("epoch_anon_id_blob"),d[115]=d[100].get("epoch_root_key_blob"),d[116]=d[100].get("epoch_status"),d[117]=d[100].get("epoch_head"),d[118]=d[100].get("authority_level"),d[119]=d[70].get("from_epoch"),d[120]=d[119].get("epoch_anon_id"),d[121]=d[70].get("from_epoch"),d[122]=d[121].get("epoch_id"),d[123]=c.createArray(),d[132]=(d[123].push(c.i64.cast([0,32])),d[123]),d[132]=(d[123].push(c.i64.cast([0,32])),d[123]),d[124]="_",c.nativeOperation(b("LSGetBlobFromString.nop"),["epoch_chaining",d[124],c.blobs.to_string(d[120]),d[124],c.i64.to_string(d[122])].join("")).then(function(a){return a=a,d[125]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[125],void 0,d[115],d[123]).then(function(a){return a=a,d[126]=a[0],a})},function(a){return d[126]?d[127]=!1:d[127]=!0,d[127]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] Failed to generate epoch_chaining_key and epoch_distribution_pre_shared_key."),d[133]="Failed to generate epoch_chaining_key and epoch_distribution_pre_shared_key.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[133]].join("")),d[132]=c.createArray(),void 0!==void 0?d[136]=(d[132].push(void 0),d[132]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[133],d[132],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[134]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[135]=a[0],a})},function(a){return a=[d[134],d[135]],d[128]=a[0],d[129]=a[1],a}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[126],c.i64.cast([0,0])).then(function(a){return a=a,d[132]=a[0],d[133]=a[1],a})},function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[126],c.i64.cast([0,1])).then(function(a){return a=a,d[134]=a[0],d[135]=a[1],a})},function(a){return a=[d[132],d[134]],d[128]=a[0],d[129]=a[1],a}])},function(a){return d[130]=new c.Map(),d[130].set("epoch_chaining_key",d[128]),d[130].set("epoch_distribution_pre_shared_key",d[129]),d[131]=new c.Map(),d[131].set("value",d[130]),d[131].set("errors",void 0),d[101]=d[131]}]):c.resolve((d[112]=d[99].get("errors"),d[113]=d[99].get("errors"),d[114]=new c.Map(),d[114].set("value",void 0),d[114].set("errors",d[112]),d[101]=d[114]))},function(a){return d[102]=d[101].get("value"),d[102]!==void 0?c.sequence([function(a){return d[112]=d[102].get("epoch_chaining_key"),d[113]=d[102].get("epoch_distribution_pre_shared_key"),d[114]=d[84].get("psk_fingerprint"),d[115]=c.createArray(),d[120]=(d[115].push(c.i64.cast([0,18])),d[115]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkNyeXB0b1ByZVNoYXJlZEtleQ=="),void 0,d[113],d[115]).then(function(a){return a=a,d[116]=a[0],a})},function(a){return d[116]!==void 0?c.sequence([function(a){return d[120]=c.i64.of_int32(d[116].length),c.i64.ge(d[120],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[116],c.i64.cast([0,0])).then(function(a){return a=a,d[122]=a[0],d[123]=a[1],a})},function(a){return d[121]=d[122]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[123]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[123]].join("")),d[122]=c.createArray(),void 0!==void 0?d[124]=(d[122].push(void 0),d[122]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[123],d[122],c.i64.cast([0,3]))},function(a){return d[121]=void 0}])},function(a){return d[117]=d[121]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[121]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[121]].join("")),d[120]=c.createArray(),void 0!==void 0?d[122]=(d[120].push(void 0),d[120]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[121],d[120],c.i64.cast([0,3]))},function(a){return d[117]=void 0}])},function(a){return c.blobs.neq(d[117],void 0)?d[118]=!0:d[118]=!1,d[118]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.blobs.eq(d[114],void 0)||c.blobs.eq(d[114],d[117])?d[119]=d[101]:(d[120]=new c.Map(),d[120].set("error_msg","EB_EPOCH_DERIVATION_PSK_FINGERPRINT_MISMATCH"),d[120].set("code",c.i64.cast([0,10005])),d[120].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:140 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processForwardEdge#4()"),d[121]=c.createArray(),d[123]=(d[121].push(d[120]),d[121]),d[122]=new c.Map(),d[122].set("value",void 0),d[122].set("errors",d[121]),d[119]=d[122]),d[103]=d[119]}]):c.resolve((d[112]=d[101].get("errors"),d[113]=d[101].get("errors"),d[114]=new c.Map(),d[114].set("value",void 0),d[114].set("errors",d[112]),d[103]=d[114]))},function(a){return d[104]=d[103].get("value"),d[104]!==void 0?(d[112]=d[104].get("epoch_chaining_key"),d[113]=d[104].get("epoch_distribution_pre_shared_key"),d[114]=d[84].get("epoch_storage_public_key"),c.blobs.eq(d[114],void 0)||c.blobs.eq(d[114],d[29])?d[115]=d[103]:(d[116]=new c.Map(),d[116].set("error_msg","EB_EPOCH_DERIVATION_STORAGE_KEY_MISMATCH"),d[116].set("code",c.i64.cast([0,10006])),d[116].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:154 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processForwardEdge#7()"),d[117]=c.createArray(),d[119]=(d[117].push(d[116]),d[117]),d[118]=new c.Map(),d[118].set("value",void 0),d[118].set("errors",d[117]),d[115]=d[118]),d[105]=d[115]):(d[112]=d[103].get("errors"),d[113]=d[103].get("errors"),d[114]=new c.Map(),d[114].set("value",void 0),d[114].set("errors",d[112]),d[105]=d[114]),d[106]=d[105].get("value"),d[106]!==void 0?c.sequence([function(a){return d[112]=d[106].get("epoch_chaining_key"),d[113]=d[106].get("epoch_distribution_pre_shared_key"),d[114]=d[84].get("auth_public_key"),d[115]=d[70].get("to_epoch"),d[116]=d[115].get("epoch_anon_id"),d[117]=d[84].get("encrypted_entropy"),c.nativeOperation(b("LSPublicEncryptionCreateDecryptedData.nop"),d[29],d[30],d[114],d[113],c.blobs.of_string(["epoch_","_",c.blobs.to_string(d[116])].join("")),d[117]).then(function(a){return a=a,d[118]=a[0],a})},function(a){return c.blobs.neq(d[118],void 0)?c.resolve(d[119]=d[118]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] Couldn't decrypt epoch key. Returning null entropy"),d[126]="Couldn't decrypt epoch key. Returning null entropy",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[126]].join("")),d[125]=c.createArray(),void 0!==void 0?d[127]=(d[125].push(void 0),d[125]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[126],d[125],c.i64.cast([0,3]))},function(a){return d[119]=void 0}])},function(a){return c.blobs.neq(d[119],void 0)?(d[125]=new c.Map(),d[125].set("entropy",d[119]),d[126]=new c.Map(),d[126].set("value",d[125]),d[126].set("errors",void 0),d[127]=d[126].get("value"),d[128]=d[126].get("errors"),a=[d[127],d[128]],d[120]=a[0],d[121]=a[1],a):(d[125]=c.createArray(),c.blobs.eq(d[119],void 0)?d[132]=(d[125].push("entropy"),d[125]):0,d[126]=d[125].join(", "),d[127]=new c.Map(),d[127].set("error_msg",["The following required nullables are null: ","",d[126]].join("")),d[127].set("code",c.i64.cast([0,2])),d[127].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:179 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processForwardEdge#11()"),d[128]=c.createArray(),d[132]=(d[128].push(d[127]),d[128]),d[129]=new c.Map(),d[129].set("value",void 0),d[129].set("errors",d[128]),d[130]=d[129].get("value"),d[131]=d[129].get("errors"),a=[d[130],d[131]],d[120]=a[0],d[121]=a[1],a),d[122]=new c.Map(),d[122].set("value",d[120]),d[122].set("errors",d[121]),d[123]=d[122].get("value"),d[123]!==void 0?(d[125]=d[123].get("entropy"),d[124]=d[122]):(d[125]=d[122].get("errors"),d[126]=d[122].get("errors"),d[127]=new c.Map(),d[127].set("error_msg","EB_EPOCH_FORWARD_DECRYPTION_FAILED"),d[127].set("code",c.i64.cast([0,10004])),d[127].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:181 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processForwardEdge#10()"),d[129]=(d[125].push(d[127]),d[125]),d[128]=new c.Map(),d[128].set("value",void 0),d[128].set("errors",d[125]),d[124]=d[128]),d[107]=d[124]}]):c.resolve((d[112]=d[105].get("errors"),d[113]=d[105].get("errors"),d[114]=new c.Map(),d[114].set("value",void 0),d[114].set("errors",d[112]),d[107]=d[114]))},function(a){return d[108]=d[105].get("value"),d[108]!==void 0?c.sequence([function(a){return d[112]=d[108].get("epoch_chaining_key"),d[113]=d[108].get("epoch_distribution_pre_shared_key"),d[114]=d[107].get("value"),d[114]!==void 0?c.sequence([function(a){return d[116]=d[114].get("entropy"),d[117]=c.createArray(),d[124]=(d[117].push(c.i64.cast([0,32])),d[117]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_root_key").then(function(a){return a=a,d[118]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[118],d[112],d[116],d[117]).then(function(a){return a=a,d[119]=a[0],a})},function(a){return d[119]?d[120]=!1:d[120]=!0,d[120]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] Unable to generate epoch root key."),d[125]="Unable to generate epoch root key.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[125]].join("")),d[124]=c.createArray(),void 0!==void 0?d[127]=(d[124].push(void 0),d[124]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[125],d[124],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[126]=a[0],a})},function(a){return d[121]=d[126]}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[119],c.i64.cast([0,0])).then(function(a){return a=a,d[124]=a[0],d[125]=a[1],a})},function(a){return d[121]=d[124]}])},function(a){return d[122]=new c.Map(),d[122].set("root_key",d[121]),d[123]=new c.Map(),d[123].set("value",d[122]),d[123].set("errors",void 0),d[115]=d[123]}]):c.resolve((d[116]=d[107].get("errors"),d[117]=d[107].get("errors"),d[118]=new c.Map(),d[118].set("value",void 0),d[118].set("errors",d[116]),d[115]=d[118]))},function(a){return d[109]=d[115]}]):c.resolve((d[112]=d[105].get("errors"),d[113]=d[105].get("errors"),d[114]=new c.Map(),d[114].set("value",void 0),d[114].set("errors",d[112]),d[109]=d[114]))},function(a){return d[110]=d[109].get("value"),d[111]=d[109].get("errors"),a=[d[110],d[111]],d[85]=a[0],d[86]=a[1],a}]):c.sequence([function(a){return d[98]=d[70].get("backward_edge"),c.blobs.neq(d[98],void 0)?c.sequence([function(a){return d[104]=d[83].get("value"),d[104]!==void 0?c.sequence([function(a){return d[112]=d[104].get("epoch_id"),d[113]=d[104].get("backup_id"),d[114]=d[104].get("epoch_anon_id_blob"),d[115]=d[104].get("epoch_root_key_blob"),d[116]=d[104].get("epoch_status"),d[117]=d[104].get("epoch_head"),d[118]=d[104].get("authority_level"),d[119]=d[70].get("to_epoch"),d[120]=d[119].get("epoch_anon_id"),c.nativeOperation(b("LSGetNextEpochAnonId.nop"),d[120]).then(function(a){return a=a,d[121]=a[0],a})},function(a){return c.blobs.eq(d[121],d[114])?d[122]=d[83]:(d[123]=new c.Map(),d[123].set("error_msg","EB_EPOCH_BACKWARD_EDGE_NOT_CONSECUTIVE"),d[123].set("code",c.i64.cast([0,10010])),d[123].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:208 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processBackwardEdge()"),d[124]=c.createArray(),d[126]=(d[124].push(d[123]),d[124]),d[125]=new c.Map(),d[125].set("value",void 0),d[125].set("errors",d[124]),d[122]=d[125]),d[105]=d[122]}]):c.resolve((d[112]=d[83].get("errors"),d[113]=d[83].get("errors"),d[114]=new c.Map(),d[114].set("value",void 0),d[114].set("errors",d[112]),d[105]=d[114]))},function(a){return d[106]=d[105].get("value"),d[106]!==void 0?c.sequence([function(a){return d[112]=d[106].get("epoch_id"),d[113]=d[106].get("backup_id"),d[114]=d[106].get("epoch_anon_id_blob"),d[115]=d[106].get("epoch_root_key_blob"),d[116]=d[106].get("epoch_status"),d[117]=d[106].get("epoch_head"),d[118]=d[106].get("authority_level"),d[119]=c.createArray(),d[124]=(d[119].push(c.i64.cast([0,32])),d[119]),c.nativeOperation(b("LSBase64Encode.nop"),d[114]).then(function(a){return a=a,d[120]=a[0],a})},function(a){return d[120]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blobs.of_string(["epoch_data_storage","_",d[120]].join("")),void 0,d[115],d[119]).then(function(a){return a=a,d[124]=a[0],a})},function(a){return d[124]?d[125]=!1:d[125]=!0,d[125]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),d[128]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[128]].join("")),d[127]=c.createArray(),void 0!==void 0?d[130]=(d[127].push(void 0),d[127]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[128],d[127],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[129]=a[0],a})},function(a){return d[126]=d[129]}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[124],c.i64.cast([0,0])).then(function(a){return a=a,d[127]=a[0],d[128]=a[1],a})},function(a){return d[126]=d[127]}])},function(a){return d[121]=d[126]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),d[125]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[125]].join("")),d[124]=c.createArray(),void 0!==void 0?d[127]=(d[124].push(void 0),d[124]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[125],d[124],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[126]=a[0],a})},function(a){return d[121]=d[126]}])},function(a){return d[122]=new c.Map(),d[122].set("epoch_data_storage_key",d[121]),d[123]=new c.Map(),d[123].set("value",d[122]),d[123].set("errors",void 0),d[107]=d[123]}]):c.resolve((d[112]=d[105].get("errors"),d[113]=d[105].get("errors"),d[114]=new c.Map(),d[114].set("value",void 0),d[114].set("errors",d[112]),d[107]=d[114]))},function(a){return d[108]=d[107].get("value"),d[108]!==void 0?c.sequence([function(a){return d[112]=d[108].get("epoch_data_storage_key"),c.nativeOperation(b("LSBase64Encode.nop"),d[98]).then(function(a){return a=a,d[113]=a[0],a})},function(a){return d[120]=d[113],d[120]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),d[112],c.blob("ZXBvY2hfZGF0YV9tZXRhZGF0YQ=="),d[120]).then(function(a){return a=a,d[121]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Decode.nop"),d[121]).then(function(a){return a=a,d[122]=a[0],a})},function(a){return d[114]=d[122]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] Unable to base64 encode backward edge."),d[122]="Unable to base64 encode backward edge.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[122]].join("")),d[121]=c.createArray(),void 0!==void 0?d[123]=(d[121].push(void 0),d[121]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[122],d[121],c.i64.cast([0,3]))},function(a){return d[114]=void 0}])},function(a){return c.blobs.neq(d[114],void 0)?(d[121]=new c.Map(),d[121].set("root_key",d[114]),d[122]=new c.Map(),d[122].set("value",d[121]),d[122].set("errors",void 0),d[123]=d[122].get("value"),d[124]=d[122].get("errors"),a=[d[123],d[124]],d[115]=a[0],d[116]=a[1],a):(d[121]=c.createArray(),c.blobs.eq(d[114],void 0)?d[128]=(d[121].push("root_key"),d[121]):0,d[122]=d[121].join(", "),d[123]=new c.Map(),d[123].set("error_msg",["The following required nullables are null: ","",d[122]].join("")),d[123].set("code",c.i64.cast([0,2])),d[123].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:237 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processBackwardEdge#5()"),d[124]=c.createArray(),d[128]=(d[124].push(d[123]),d[124]),d[125]=new c.Map(),d[125].set("value",void 0),d[125].set("errors",d[124]),d[126]=d[125].get("value"),d[127]=d[125].get("errors"),a=[d[126],d[127]],d[115]=a[0],d[116]=a[1],a),d[117]=new c.Map(),d[117].set("value",d[115]),d[117].set("errors",d[116]),d[118]=d[117].get("value"),d[118]!==void 0?(d[121]=d[118].get("root_key"),d[119]=d[117]):(d[121]=d[117].get("errors"),d[122]=d[117].get("errors"),d[123]=new c.Map(),d[123].set("error_msg","EB_EPOCH_BACKWARD_DECRYPTION_FAILED"),d[123].set("code",c.i64.cast([0,10013])),d[123].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:239 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processBackwardEdge#4()"),d[125]=(d[121].push(d[123]),d[121]),d[124]=new c.Map(),d[124].set("value",void 0),d[124].set("errors",d[121]),d[119]=d[124]),d[109]=d[119]}]):c.resolve((d[112]=d[107].get("errors"),d[113]=d[107].get("errors"),d[114]=new c.Map(),d[114].set("value",void 0),d[114].set("errors",d[112]),d[109]=d[114]))},function(a){return d[110]=d[109].get("value"),d[111]=d[109].get("errors"),a=[d[110],d[111]],d[99]=a[0],d[100]=a[1],a}]):c.resolve((d[104]=new c.Map(),d[104].set("error_msg","EB_EPOCH_EDGE_NEITHER_FORWARD_NOR_BACKWARD"),d[104].set("code",c.i64.cast([0,10008])),d[104].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:382 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processEdge#9()"),d[105]=c.createArray(),d[109]=(d[105].push(d[104]),d[105]),d[106]=new c.Map(),d[106].set("value",void 0),d[106].set("errors",d[105]),d[107]=d[106].get("value"),d[108]=d[106].get("errors"),a=[d[107],d[108]],d[99]=a[0],d[100]=a[1],a))},function(a){return d[101]=new c.Map(),d[101].set("value",d[99]),d[101].set("errors",d[100]),d[102]=d[101].get("value"),d[103]=d[101].get("errors"),a=[d[102],d[103]],d[85]=a[0],d[86]=a[1],a}])},function(a){return d[87]=new c.Map(),d[87].set("value",d[85]),d[87].set("errors",d[86]),d[88]=d[87].get("value"),d[88]!==void 0?c.sequence([function(a){return d[98]=d[88].get("root_key"),d[99]=d[70].get("to_epoch_fingerprint"),d[100]=c.createArray(),d[105]=(d[100].push(c.i64.cast([0,18])),d[100]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[98],d[100]).then(function(a){return a=a,d[101]=a[0],a})},function(a){return d[101]!==void 0?c.sequence([function(a){return d[105]=c.i64.of_int32(d[101].length),c.i64.ge(d[105],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[101],c.i64.cast([0,0])).then(function(a){return a=a,d[107]=a[0],d[108]=a[1],a})},function(a){return d[106]=d[107]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[108]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[108]].join("")),d[107]=c.createArray(),void 0!==void 0?d[109]=(d[107].push(void 0),d[107]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[108],d[107],c.i64.cast([0,3]))},function(a){return d[106]=void 0}])},function(a){return d[102]=d[106]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[106]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[106]].join("")),d[105]=c.createArray(),void 0!==void 0?d[107]=(d[105].push(void 0),d[105]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[106],d[105],c.i64.cast([0,3]))},function(a){return d[102]=void 0}])},function(a){return c.blobs.neq(d[102],void 0)?d[103]=!0:d[103]=!1,d[103]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.blobs.eq(d[99],void 0)||c.blobs.eq(d[99],d[102])?d[104]=d[87]:(d[105]=new c.Map(),d[105].set("error_msg","EB_EPOCH_DERIVATION_DEST_FINGERPRINT_MISMATCH"),d[105].set("code",c.i64.cast([0,10001])),d[105].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:386 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processEdge#11()"),d[106]=c.createArray(),d[108]=(d[106].push(d[105]),d[106]),d[107]=new c.Map(),d[107].set("value",void 0),d[107].set("errors",d[106]),d[104]=d[107]),d[89]=d[104]}]):c.resolve((d[98]=d[87].get("errors"),d[99]=d[87].get("errors"),d[100]=new c.Map(),d[100].set("value",void 0),d[100].set("errors",d[98]),d[89]=d[100]))},function(a){return d[90]=d[89].get("value"),d[90]!==void 0?c.sequence([function(a){return d[98]=d[90].get("root_key"),d[99]=d[70].get("to_minos_epoch"),d[99]!==void 0?(d[120]=d[99].get("epoch_head"),d[100]=d[120]):d[100]=void 0,d[101]=d[70].get("to_epoch"),d[102]=d[101].get("epoch_id"),d[103]=d[70].get("to_epoch"),d[104]=d[103].get("epoch_anon_id"),c.storedProcedure(b("LSStoreEpoch"),d[102],d[26],d[104],d[98],c.i64.cast([0,2]),c.i64.cast([0,80]),!1)},function(a){return d[105]=d[70].get("from_epoch"),d[106]=d[105].get("epoch_anon_id"),d[107]=d[70].get("from_epoch"),d[108]=d[107].get("epoch_id"),d[109]=new c.Map(),d[109].set("epoch_anon_id",d[106]),d[109].set("epoch_id",d[108]),d[110]=d[70].get("to_epoch"),d[111]=d[110].get("epoch_anon_id"),d[112]=d[70].get("to_epoch"),d[113]=d[112].get("epoch_id"),d[114]=new c.Map(),d[114].set("epoch_anon_id",d[111]),d[114].set("epoch_id",d[113]),d[115]=d[70].get("forward_edge"),d[115]?d[116]=!1:d[116]=!0,d[116]?d[117]=!1:d[117]=!0,d[118]=d[70].get("backward_edge"),c.blobs.neq(d[118],void 0)?d[119]=!0:d[119]=!1,a=[d[109],d[114],d[117],d[119],void 0,c.i64.cast([0,0])],d[91]=a[0],d[92]=a[1],d[93]=a[2],d[94]=a[3],d[95]=a[4],d[96]=a[5],a}]):c.sequence([function(a){return d[98]=d[89].get("errors"),d[99]=d[89].get("errors"),d[100]=c.i64.of_int32(d[98].length),c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[98],c.i64.sub(d[100],c.i64.cast([0,1]))).then(function(a){return a=a,d[101]=a[0],d[102]=a[1],a})},function(a){return d[103]=d[101].get("code"),d[104]=d[101].get("src_line"),d[105]=d[101].get("error_msg"),c.i64.eq(d[103],c.i64.cast([0,10004]))?d[106]=c.i64.cast([0,3]):(c.i64.eq(d[103],c.i64.cast([0,10003]))?d[124]=c.i64.cast([0,13]):(c.i64.eq(d[103],c.i64.cast([0,10002]))?d[125]=c.i64.cast([0,9]):(c.i64.eq(d[103],c.i64.cast([0,10001]))?d[126]=c.i64.cast([0,10]):(c.i64.eq(d[103],c.i64.cast([0,10005]))?d[127]=c.i64.cast([0,12]):(c.i64.eq(d[103],c.i64.cast([0,10006]))?d[128]=c.i64.cast([0,11]):(c.i64.eq(d[103],c.i64.cast([0,10008]))?d[129]=c.i64.cast([0,2]):(c.i64.eq(d[103],c.i64.cast([0,10009]))?d[130]=c.i64.cast([0,14]):(c.i64.eq(d[103],c.i64.cast([0,10010]))?d[131]=c.i64.cast([0,15]):(c.i64.eq(d[103],c.i64.cast([0,10011]))?d[132]=c.i64.cast([0,16]):(c.i64.eq(d[103],c.i64.cast([0,10012]))?d[133]=c.i64.cast([0,17]):(c.i64.eq(d[103],c.i64.cast([0,10013]))?d[134]=c.i64.cast([0,6]):d[134]=c.i64.cast([0,1]),d[133]=d[134]),d[132]=d[133]),d[131]=d[132]),d[130]=d[131]),d[129]=d[130]),d[128]=d[129]),d[127]=d[128]),d[126]=d[127]),d[125]=d[126]),d[124]=d[125]),d[106]=d[124]),d[107]="",d[108]=c.i64.of_int32(d[98].length),c.i64.gt(d[108],c.i64.cast([0,0]))?c.loopAsync(d[108],function(a){return d[124]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[98],d[124]).then(function(a){return a=a,d[125]=a[0],d[126]=a[1],a})},function(a){return d[127]=d[125].get("code"),d[128]=d[125].get("src_line"),d[129]=d[125].get("error_msg"),d[130]=d[125].get("code"),d[131]=d[125].get("src_line"),d[132]=d[125].get("error_msg"),d[133]=d[125].get("code"),d[134]=d[125].get("src_line"),d[135]=d[125].get("error_msg"),d[107]=[d[107],["at ",d[128],": ","error code ",c.i64.to_string(d[130]),": ",d[135]].join(""),"\n"].join("")}])}):c.resolve()},function(a){return d[109]=d[70].get("from_epoch"),d[110]=d[109].get("epoch_anon_id"),d[111]=d[70].get("from_epoch"),d[112]=d[111].get("epoch_id"),d[113]=new c.Map(),d[113].set("epoch_anon_id",d[110]),d[113].set("epoch_id",d[112]),d[114]=d[70].get("to_epoch"),d[115]=d[114].get("epoch_anon_id"),d[116]=d[70].get("to_epoch"),d[117]=d[116].get("epoch_id"),d[118]=new c.Map(),d[118].set("epoch_anon_id",d[115]),d[118].set("epoch_id",d[117]),d[119]=d[70].get("forward_edge"),d[119]?d[120]=!1:d[120]=!0,d[120]?d[121]=!1:d[121]=!0,d[122]=d[70].get("backward_edge"),c.blobs.neq(d[122],void 0)?d[123]=!0:d[123]=!1,a=[d[113],d[118],d[121],d[123],d[107],d[106]],d[91]=a[0],d[92]=a[1],d[93]=a[2],d[94]=a[3],d[95]=a[4],d[96]=a[5],a}])},function(a){return d[97]=new c.Map(),d[97].set("from",d[91]),d[97].set("to",d[92]),d[97].set("has_forward_edge",d[93]),d[97].set("has_backward_edge",d[94]),d[97].set("error_message",d[95]),d[97].set("result_code",d[96]),d[98]=(d[67].push(d[97]),d[67])}])}):c.resolve()},function(b){return b=[d[38],d[38],a[1],a[2],c.i64.cast([0,0]),c.i64.cast([0,0]),d[67],!1,void 0],d[58]=b[0],d[59]=b[1],d[60]=b[2],d[61]=b[3],d[62]=b[4],d[63]=b[5],d[64]=b[6],d[65]=b[7],d[66]=b[8],b}])},function(a){return a=[d[58],d[59],d[60],d[61],d[62],d[63],d[64],d[65],d[66]],d[44]=a[0],d[45]=a[1],d[46]=a[2],d[47]=a[3],d[48]=a[4],d[49]=a[5],d[50]=a[6],d[51]=a[7],d[52]=a[8],a}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure] Unable to load client state: 24"),d[54]="Unable to load client state: 24",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure] ","",d[54]].join("")),d[53]=c.createArray(),void 0!==void 0?d[57]=(d[53].push(void 0),d[53]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure",d[54],d[53],c.i64.cast([0,3]))},function(e){return d[55]=c.createArray(),d[56]=c.i64.of_int32(a[0].length),c.i64.gt(d[56],c.i64.cast([0,0]))?c.loopAsync(d[56],function(e){return d[57]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[57]).then(function(a){return a=a,d[58]=a[0],d[59]=a[1],a})},function(a){return d[60]=d[58].get("from_epoch"),d[61]=d[60].get("epoch_anon_id"),d[62]=d[58].get("from_epoch"),d[63]=d[62].get("epoch_id"),d[64]=new c.Map(),d[64].set("epoch_anon_id",d[61]),d[64].set("epoch_id",d[63]),d[65]=d[58].get("to_epoch"),d[66]=d[65].get("epoch_anon_id"),d[67]=d[58].get("to_epoch"),d[68]=d[67].get("epoch_id"),d[69]=new c.Map(),d[69].set("epoch_anon_id",d[66]),d[69].set("epoch_id",d[68]),d[70]=d[58].get("forward_edge"),d[70]?d[71]=!1:d[71]=!0,d[71]?d[72]=!1:d[72]=!0,d[73]=d[58].get("backward_edge"),c.blobs.neq(d[73],void 0)?d[74]=!0:d[74]=!1,d[75]=new c.Map(),d[75].set("from",d[64]),d[75].set("to",d[69]),d[75].set("has_forward_edge",d[72]),d[75].set("has_backward_edge",d[74]),d[75].set("result_code",c.i64.cast([0,7])),d[75].set("error_message",void 0),d[76]=(d[55].push(d[75]),d[55])}])}):c.resolve()},function(b){return b=[void 0,void 0,void 0,a[2],c.i64.cast([0,0]),c.i64.cast([0,0]),d[55],!1,void 0],d[44]=b[0],d[45]=b[1],d[46]=b[2],d[47]=b[3],d[48]=b[4],d[49]=b[5],d[50]=b[6],d[51]=b[7],d[52]=b[8],b}])},function(a){return a=[d[44],d[45],d[46],d[47],d[48],d[49],d[50],d[51],d[52]],d[15]=a[0],d[16]=a[1],d[17]=a[2],d[18]=a[3],d[19]=a[4],d[20]=a[5],d[21]=a[6],d[22]=a[7],d[23]=a[8],a}]):c.sequence([function(a){return d[26]=d[13].get("errors"),d[27]=d[13].get("errors"),function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure] Unable to load client state: 1"),d[29]="Unable to load client state: 1",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure] ","",d[29]].join("")),d[28]=c.createArray(),void 0!==void 0?d[32]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure",d[29],d[28],c.i64.cast([0,3]))},function(e){return d[30]=c.createArray(),d[31]=c.i64.of_int32(a[0].length),c.i64.gt(d[31],c.i64.cast([0,0]))?c.loopAsync(d[31],function(e){return d[32]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[32]).then(function(a){return a=a,d[33]=a[0],d[34]=a[1],a})},function(a){return d[35]=d[33].get("from_epoch"),d[36]=d[35].get("epoch_anon_id"),d[37]=d[33].get("from_epoch"),d[38]=d[37].get("epoch_id"),d[39]=new c.Map(),d[39].set("epoch_anon_id",d[36]),d[39].set("epoch_id",d[38]),d[40]=d[33].get("to_epoch"),d[41]=d[40].get("epoch_anon_id"),d[42]=d[33].get("to_epoch"),d[43]=d[42].get("epoch_id"),d[44]=new c.Map(),d[44].set("epoch_anon_id",d[41]),d[44].set("epoch_id",d[43]),d[45]=d[33].get("forward_edge"),d[45]?d[46]=!1:d[46]=!0,d[46]?d[47]=!1:d[47]=!0,d[48]=d[33].get("backward_edge"),c.blobs.neq(d[48],void 0)?d[49]=!0:d[49]=!1,d[50]=new c.Map(),d[50].set("from",d[39]),d[50].set("to",d[44]),d[50].set("has_forward_edge",d[47]),d[50].set("has_backward_edge",d[49]),d[50].set("result_code",c.i64.cast([0,7])),d[50].set("error_message",void 0),d[51]=(d[30].push(d[50]),d[30])}])}):c.resolve()},function(b){return b=[void 0,void 0,void 0,a[2],c.i64.cast([0,0]),c.i64.cast([0,0]),d[30],!1,void 0],d[15]=b[0],d[16]=b[1],d[17]=b[2],d[18]=b[3],d[19]=b[4],d[20]=b[5],d[21]=b[6],d[22]=b[7],d[23]=b[8],b}])},function(a){return d[24]=c.i64.of_float(Date.now()),c.storedProcedure(b("LSRecordEpochSyncStatus"),d[15],d[16],d[17],d[18],d[9],d[24],d[21],d[22])}]):c.resolve()},function(a){return d[2]=c.i64.of_float(Date.now()),d[3]=c.i64.random(),d[5]="Finishing execution. Execution time: ",d[6]=c.i64.to_string(c.i64.sub(d[2],d[0])),d[7]=" ms",d[4]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure] ",d[4],d[5],d[4],d[6],d[4],d[7]].join("")),c.i64.eq(c.i64.mod_(d[3],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[8]=",",d[9]=c.createArray(),void 0!==void 0?d[10]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure",[d[5],d[8],d[6],d[8],d[7]].join(""),d[9],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSDeriveAndStoreEpochsStoredProcedure",["LSDeriveAndStoreEpochs","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSDeriveAndStoreEpochs"),e.epochEdges,e.targetDeviceId,e.epochSyncReason,e.traceId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSMEBTaskCreationSource",[],(function(a,b,c,d,e,f){a=Object.freeze({UNKNOWN:-1,TEST_ONLY:0,TAM:1,MEM:2,RETROACTIVE_BACKUP:3,TAM_WEB:4,ACT_MESSAGE_DELETE:5,ACT_THREAD_DELETE:6,ACT_UPDATE_ATTACHMENT:7,TAM_PERSISTENCE_TASK:8,TAM_XMA_TOMBSTONE:9,MEM_RECEIVE:10,MEM_SEND:11,MEM_PEER_SYNC:12,MEM_RECEIVE_PROTOBUF:13,MEM_SEND_PROTOBUF:14,MEM_PEER_SYNC_PROTOBUF:15,EB_ADD_DEVICE:21,OPTIMISTIC_THREAD_CREATE_VIA_SHIM:22,ACT_THREAD_INSERT_VIA_SHIM:23,MI_THREAD_INSERT_VIA_SHIM:24,POINT_QUERY_FROM_EB:25,MESSENGER_SEARCH:26,ACT_MESSAGE_RANGE_TASK_HANDLER:27,POINT_QUERY_ON_FULLY_LOADED_THREAD:28,THREAD_CUTOVER:29,HYBRID_THREAD_VERIFY_OR_CREATE_VIA_SHIM:30,BURNER_INTERNAL_LOAD_TESTING_FRAMEWORK:31,THREAD_GALLERY_RESTORE:32,ACT_SURROUNDING_QUERY:33,EB_SNAPSHOT_RESTORE:34,PROTOBUF_RESTORE:39,FTS_INDEX_EB_MESSAGES:40,INSTAMADILLO_DYI:41,MESSENGER_MESSAGE_LIST_PAGINATION:45,DELTA_GENERIC_MESSAGE_SYNC:55,MEDIA_GALLERY_RESTORE:57,EB_PROTOBUF_RESTORE_NO_OP:58,NEW_MEMBER_EXPORT:59,THREAD_POINT_QUERY:76,EB_RESTORE_REPLIED_MESSAGES_AFTER_RANGE_RESTORE:35,REPL_TESTING:36,EB_POINT_QUERY_IN_ACT:37,EB_POINT_QUERY_RETRY_DECRYPTION_FAILURES:38,IGD_DYI:42,FTS_INDEX_EB_MESSAGES_WEB:43,BULK_QUERY_FOR_SEARCH_RESULT:44,MSGR_DYI:46,EB_RESTORE_ON_REGISTRATION:47,EB_RESTORE_ON_OFFLINE_QUEUE_COUNT_LIMIT:48,EB_POINT_QUERY_RESTORE_ON_ACK_DROP:49,EB_POINT_QUERY_RESTORE_ON_DECRYPTION_FAILURE:50,EB_POINT_QUERY_RESTORE_ON_UNAVAILABLE_DEVICE:51,EB_RANGE_QUERY_RESTORE_ON_THREAD_SESSION_ACTIVATE:52,EB_POINT_QUERY_PINNED_MESSAGES:53,EB_POINT_QUERY_RESTORE_PROTOBUF:54,EB_POINT_QUERY_IN_ACT_REACTIONS:56,EB_POINT_QUERY_BUMP_MESSAGES:60,EB_POINT_QUERY_IN_ACT_FOR_INCOMING_RETRY_RECEIPT:61,EB_POINT_QUERY_IN_ACT_FOR_REPORTING:62,EB_POINT_QUERY_IN_ACT_FOR_MESSAGE_STATUS_UPDATE:63,EB_POINT_QUERY_IN_ACT_FOR_REPL_TEST:64,EB_POINT_QUERY_IN_ACT_FOR_FACEBOOK_APP_NSE_NOTIFICATION_RENDERING:65,EB_POINT_QUERY_IN_ACT_FOR_MESSAGE_EXPORT_HANDLING:66,EB_POINT_QUERY_IN_ACT_FOR_TAM_ACT_PROXY:67,EB_POINT_QUERY_IN_ACT_FOR_REALTIME_INCOMING_MESSAGE:68,EB_POINT_QUERY_IN_ACT_FOR_REALTIME_INCOMING_AI_BOT_MESSAGE:69,EB_POINT_QUERY_IN_ACT_FOR_ENCRYPTED_BACKUPS_RESTORE_FOR_PERSISTENCE:70,EB_POINT_QUERY_IN_ACT_FOR_ENCRYPTED_BACKUPS_RESTORE_FOR_INDEXING:71,EB_POINT_QUERY_IN_ACT_FOR_ENCRYPTED_BACKUPS_RESTORE_FOR_NEW_MEMBER_HYDRATION:72,EB_POINT_QUERY_IN_ACT_FOR_ENCRYPTED_BACKUPS_RESTORE_FOR_ECHO_TO_PROTO_CONVERSION:73,EB_POINT_QUERY_IN_ACT_FOR_PENDING_MESSAGE_RECOVERY_HISTORICAL_FUTURE_PROOF:74,EB_POINT_QUERY_IN_ACT_FOR_PENDING_MESSAGE_RECOVERY_REALTIME_BLOCKED:75,RESONANCE_UTILS:80,MPS_RESTORE_REVERB_RESTORE:81,REPORTING:82,CLIENT_MESSAGE_TRUNCATION:83});f["default"]=a}),66);
__d("MAWEBRestoreTrackingUtils",["LSIntEnum","LSMEBTaskCreationSource","MAWQplProxy","MWEBODSEntityName.enum","ODS","QPLUserFlow","WAHashStringToNumber","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j={dyi:c("justknobx")._("467"),frontloaded:20,initial:20,paginated:c("justknobx")._("3177"),point:1,search:c("justknobx")._("2477")};function a(a,b,e,f){if(b!=null){p({querySource:e,runningInWorker:(e=f)!=null?e:!1,taskSource:a,traceId:b,triggerType:"paginated"})}(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.paginated")}function b(a){var b=a.querySource,e=a.runningInWorker,f=a.taskSource;a=a.traceId;if(a!=null){p({querySource:b,runningInWorker:(b=e)!=null?b:!1,taskSource:f,traceId:a,triggerType:"initial"})}(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.initial")}function e(a,b,e){if(b!=null){p({querySource:"LS",runningInWorker:(e=e)!=null?e:!1,taskSource:a,traceId:b,triggerType:"dyi"})}(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.dyi")}function f(a,b,e){if(b!=null){p({querySource:"LS",runningInWorker:(e=e)!=null?e:!1,taskSource:a,traceId:b,triggerType:"frontloaded"})}(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.frontloaded")}function k(a,b,e,f){if(b!=null){p({querySource:e,runningInWorker:(e=f)!=null?e:!1,taskSource:a,traceId:b,triggerType:"point"})}(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.point")}function l(a){var b=a.querySource,e=a.runningInWorker;a=a.traceId;if(a!=null){p({querySource:b,runningInWorker:(b=e)!=null?b:!1,taskSource:c("LSMEBTaskCreationSource").FTS_INDEX_EB_MESSAGES_WEB,traceId:a,triggerType:"search"})}(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.search")}function m(a,b){a!=null&&(b!=null&&b?d("MAWQplProxy").sendQPLSuccessThroughBridge(c("qpl")._(521476165,"2432"),void 0,d("WAHashStringToNumber").hashStringToNumber(a)):c("QPLUserFlow").endSuccess(c("qpl")._(521476165,"2432"),{instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)})),(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.decryption.success")}function n(a,b,e,f){e===void 0&&(e="restore_failure"),a!=null&&(b!=null&&b?d("MAWQplProxy").sendQPLFailThroughBridge(c("qpl")._(521476165,"2432"),e,f,d("WAHashStringToNumber").hashStringToNumber(a)):c("QPLUserFlow").endFailure(c("qpl")._(521476165,"2432"),e,{annotations:f,instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)})),(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.decryption.failure")}function o(a){u("protobuf",a)}function p(a){var b=a.querySource,e=a.runningInWorker,f=a.taskSource,g=a.traceId;a=a.triggerType;if(e!=null&&e){var h;d("MAWQplProxy").startQplUserFlow(c("qpl")._(521476165,"2432"),{bool:{runningInWorker:(h=e)!=null?h:!1},"int":{requestedMessagesCount:(h=j[a])!=null?h:10},string:{querySource:b,taskSource:v(f),traceId:g,triggerType:a}},{providedInstanceKey:d("WAHashStringToNumber").hashStringToNumber(g),providedTimeoutInMs:c("justknobx")._("2950")})}else{c("QPLUserFlow").start(c("qpl")._(521476165,"2432"),{annotations:{bool:{runningInWorker:(h=e)!=null?h:!1},"int":{requestedMessagesCount:(e=j[a])!=null?e:10},string:{querySource:b,taskSource:v(f),traceId:g,triggerType:a}},instanceKey:d("WAHashStringToNumber").hashStringToNumber(g),timeoutInMs:c("justknobx")._("2950")})}}function q(a){var b=a.pointName,e=a.traceId;a=a.type;c("QPLUserFlow").addAnnotations(c("qpl")._(521476165,"2432"),{string:{type:a}},{instanceKey:d("WAHashStringToNumber").hashStringToNumber(e)});c("QPLUserFlow").addPoint(c("qpl")._(521476165,"2432"),b,{instanceKey:d("WAHashStringToNumber").hashStringToNumber(e)})}function r(a){var b=a.annotations,e=a.pointName;a=a.traceId;c("QPLUserFlow").addAnnotations(c("qpl")._(521476165,"2432"),b,{instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)});c("QPLUserFlow").addPoint(c("qpl")._(521476165,"2432"),e,{instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)})}function s(a){var b=a.annotations,e=a.pointName;a=a.traceId;a!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(521476165,"2432"),e,{annotations:b,instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)})}function t(a){var b=a.pointName;a=a.traceId;d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(521476165,"2432"),b,{instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)})}function u(a,b){b=b?(i||(i=d("LSIntEnum"))).unwrapIntEnum(b):null;(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore."+a+"."+v(b))}function v(a){return(a=a==null?void 0:a.toString())!=null?a:"unknown"}g.markEBRestorePaginated=a;g.markEBRestoreInitial=b;g.markEBRestoreDYI=e;g.markEBRestoreFrontloaded=f;g.markEBRestorePoint=k;g.markEBRestoreSearch=l;g.markEBRestoreSuccess=m;g.markEBRestoreFail=n;g.markEBRestoreProtobuf=o;g.addQPLRestorePoint=q;g.addQPLRestorePointWithAnnotations=r;g.addQPLRestorePointWithAnnotationsWorker=s;g.addQPLRestorePointWorker=t}),98);
__d("LSDataTraceTag",[],(function(a,b,c,d,e,f){"use strict";a=0;b=1;c=2;d=3;e=4;var g=5,h=6,i=7,j=20,k=21,l=22,m=23,n=24,o=25,p=26,q=27,r=28,s=29,t=30,u=31,v=32,w=33,x=34,y=35,z=36,A=37,B=38,C=39,D=40,E=41,F=42;f.none=a;f.sticker=b;f.image=c;f.animatedImage=d;f.video=e;f.audio=g;f.file=h;f.xma=i;f.messageTypeNone=j;f.messageTypeText=k;f.messageTypeFutureproof=l;f.messageTypeCiphertext=m;f.messageTypeUnavailable=n;f.messageTypeImage=o;f.messageTypeVideo=p;f.messageTypePtt=q;f.messageTypeAdmin=r;f.messageTypeRevoked=s;f.messageTypeGif=t;f.messageTypeSticker=u;f.messageTypeExpiredEphemeral=v;f.messageTypeEphemeralSettingAdmin=w;f.messageTypeEphemeralSyncResponse=x;f.messageTypeEphemeralScreenshotAction=y;f.messageTypeDeleteForMe=z;f.messageTypeEphemeralSettingChangeFromCurrentDevice=A;f.messageTypeAlertICDC=B;f.messageTypeGroupInvite=C;f.messageTypeXMA=D;f.messageTypeReaction=E;f.messageTypeSenderKeyDistribution=F}),66);
__d("MAWBridgeTrace",["WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f,g,h,i){var j=a.ack,k=a.externalId,l=a.ts;a=a.type;var m=d("WAJids").switchOnMsgrChatJidType(b,{group:function(a){return"Group"},user:function(a){return"User"}});return{ack:j,externalId:k,isFirstMsg:!!f,openMessageOtid:e,openMessageParticipantCount:g,participantCount:h,threadJid:b,threadKey:i,threadType:m,traceType:c,ts:l,type_:a}}function b(a,b,c){return{traceContext:c,traceId:b,traceType:a}}function c(a,b,c,d){return{errorMessage:d,event:b,externalIds:a,traceType:c}}function e(a,b,c,d,e,f){return{checkPointId:a,dataTraceId:b,errorMessage:c,shouldFlush:d,syncChannel:e,tags:f}}g.createBridgeStartTraceData=a;g.createBridgeStartTraceWithTraceIdData=b;g.createBridgeUpdateTraceData=c;g.createBridgeTraceRecordCheckpointData=e}),98);
__d("MAWTraceUtils",["LSDataTraceCheckPoint","LSDataTraceTag","LSIntEnum","LSRequestId","MAWBridge","MAWBridgeTrace","MAWMsgType"],(function(a,b,c,d,e,f,g){"use strict";var h,i="backup_upload",j="media_backup",k="vesta_registration",l="vesta_login";function m(){return c("LSRequestId").generate()}function a(a){return a}function b(a,b,c){c=(c=c)!=null?c:m();d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"StartTraceWithTraceId",value:d("MAWBridgeTrace").createBridgeStartTraceWithTraceIdData(a,c,b)}]},!0);return c}function n(a,b,c,e,f){if(a!=null){c=c.length>0?c.map(function(a){return a.toString()}).join(","):void 0;d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"TraceRecordCheckpoint",value:d("MAWBridgeTrace").createBridgeTraceRecordCheckpointData(b,a,f,e,-1,c)}]},!0)}}function e(a,b,e,f){n(a,b,e,!1),n(a,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_FOR_FAILURE),e,!0,f)}function f(a,b,e){n(a,b,e,!1),n(a,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_AND_FLUSH),e,!0)}function o(a,b,e){n(a,b,e,!1),n(a,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_AND_FLUSH),e,!0)}function p(a){switch(a){case d("MAWMsgType").MSG_TYPE.TEXT:return d("LSDataTraceTag").messageTypeText;case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:return d("LSDataTraceTag").messageTypeFutureproof;case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:return d("LSDataTraceTag").messageTypeCiphertext;case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:return d("LSDataTraceTag").messageTypeUnavailable;case d("MAWMsgType").MSG_TYPE.IMAGE:return d("LSDataTraceTag").messageTypeImage;case d("MAWMsgType").MSG_TYPE.VIDEO:return d("LSDataTraceTag").messageTypeVideo;case d("MAWMsgType").MSG_TYPE.PTT:return d("LSDataTraceTag").messageTypePtt;case d("MAWMsgType").MSG_TYPE.ADMIN:return d("LSDataTraceTag").messageTypeAdmin;case d("MAWMsgType").MSG_TYPE.REVOKED:return d("LSDataTraceTag").messageTypeRevoked;case d("MAWMsgType").MSG_TYPE.GIF:return d("LSDataTraceTag").messageTypeGif;case d("MAWMsgType").MSG_TYPE.STICKER:return d("LSDataTraceTag").messageTypeSticker;case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:return d("LSDataTraceTag").messageTypeExpiredEphemeral;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:return d("LSDataTraceTag").messageTypeEphemeralSettingAdmin;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:return d("LSDataTraceTag").messageTypeEphemeralSyncResponse;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:return d("LSDataTraceTag").messageTypeEphemeralScreenshotAction;case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:return d("LSDataTraceTag").messageTypeDeleteForMe;case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:return d("LSDataTraceTag").messageTypeEphemeralSettingChangeFromCurrentDevice;case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:return d("LSDataTraceTag").messageTypeAlertICDC;case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:return d("LSDataTraceTag").messageTypeGroupInvite;case d("MAWMsgType").MSG_TYPE.XMA:return d("LSDataTraceTag").messageTypeXMA;case d("MAWMsgType").MSG_TYPE.REACTION:return d("LSDataTraceTag").messageTypeReaction;case d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION:return d("LSDataTraceTag").messageTypeSenderKeyDistribution;default:return d("LSDataTraceTag").messageTypeNone}}g.CONTEXT_BACKUP_UPLOAD=i;g.CONTEXT_MEDIA_BACKUP=j;g.CONTEXT_VESTA_REGISTRATION=k;g.CONTEXT_VESTA_LOGIN=l;g.createTraceId=m;g.stringToTraceId=a;g.startNewTrace=b;g.recordCheckpointForTrace=n;g.recordFailureAndFlushForTraceId=e;g.recordSuccessAndFlushForTraceId=f;g.recordInvalidUploadRequestAndFlushTrace=o;g.getTagForMsgType=p}),98);
__d("MAWEncryptedBackupUtils",["FBLogger","I64","LSAuthorityLevel","LSDataTraceCheckPoint","LSDict","LSIntEnum","LSShape","LSVec","MAWEBFrontendQPLLogger","MAWTraceUtils","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b,c,e,f){d("MAWTraceUtils").recordCheckpointForTrace(a,b,c,e,f)}function a(a,b,e){j(b,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_WEB_GET_BACKUP_TENANCY),[],!1);return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.secure_encrypted_backups_client_state)).then(function(a){return k(a,e)})}function k(a,b){var e;if(a==null){b!=null&&d("MAWEBFrontendQPLLogger").addPointEBUploadTracking(b,"get_backup_tenancy_null_client_state_row");return}e=(e=a.backupTenancy)!=null?e:(i||(i=d("I64"))).one;a=a.authorityLevel;if(b!=null){d("MAWEBFrontendQPLLogger").addPointEBUploadTracking(b,"get_backup_tenancy",{"int":{authorityLevel:(i||(i=d("I64"))).to_int32((b=a)!=null?b:(i||(i=d("I64"))).zero),backupTenancy:i.to_int32((b=e)!=null?b:(i||(i=d("I64"))).zero)}})}if(e!=null&&(i||(i=d("I64"))).equal((h||(h=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE),a))return e}function b(a,b){var d=new Set(),e=a.length;for(var a=a.entries(),f=Array.isArray(a),g=0,a=f?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(f){if(g>=a.length)break;h=a[g++]}else{g=a.next();if(g.done)break;h=g.value}h=h;var i=h[0];h=h[1];d.has(h)&&c("FBLogger")("labyrinth_web").warn("Duplicate messages returned from server for restoreType: %s, index: %s of batchSize: %s",b,i,e);d.add(h)}}function e(a){a=a.map(function(a){var b=a.toplevelProtobuf;b=d("LSShape").ofRecord({decrypted_protobuf:b.decryptedProtobuf,protobuf_timestamp_ms:(i||(i=d("I64"))).of_float(b.protobufTimestampMS)});var e=new(c("LSDict"))();a.supplementalProtobufs.forEach(function(a,b){e.set(b,d("LSShape").ofRecord({decrypted_protobuf:a.decryptedProtobuf,protobuf_timestamp_ms:(i||(i=d("I64"))).of_float(a.protobufTimestampMS)}))});return d("LSShape").ofRecord({otid:a.otid,supplemental_protobufs:e,toplevel_protobuf:b})});return c("LSVec").ofArray(a)}function f(a){a=c("LSVec").toArray(a);a=a.map(function(a){return d("LSShape").toRecord(a)});return a.map(function(a){var b=d("LSShape").toRecord(a.toplevel_protobuf);b={decryptedProtobuf:b.decrypted_protobuf,protobufTimestampMS:(i||(i=d("I64"))).to_float(b.protobuf_timestamp_ms)};var c=new Map(),e=a.supplemental_protobufs;e.forEach(function(a,b){a=d("LSShape").toRecord(a);c.set(b,{decryptedProtobuf:a.decrypted_protobuf,protobufTimestampMS:(i||(i=d("I64"))).to_float(a.protobuf_timestamp_ms)})});return{otid:a.otid,supplementalProtobufs:c,toplevelProtobuf:b}})}g.getBackupTenancy=a;g.getBackupTenancyFromClientStateRow=k;g.logIfDuplicateMessagesFoundInRestore=b;g.convertJSTypesToLSTypesForRestoreJob=e;g.convertLSTypesToJSTypesForRestoreJob=f}),98);
__d("MEBEncryptionVersion",[],(function(a,b,c,d,e,f){a=Object.freeze({UNKNOWN:0,ENCRYPTION_KDF_WITH_VERSION:2,ENCRYPTION_KDF_WITH_NULL_SALT:3,ENCRYPTION_KDF_WITH_NULL_SALT_DF_CANARY:4,TEST_VERSION:99});f["default"]=a}),66);
__d("MEBEpochSyncReason",[],(function(a,b,c,d,e,f){a=Object.freeze({EMPTY_RESTORE_PAYLOAD:-3,NONE_PROVIDED_BY_CLIENT:-2,NONE_PROVIDED_BY_SERVER:-1,SNAPSHOT_RESTORE:0,POINT_QUERY_RESTORE:1,RANGE_QUERY_RESTORE:2,MESSAGE_QUERY_RESTORE:3,SURROUNDING_RESTORE:4,DOWNLOAD_EPOCHS_V2:5,PREPARE_OPEN_EPOCH:6,HANDLE_OPEN_EPOCH_SUCCESS:7,HANDLE_INIT_GET_SECRETS:8,DERIVE_ONBOARDING_MATERIAL:9,DECRYPT_AND_WRITE_MESSAGES:10,RESTORE_WITH_SERIALIZER:11,FINISH_ADD_PEER_DEVICE:12,SYNC_DELTAS:13,THREAD_POINT_QUERY_RESTORE:14});f["default"]=a}),66);
__d("WorkerRelayNetwork",["ActorURIConfig","MAWCurrentUser","RelayAPIConfig","WAResolvable","createRelayFBNetwork","createRelayFBNetworkFetch","relay-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("WAResolvable").Resolvable)();function a(){var a=i(d("MAWCurrentUser").getID());a={execute:a.execute};h.resolve(a);return a}function b(){return h.promise}function i(a,b){b={actorID:a,batchResponseChunks:!0,getAdditionalData:function(){var b={};a!=null&&(b[c("ActorURIConfig").PARAMETER_ACTOR]=a);c("RelayAPIConfig").useXController===!1&&c("RelayAPIConfig").accessToken!==""&&(b.access_token=c("RelayAPIConfig").accessToken);return b},graphURI:b};b=c("createRelayFBNetworkFetch")(b);var e=function(a,b,c){return d("relay-runtime").Observable.create(function(a){return a.complete()})};return c("createRelayFBNetwork")(b,e,null,null)}g.createWorkerNetworkExecute=a;g.getWorkerNetworkExecute=b}),98);
__d("executeGraphQLQuery",["DTSG","MAWBridge","asyncToGeneratorRuntime","err","relay-runtime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){b=d("relay-runtime").getRequest(b);if(b.params.operationKind==="subscription")throw c("err")("executeGraphQLQuery: Expected query or mutation operation");var f={force:!0},g=d("DTSG").getToken();if(g==null||g===""||typeof g!=="string"){g=(yield d("MAWBridge").getBridge().sendAndReceive("event","getDTSGToken")["catch"](function(a){throw c("err")("executeGraphQLQuery: Failed to get DTSG token from the main thread",a)}));if(g==null||g===""||typeof g!=="string")throw c("err")("executeGraphQLQuery: Received an empty DTSG token from the main thread");d("DTSG").setToken(g)}g=d("relay-runtime").createOperationDescriptor(b,e,f);return a.execute(g.request.node.params,g.request.variables,f)});return h.apply(this,arguments)}g.executeGraphQLQuery=a}),98);
__d("createWorkerMutation",["WorkerRelayNetwork","asyncToGeneratorRuntime","err","executeGraphQLQuery","relay-runtime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=d("relay-runtime").getRequest(a);if(e.params.operationKind!=="mutation")throw c("err")("createWorkerMutation: Expected mutation operation");var f=d("WorkerRelayNetwork").getWorkerNetworkExecute();e=function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=(yield f);return d("executeGraphQLQuery").executeGraphQLQuery(c,a,b).then(function(a){return a.toPromise()}).then(function(a){if(Array.isArray(a)){return(a=a[0])==null?void 0:a.data}else return null})});return function(a){return c.apply(this,arguments)}}();return[e]}g["default"]=a}),98);
__d("WARetryableError",["WACustomError"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;c=a.call(this,"see error at this.source")||this;c.source=b;return c}return b}(d("WACustomError").customError("RetryableError"));g["default"]=a}),98);
__d("createWorkerQuery",["FBLogger","IGDWebUtils","MAWRotateDTSG","WARetryableError","WorkerRelayNetwork","asyncToGeneratorRuntime","err","executeGraphQLQuery","relay-runtime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=d("relay-runtime").getRequest(a);if(e.params.operationKind!=="query")throw c("err")("createWorkerQuery: Expected query operation");e=(yield d("WorkerRelayNetwork").getWorkerNetworkExecute());var f=d("IGDWebUtils").isOnInstagramWeb();e=(yield d("executeGraphQLQuery").executeGraphQLQuery(e,a,b).then(function(a){return a.toPromise()}).then(function(a){return Array.isArray(a)?a[0].data:(a=a.data)!=null?a:null})["catch"](function(a){if(("code"in a&&a.code===1357004||"message"in a&&a.message.indexOf("1357004")!==-1||typeof a==="string"&&a.indexOf("1357004")!==-1)&&!f){c("FBLogger")("messenger_e2ee_web").info("Failed with expired DTSG, attempting to rotate.");return d("MAWRotateDTSG").tryRotateDTSG().then(function(b){if(b)throw new(c("WARetryableError"))(a);throw a})}throw a}));return e});return h.apply(this,arguments)}g["default"]=a}),98);
__d("WorkerRelay",["WorkerRelayNetwork","createWorkerMutation","createWorkerQuery","executeGraphQLQuery","relay-runtime"],(function(a,b,c,d,e,f,g){"use strict";f.exports={createWorkerMutation:c("createWorkerMutation"),createWorkerQuery:c("createWorkerQuery"),executeGraphQLQuery:d("executeGraphQLQuery").executeGraphQLQuery,getWorkerRelayEnvironment:d("WorkerRelayNetwork").getWorkerNetworkExecute,graphql:d("relay-runtime").graphql}}),34);
__d("handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"encryption_version",storageKey:null},b={alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"epoch_id",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"encrypted_protobuf_stanza",storageKey:null},e={alias:null,args:null,kind:"ScalarField",name:"protobuf_timestamp_ms",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"sk_ciphertext",storageKey:null},g=[b,c];return{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMessage",kind:"LinkedField",name:"encrypted_messages",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEchoDocument",kind:"LinkedField",name:"echo_document",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"echo_document_string",storageKey:null},a,b,c,{alias:null,args:null,kind:"ScalarField",name:"epoch_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"otid",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanzas",kind:"LinkedField",name:"protobuf_stanzas",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"top_level_protobuf",plural:!1,selections:[d,a,b,c,e,f],storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"supplemental_protobufs",plural:!0,selections:[d,a,b,c,e,f,{alias:null,args:null,kind:"ScalarField",name:"supplemental_key",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_id",storageKey:null},{alias:null,args:null,concreteType:"XFBMessageRangeInfo",kind:"LinkedField",name:"message_range_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_more_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"has_more_after",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_after",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"should_delete_mailbox",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_string",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"thread_not_found",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochDerivationSet",kind:"LinkedField",name:"epoch_derivation_set",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupsEpochEdge",kind:"LinkedField",name:"epoch_edges",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"backward_edge",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochForwardEdge",kind:"LinkedField",name:"forward_edge",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"auth_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_entropy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entropy_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_storage_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"psk_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"from_epoch",plural:!1,selections:g,storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"to_epoch",plural:!1,selections:g,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"from_epoch_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"to_epoch_fingerprint",storageKey:null}],storageKey:null}],storageKey:null}],type:"XFBEncryptedBackupMessages",abstractKey:null}}();e.exports=a}),null);
__d("handleRestoreMessagesGraphQLResponse",["EBAPIQPLPoints","I64","LSAuthorityLevel","LSBase64Decode","LSDecryptMessageProtobufsStoredProcedure","LSDecryptMessagesStoredProcedure","LSDeleteAndReenrollDeviceStateStoredProcedure","LSDeriveAndStoreEpochsStoredProcedure","LSDict","LSFactory","LSIntEnum","LSMEBDeviceReenrollmentReason","LSMEBTaskCreationSource","LSShape","LSVec","MAWEBRestoreTrackingUtils","MAWEncryptedBackupUtils","MAWJobDefinitions","MEBEncryptionVersion","MEBEpochSyncReason","QPLUserFlow","ReQL","WAHashStringToNumber","WALogger","asyncToGeneratorRuntime","handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages.graphql","promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Protobuf decryption failed in search range restore response"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][processEncryptedMessagesWithoutPersisting] decryptMessageProtobufs failed with error: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message range info is not complete - cannot proceed with graphQL restore for thread ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] backup_id is null during graphQL restore for thread ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message range info is null - cannot proceed with graphQL restore"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] server side exception during graphql restore - ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth][web Client state is null - unable to proceed with GQL restore"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][processEncryptedMessages] decryptMessageProtobufs failed with error: ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message with no echo document and no protobuf data, more details: encrypted_protobuf_content: ",", protobuf_epoch_anon_id: ",", protobuf_epoch_id: ",", protobuf_timestamp_ms: ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] echo_document_string or echo_epoch_anon_id is null for a message in the GraphQL range restore response"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] otid is null for a message in the GraphQL range restore response"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message is null in the GraphQL range restore response"]);v=function(){return a};return a}var w=c("requireDeferred")("LSRestoreEchoBlobs.nop").__setRef("handleRestoreMessagesGraphQLResponse"),x=c("requireDeferred")("LSRestoreProtobufs.nop").__setRef("handleRestoreMessagesGraphQLResponse");function y(a){if(a==null)return c("MEBEncryptionVersion").UNKNOWN;switch(a){case"ENCRYPTION_KDF_WITH_NULL_SALT":return c("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_NULL_SALT;case"ENCRYPTION_KDF_WITH_VERSION":return c("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_VERSION;case"ENCRYPTION_KDF_WITH_NULL_SALT_DF_CANARY":return c("MEBEncryptionVersion").ENCRYPTION_KDF_WITH_NULL_SALT_DF_CANARY;case"TEST_VERSION":return c("MEBEncryptionVersion").TEST_VERSION;default:return c("MEBEncryptionVersion").UNKNOWN}}function z(a,b){b=b;b==null&&(b="ENCRYPTION_VERSION_MISSING");var c=a.get(b);a.has(b)&&c!=null?a.set(b,c+1):a.set(b,1)}function A(a,b,e,f){var g=new Map(),h=new Map(),k=new Map(),l=[],m=[],n=[];a=(a=a==null?void 0:a.map(function(a){var e,f,o,p,q,r,s;if(a==null){d("WALogger").ERROR(v());return}var w=a.otid;if(w==null){d("WALogger").ERROR(u());return}e=(e=a.echo_document)==null?void 0:e.echo_document_string;f=(f=a.echo_document)==null?void 0:f.epoch_anon_id;o=(o=a.echo_document)==null?void 0:o.epoch_fingerprint;var x=a.protobuf_stanzas;p=x==null?void 0:(p=x.top_level_protobuf)==null?void 0:p.encrypted_protobuf_stanza;q=x==null?void 0:(q=x.top_level_protobuf)==null?void 0:q.epoch_anon_id;r=x==null?void 0:(r=x.top_level_protobuf)==null?void 0:r.epoch_id;s=x==null?void 0:(s=x.top_level_protobuf)==null?void 0:s.protobuf_timestamp_ms;var A=x==null?void 0:x.supplemental_protobufs;if(e==null||f==null){d("WALogger").ERROR(t());return}if(p==null||q==null||r==null||s==null)if(e.length===0){C(p,q,r,s);return}else{var B,D;B=y((B=a.echo_document)==null?void 0:B.encryption_version);z(g,(D=a.echo_document)==null?void 0:D.encryption_version);l.push(d("LSShape").ofRecord({backup_id:Number(b),encryption_version:(i||(i=d("LSIntEnum"))).ofNumber(B),epoch_anon_id:new TextEncoder().encode(f).buffer,epoch_fingerprint:o!=null?new TextEncoder().encode(o).buffer:void 0,epoch_id:((D=a.echo_document)==null?void 0:D.epoch_id)!=null?(j||(j=d("I64"))).of_string(a.echo_document.epoch_id):void 0,otid:w,value:e}));m.push({backup_id:Number(b),encryption_version:B,epoch_anon_id:new TextEncoder().encode(f).buffer,epoch_fingerprint:o!=null?new TextEncoder().encode(o).buffer:void 0,epoch_id:((D=a.echo_document)==null?void 0:D.epoch_id)!=null?(j||(j=d("I64"))).of_string(a.echo_document.epoch_id):void 0,otid:w,value:e});return}if(x!=null){D=y((B=a.echo_document)==null?void 0:B.encryption_version);z(g,(B=a.echo_document)==null?void 0:B.encryption_version);a=d("LSShape").ofRecord({backup_id:Number(b),encryption_version:(i||(i=d("LSIntEnum"))).ofNumber(D),epoch_anon_id:new TextEncoder().encode(f).buffer,epoch_fingerprint:o!=null?new TextEncoder().encode(o).buffer:void 0,value:e});D=y(x==null?void 0:(B=x.top_level_protobuf)==null?void 0:B.encryption_version);z(h,x==null?void 0:(f=x.top_level_protobuf)==null?void 0:f.encryption_version);o=d("LSShape").ofRecord({encrypted_protobuf:p,encryption_version:i.ofNumber(D),epoch_anon_id:new TextEncoder().encode(q).buffer,epoch_id:(j||(j=d("I64"))).of_string(r),protobuf_timestamp_ms:j.of_string(s)});var E={supplementalProtobufs:[],topLevelProtobuf:{backup_id:Number(b),encryptedProtobufContent:p,encryption_version:D,epoch_anon_id:new TextEncoder().encode(q).buffer,epoch_id:j.of_string(r),otid:w,protobufTimestampMs:s,value:void 0}},F=new(c("LSDict"))();A==null?void 0:A.forEach(function(a){var c=a==null?void 0:a.supplemental_key,e=a==null?void 0:a.encrypted_protobuf_stanza,f=a.epoch_anon_id,g=a==null?void 0:a.epoch_id,h=a==null?void 0:a.protobuf_timestamp_ms;if(e==null||f==null||g==null||h==null||c==null)return;var l=y(a==null?void 0:a.encryption_version);z(k,a==null?void 0:a.encryption_version);F.set(c,d("LSShape").ofRecord({encrypted_protobuf:e,encryption_version:(i||(i=d("LSIntEnum"))).ofNumber(l),epoch_anon_id:new TextEncoder().encode(f).buffer,epoch_id:(j||(j=d("I64"))).of_string(g),protobuf_timestamp_ms:j.of_string(h),sk_ciphertext:a==null?void 0:a.sk_ciphertext}));E.supplementalProtobufs.push({backup_id:Number(b),encryptedProtobufContent:e,encryption_version:l,epoch_anon_id:new TextEncoder().encode(f).buffer,epoch_id:j.of_string(g),protobufTimestampMs:h,skCipherText:a==null?void 0:a.sk_ciphertext,supplementalKey:c,value:void 0})});n.push(E);return d("LSShape").ofRecord({encrypted_echo_message:a,encrypted_protobufs:d("LSShape").ofRecord({supplemental_protobufs:F,toplevel_protobuf:o}),otid:w})}}).filter(Boolean))!=null?a:[];if(f!=null&&e!=null){c("QPLUserFlow").addPoint(e,"processing_encrypted_messages_complete",{instanceKey:f});for(var o of g.entries()){var p,q=o[0],r=o[1];q=q+"_echo";c("QPLUserFlow").addAnnotations(e,{"int":(p={},p[q]=r,p)},{instanceKey:f})}for(q of h.entries()){r=q[0];p=q[1];o=r+"_protobuf_top_level";c("QPLUserFlow").addAnnotations(e,{"int":(r={},r[o]=p,r)},{instanceKey:f})}for(o of k.entries()){p=o[0];r=o[1];q=p+"_protobuf_supplemental";c("QPLUserFlow").addAnnotations(e,{"int":(p={},p[q]=r,p)},{instanceKey:f})}}B(l,a,e,f);return{encryptedLSEchoMessages:l,encryptedMessagesWithProtobufs:a,encryptedNonLSEchoMessages:m,encryptedNonLSProtobufs:n}}function B(a,b,e,f){if(e!=null){if(a.length>0){var g=d("LSShape").toRecord(a[0]);a=d("LSShape").toRecord(a[a.length-1]);c("QPLUserFlow").addAnnotations(e,{string:{first_echo_otid:g.otid,last_echo_otid:a.otid}},{instanceKey:f})}if(b.length>0){a=(g=d("LSShape")).toRecord(b[0]);var h=g.toRecord(a.encrypted_protobufs);b=g.toRecord(b[b.length-1]);g=g.toRecord(b.encrypted_protobufs);c("QPLUserFlow").addAnnotations(e,{string:{first_protobuf_otid:a.otid,first_protobuf_ts:(j||(j=d("I64"))).to_string(d("LSShape").toRecord(h.toplevel_protobuf).protobuf_timestamp_ms),last_protobuf_otid:b.otid,last_protobuf_ts:j.to_string(d("LSShape").toRecord(g.toplevel_protobuf).protobuf_timestamp_ms)}},{instanceKey:f})}}}function C(a,b,c,e){d("WALogger").ERROR(s(),a==null?"null/empty":"not empty",b==null?"null/empty":"not empty",c==null?"null/empty":"not empty",e==null?"null/empty":"not empty")}function D(a){return E.apply(this,arguments)}function E(){E=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.backupId,e=a.encryptedMessages,g=a.isPointQuery,h=a.messageRangeInfo,k=a.sortOrderMs,l=a.source,m=a.storage,n=a.threadId,o=a.traceId;a=A(e,b);var p=a.encryptedLSEchoMessages,q=a.encryptedMessagesWithProtobufs;b=(e=h)!=null?e:{};var s=b.has_more_after,t=b.has_more_before,u=b.next_message_timestamp_ms_after,v=b.next_message_timestamp_ms_before;if(t==null||s==null||u==null||v==null)return;if(q.length===0){a=(yield m.runInTransaction(function(a){return c("LSDecryptMessagesStoredProcedure")(c("LSFactory")(a),{actThreadId:n,encryptedMessages:c("LSVec").ofArray(p)})},"readwrite",void 0,void 0,f.id+":572"));h=a[0];if(h!=null){var y=c("LSVec").toArray(h).map(function(a){return d("LSShape").toRecord(a).value});c("promiseDone")(w.load().then(function(a){return m.runInTransaction(function(b){return a(b,0,(j||(j=d("I64"))).zero,c("LSVec").ofArray(y),t,j.of_string(v),s,j.of_string(u),g,n,o,k!=null?k:void 0,(i||(i=d("LSIntEnum"))).ofNumber((b=l)!=null?b:c("LSMEBTaskCreationSource").UNKNOWN),void 0)},"readwrite",void 0,void 0,f.id+":588")}))}}else{e=(yield m.runInTransaction(function(a){return c("LSDecryptMessageProtobufsStoredProcedure")(c("LSFactory")(a),{actThreadId:n,encryptedMessagesWithProtobufs:c("LSVec").ofArray(q)})},"readwrite",void 0,void 0,f.id+":612"));var z=e[0];b=e[1];if(b!=null){a=d("LSShape").toRecord(b);d("WALogger").ERROR(r(),a.error_message)}c("promiseDone")(x.load().then(function(a){return m.runInTransaction(function(b){return a(b,0,n,(b=z)!=null?b:c("LSVec").ofArray([]),t,(j||(j=d("I64"))).of_string(v),s,j.of_string(u),g,o,k!=null?k:void 0,void 0,c("LSVec").ofArray([]),(i||(i=d("LSIntEnum"))).ofNumber((b=l)!=null?b:c("LSMEBTaskCreationSource").UNKNOWN))},"readwrite",void 0,void 0,f.id+":629")}))}});return E.apply(this,arguments)}function a(a,b){return F.apply(this,arguments)}function F(){F=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=b!=null?yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.secure_encrypted_backups_client_state)):yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_client_state));b=b!=null?yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(b.secure_encrypted_backups_epochs)):yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_epochs));a=b.filter(function(a){return(j||(j=d("I64"))).equal(a.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))}).map(function(a){return(j||(j=d("I64"))).to_string(a.epochId)});if(e==null){d("WALogger").ERROR(q());return}b=e.deviceId;var f=e.mailboxRootKeyBlob,g=e.ocmfClientStateBlob;e=e.backupId;return{backupId:e,device_id:b,locally_available_epochs:a,mailboxRootKey:f,ocmfClientStateBlob:g}});return F.apply(this,arguments)}function G(a,b,c,d,e){return H.apply(this,arguments)}function H(){H=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,g,h){g!=null&&(h!=null&&h?d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotationsWorker({annotations:{bool:{has_epochs:a!=null&&a.epoch_edges.length>0}},pointName:"derive_and_store_epochs_worker",traceId:g}):d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotations({annotations:{bool:{has_epochs:a!=null&&a.epoch_edges.length>0}},pointName:"derive_and_store_epochs",traceId:g}));try{if(a!=null){var k=a.epoch_edges,l=[],m=new TextEncoder();k!=null&&(k.forEach(function(a){var b=a.from_epoch,c=a.to_epoch,e=a.forward_edge,f=a.backward_edge!=null?d("LSBase64Decode").decode(a.backward_edge):void 0,g=(e==null?void 0:e.auth_public_key)!=null?d("LSBase64Decode").decode(e.auth_public_key):void 0,h=(e==null?void 0:e.encrypted_entropy)!=null?d("LSBase64Decode").decode(e==null?void 0:e.encrypted_entropy):void 0,i=(e==null?void 0:e.entropy_fingerprint)!=null?d("LSBase64Decode").decode(e==null?void 0:e.entropy_fingerprint):void 0,k=(e==null?void 0:e.epoch_storage_public_key)!=null?d("LSBase64Decode").decode(e==null?void 0:e.epoch_storage_public_key):void 0;e=(e==null?void 0:e.psk_fingerprint)!=null?d("LSBase64Decode").decode(e==null?void 0:e.psk_fingerprint):void 0;var n;g!=null&&h!=null&&(n=d("LSShape").ofRecord({auth_public_key:g,encrypted_entropy:h,entropy_fingerprint:i,epoch_storage_public_key:k,psk_fingerprint:e}));g=b==null?void 0:b.epoch_anon_id;h=b==null?void 0:b.epoch_id;i=c==null?void 0:c.epoch_anon_id;k=c==null?void 0:c.epoch_id;g!=null&&h!=null&&i!=null&&k!=null&&l.push(d("LSShape").ofRecord({backward_edge:f,forward_edge:n,from_epoch:d("LSShape").ofRecord({epoch_anon_id:m.encode(g).buffer,epoch_id:(j||(j=d("I64"))).of_string(h)}),from_epoch_fingerprint:a.from_epoch_fingerprint!=null?d("LSBase64Decode").decode(a.from_epoch_fingerprint):void 0,to_epoch:d("LSShape").ofRecord({epoch_anon_id:m.encode(i).buffer,epoch_id:j.of_string(k)}),to_epoch_fingerprint:a.to_epoch_fingerprint!=null?d("LSBase64Decode").decode(a.to_epoch_fingerprint):void 0}))}),yield b.runInTransaction(function(a){return c("LSDeriveAndStoreEpochsStoredProcedure")(c("LSFactory")(a),{epochEdges:c("LSVec").ofArray(l),epochSyncReason:(i||(i=d("LSIntEnum"))).ofNumber(c("MEBEpochSyncReason").DECRYPT_AND_WRITE_MESSAGES),targetDeviceId:e,traceId:g})},"readwrite",void 0,void 0,f.id+":820"))}}catch(b){g!=null&&(h!=null&&h?d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotationsWorker({annotations:{bool:{has_epochs:a!=null&&a.epoch_edges.length>0},string:{exception:b.message}},pointName:"derive_and_store_epochs_worker_exception",traceId:g}):d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotations({annotations:{bool:{has_epochs:a!=null&&a.epoch_edges.length>0},string:{exception:b.message}},pointName:"derive_and_store_epochs_exception",traceId:g}))}});return H.apply(this,arguments)}function e(a,b,c,d,e,f,g,h,i){return I.apply(this,arguments)}function I(){I=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,g,h,k,l,q,r){var s=a;if(s==null){k!=null&&(d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"null_messages",traceId:k,type:"none"}),d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(k));return}var t=s.backup_id,u=s.encrypted_messages,v=s.epoch_derivation_set,w=s.exception_string,x=s.message_range_info,y=s.should_delete_mailbox;s=s.thread_not_found;if(w!=null){d("WALogger").ERROR(p(),w);s!=null&&s&&(k!=null&&(d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"thread_not_found_on_server",traceId:k,type:"none"}),d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(k,!1)));y===!0&&(k!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"delete_mailbox",traceId:k,type:"none"}),yield b.runInTransaction(function(a){return c("LSDeleteAndReenrollDeviceStateStoredProcedure")(c("LSFactory")(a),{reenrollmentReason:(i||(i=d("LSIntEnum"))).ofNumber(c("LSMEBDeviceReenrollmentReason").RESTORE_FAILED_WITH_NO_DEVICE_FOUND),targetDeviceId:g})},"readwrite",void 0,void 0,f.id+":934"));k!=null&&d("MAWEBRestoreTrackingUtils").markEBRestoreFail(k,!1,"server-side-exception",{string:{exception:w}});return}yield G(v,b,g,k);if(u.length===0){k!=null&&(d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"no_messages",traceId:k,type:"none"}),d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(k));return}if(x==null){k!=null&&(d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"message_range_info_null",traceId:k,type:"none"}),d("MAWEBRestoreTrackingUtils").markEBRestoreFail(k));d("WALogger").ERROR(o());return}t==null&&(d("WALogger").WARN(n(),e),k!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"backup_id_null",traceId:k,type:"none"}));s=x.has_more_after;y=x.has_more_before;w=x.next_message_timestamp_ms_after;v=x.next_message_timestamp_ms_before;if(y==null||s==null||w==null||v==null){k!=null&&(d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:" message_range_info_incomplete",traceId:k,type:"none"}),d("MAWEBRestoreTrackingUtils").markEBRestoreFail(k));d("WALogger").ERROR(m(),e);return}yield D({backupId:t!=null?t:(j||(j=d("I64"))).to_string(r),encryptedMessages:u,isPointQuery:q,messageRangeInfo:x,sortOrderMs:h,source:l,storage:b,threadId:e,traceId:k});return a});return I.apply(this,arguments)}h!==void 0?h:h=b("handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages.graphql");function J(a){return K.apply(this,arguments)}function K(){K=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.backupId,e=a.encryptedMessages,g=a.messageRangeInfo,h=a.qplEvent,i=a.runningInWorker,m=a.sortOrderMs,n=a.source,o=a.storage,p=a.threadId;a=a.traceId;var q=a!=null?d("WAHashStringToNumber").hashStringToNumber(a):void 0;e=A(e,b);var r=e.encryptedLSEchoMessages,s=e.encryptedMessagesWithProtobufs;e=(b=g)!=null?b:{};g=e.has_more_after;b=e.has_more_before;var t=e.next_message_timestamp_ms_after;e=e.next_message_timestamp_ms_before;if(b==null||g==null||t==null||e==null)return;if(s.length===0){var u;(u=d("EBAPIQPLPoints")).ebAPIAddQPLPoint(i,h,u.EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_START,void 0,q);var v=(yield o.runInTransaction(function(a){return c("LSDecryptMessagesStoredProcedure")(c("LSFactory")(a),{actThreadId:p,encryptedMessages:c("LSVec").ofArray(r)})},"readwrite",void 0,void 0,f.id+":1144"));u.ebAPIAddQPLPoint(i,h,u.EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_END,void 0,q);u=v[0];if(u!=null){d("EBAPIQPLPoints").ebAPIAddQPLPoint(i,h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.ECHO_DECODE_START,void 0,q);v=c("LSVec").toArray(u).map(function(a){return d("LSShape").toRecord(a).value}).map(function(a){return d("MAWJobDefinitions").toEncodedEchoMessage(a)});u={echoMessages:v,hasMoreAfter:g,hasMoreBefore:b,isPointQuery:!1,mpsMessageQuery:void 0,nextMessageTimestampMsAfter:(j||(j=d("I64"))).of_string(t),nextMessageTimestampMsBefore:j.of_string(e),referenceTimestamp:m!=null?m:void 0,requestId:a,taskSource:n!=null?n:void 0};return u}}else{d("EBAPIQPLPoints").ebAPIAddQPLPoint(i,h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_START,void 0,q);v=(yield o.runInTransaction(function(a){return c("LSDecryptMessageProtobufsStoredProcedure")(c("LSFactory")(a),{actThreadId:p,encryptedMessagesWithProtobufs:c("LSVec").ofArray(s)})},"readwrite",void 0,void 0,f.id+":1207"));u=v[0];o=v[1];if(o!=null){v=d("LSShape").toRecord(o);d("WALogger").ERROR(l(),v.error_message)}d("EBAPIQPLPoints").ebAPIAddQPLPoint(i,h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_END,void 0,q);if(u==null){d("WALogger").ERROR(k());d("EBAPIQPLPoints").ebAPIAddQPLPoint(i,h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.PROTOBUF_DECRYPTION_FAILURE,void 0,q);return}o=d("MAWEncryptedBackupUtils").convertLSTypesToJSTypesForRestoreJob(u);v={hasMoreAfter:g,hasMoreBefore:b,isPointQuery:!1,mpsMessageQuery:void 0,nextMessageTimestampMsAfter:(j||(j=d("I64"))).of_string(t),nextMessageTimestampMsBefore:j.of_string(e),protobufMessages:o,referenceTimestamp:m!=null?m:void 0,requestId:a,taskSource:n!=null?n:void 0};return v}});return K.apply(this,arguments)}g.processMessageArray=A;g.getClientState=a;g.deriveAndStoreEpochs=G;g.handleGraphQLRestoreResponse=e;g.processEncryptedMessagesWithoutPersisting=J}),98);
__d("EBAPISharedUtils",["EBAPIQPLPoints","I64","LSAuthorityLevel","LSDeleteAndReenrollDeviceStateStoredProcedure","LSFactory","LSIntEnum","LSMEBDeviceReenrollmentReason","MAWBridgeSafeActionsWorkerAndUI","MAWRotateDTSG","MWEBODSEntityName.enum","ODS","Promise","WALogger","asyncToGeneratorRuntime","handleRestoreMessagesGraphQLResponse"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Echo to protobuf conversion failed in search range restore response: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] backup_id is null during graphQL restore"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message range info is not complete - cannot proceed with graphQL restore"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message range info is null - cannot proceed with graphQL restore"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] server side exception during graphql restore - ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] GQL worker range restore query returned null for message response"]);q=function(){return a};return a}function a(a,b){if(a!=null){b=b.filter(function(a){return(i||(i=d("I64"))).equal(a.authorityLevel,(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))}).map(function(a){return(i||(i=d("I64"))).to_string(a.epochId)});return{backupId:a.backupId,device_id:a.deviceId,locally_available_epochs:b,mailboxRootKey:a.mailboxRootKeyBlob,ocmfClientStateBlob:a.ocmfClientStateBlob}}}function e(a){var b=a==null?void 0:a.backupTenancy;a=a==null?void 0:a.authorityLevel;return b==null||a==null?!1:(i||(i=d("I64"))).equal((j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE),a)}function r(a){var b=a.backupId,c=a.devicePrivateKeyBlob,d=a.devicePublicKeyBlob,e=a.epochAuthPrivateKeyBlob,f=a.epochAuthPublicKeyBlob,g=a.epochStoragePrivateKeyBlob,h=a.epochStoragePublicKeyBlob,i=a.mailboxRootKeyBlob,j=a.obliviousValidationTokenBlob,k=a.ocmfClientStateBlob;if(b!=null&&c!=null&&d!=null&&e!=null&&f!=null&&g!=null&&h!=null&&i!=null&&j!=null&&k!=null)return{authorityLevel:a.authorityLevel,backupId:b,backupTenancy:a.backupTenancy,deviceId:a.deviceId,devicePrivateKeyBlob:c,devicePublicKeyBlob:d,encryptionVersion:a.encryptionVersion,epochAuthPrivateKeyBlob:e,epochAuthPublicKeyBlob:f,epochStoragePrivateKeyBlob:g,epochStoragePublicKeyBlob:h,mailboxRootKeyBlob:i,obliviousValidationTokenBlob:j,ocmfClientStateBlob:k,revisionVersion:a.revisionVersion}}function s(a){var b=a.authorityLevel,c=a.backupId,d=a.epochAnonIdBlob,e=a.epochId,f=a.epochRootKeyBlob;a=a.epochStatus;if(b!=null&&c!=null&&d!=null&&e!=null&&f!=null&&a!=null)return{authorityLevel:b,backupId:c,epochAnonIdBlob:d,epochId:e,epochRootKeyBlob:f,epochStatus:a}}function t(a){var b=[],c=new Set(["epochId","authorityLevel","backupId","epochAnonIdBlob","epochRootKeyBlob","epochStatus"]);a=a.get("secure_encrypted_backups_epochs");if(a==null||(a==null?void 0:a.size)===0)return b;if(a!=null){a=a.entries();for(a of a){var d=a[0];a[1];d=d;if(d instanceof Object){d=Object.values(d);d=d[1];if(d instanceof Object){var e={};for(d of Object.entries(d)){var f=d[0],g=d[1];c.has(f)&&(e[f]=g)}f=s(e);f!=null&&b.push(f)}}}}return b}function u(a){a=a.get("secure_encrypted_backups_client_state");var b={};if(a==null||(a==null?void 0:a.size)===0)return;if(a!=null){a=a.entries();for(a of a){var c=a[0];a[1];c=c;if(c instanceof Object){c=Object.values(c);c=c[1];if(c instanceof Object)for(c of Object.entries(c)){var d=c[0],e=c[1];b[d]=e}}break}}d=r(b);return d}function v(a){(k||(k=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,a)}function w(a,b,c,d,e,f,g,h,i,j,k,l){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,g,h,k,r,s,t,u,v,w){var x;d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_END,void 0,h);if(a==null||(a==null?void 0:(x=a.viewer)==null?void 0:(x=x.encrypted_backup)==null?void 0:x.mailbox)==null){d("EBAPIQPLPoints").ebAPIEndFailure(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,h);return{response:"invalid-graphql-response",success:!1}}a=(x=a==null?void 0:(x=a.viewer)==null?void 0:(x=x.encrypted_backup)==null?void 0:(x=x.mailbox)==null?void 0:x.messages)!=null?x:a==null?void 0:(x=a.viewer)==null?void 0:(a=x.encrypted_backup)==null?void 0:(x=a.mailbox)==null?void 0:x.messages_point_restore;if(a==null){d("WALogger").ERROR(q());d("EBAPIQPLPoints").ebAPIEndFailure(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,h);return{response:"invalid-graphql-response",success:!1}}x=a;if((x==null?void 0:x.encrypted_messages)==null){d("EBAPIQPLPoints").ebAPIEndFailure(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NULL_MESSAGES,h);return{response:"invalid-graphql-response",success:!1}}a=x.backup_id;var y=x.encrypted_messages,z=x.epoch_derivation_set,A=x.exception_string,B=x.message_range_info;x=x.should_delete_mailbox;if(A!=null){d("WALogger").ERROR(p(),A);x===!0&&(d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DELETE_MAILBOX,void 0,h),yield g.runInTransaction(function(a){return c("LSDeleteAndReenrollDeviceStateStoredProcedure")(c("LSFactory")(a),{reenrollmentReason:(j||(j=d("LSIntEnum"))).ofNumber(c("LSMEBDeviceReenrollmentReason").RESTORE_FAILED_WITH_NO_DEVICE_FOUND),targetDeviceId:k})},"readwrite",void 0,void 0,f.id+":337"));d("EBAPIQPLPoints").ebAPIEndFailure(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,h,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,exception:A}});return{response:"server-side-exception",success:!1}}d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_START,void 0,h);yield d("handleRestoreMessagesGraphQLResponse").deriveAndStoreEpochs(z,g,k,u,b);d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_END,void 0,h);if(B==null){d("WALogger").ERROR(o());d("EBAPIQPLPoints").ebAPIEndFailure(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO,h);return{response:"missing-message-range-info",success:!1}}if(B!=null){x=B.has_more_after;A=B.has_more_before;z=B.next_message_timestamp_ms_after;var C=B.next_message_timestamp_ms_before;if(A==null||x==null||z==null||C==null){d("WALogger").ERROR(n());d("EBAPIQPLPoints").ebAPIEndFailure(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO,h);return{response:"missing-message-range-info",success:!1}}}a==null&&(d("WALogger").WARN(m()),d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.BACKUP_ID_NULL,void 0,h));d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.PROCESS_AND_DECRYPT_MESSAGES_START,void 0,h);A=(yield d("handleRestoreMessagesGraphQLResponse").processEncryptedMessagesWithoutPersisting({backupId:a!=null?a:(i||(i=d("I64"))).to_string(w),encryptedMessages:y,messageRangeInfo:B,qplEvent:e,runningInWorker:b,sortOrderMs:v,source:t,storage:g,threadId:r,traceId:u}));d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.PROCESS_AND_DECRYPT_MESSAGES_END,void 0,h);if(A==null){d("EBAPIQPLPoints").ebAPIEndFailure(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.EMPTY_DECRYPTION_RESPONSE,h);return{response:"empty-decryption-response",success:!1}}if(A.echoMessages!=null){x=A;z=x.echoMessages;d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.ECHO_TO_PROTOBUF_CONVERSION_START,void 0,h);try{C=(yield d("MAWBridgeSafeActionsWorkerAndUI").sendAndReceiveBackendWorkerAndUIShared("convertEchoMessagesToEBProtobufs",{chatJid:s,encodedEchoMessages:z}));d("EBAPIQPLPoints").ebAPIAddQPLPoint(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.ECHO_TO_PROTOBUF_CONVERSION_END,void 0,h);A=babelHelpers["extends"]({},A,{echoMessages:void 0,protobufMessages:(A.protobufMessages||[]).concat(C)})}catch(a){d("WALogger").ERROR(l(),a.message);d("EBAPIQPLPoints").ebAPIEndFailure(b,e,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.ECHO_TO_PROTOBUF_CONVERSION_FAILURE,h);return{response:"echo-to-protobuf-conversion-error",success:!1}}}d("EBAPIQPLPoints").ebAPIEndSuccess(b,e,h,{bool:{isEcho:((a=A)==null?void 0:a.echoMessages)?((w=A)==null?void 0:w.echoMessages.length)>0:!1,isProtobuf:((y=A)==null?void 0:y.protobufMessages)?((B=A)==null?void 0:B.protobufMessages.length)>0:!1}});return{response:A,success:!0}});return x.apply(this,arguments)}function y(a){return a!=null&&a.message.indexOf("1357004")!==-1?d("MAWRotateDTSG").tryRotateDTSG().then(function(a){if(a)return"token-rotation-successful";else return"token-rotation-failed"}):(h||(h=b("Promise"))).resolve("token-rotation-not-required")}g.getDeviceAndKeyMetadata=a;g.isBackupTenancyAuthoritative=e;g.getAvailableEpochsFromPersistedEBSM=t;g.getClientStateFromPersistedEBSM=u;g.bumpOdsRestoreKey=v;g.constructEBRestoreResponse=w;g.handleDTSGTokenRotation=y}),98);
__d("LSEncryptedBackupsBackupTenancy",[],(function(a,b,c,d,e,f){a=Object.freeze({PRODUCTION:1,SHADOW:2,OPEN:3});f["default"]=a}),66);
__d("EBIsEbEnabled",["FBLogger","I64","LSEncryptedBackupsBackupTenancy","LSIntEnum","MAWEBSwitch","MAWEncryptedBackupUtils","WAPubSub","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i;e=function(){function a(){this.$1=d("WAPubSub").simplePubSub(),this.$2=!1,this.$1.publish(!1)}var b=a.prototype;b.set=function(a){this.$2=a,this.$1.publish(a)};b.subscribe=function(a){return this.$1.subscribe(a)};b.isEnabled=function(){return this.$2};return a}();var j=new e();function a(a,b,e){return d("MAWEncryptedBackupUtils").getBackupTenancy(a,b,e).then(function(a){return a!=null&&(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION))}).then(function(a){j.set(a);return a})}function b(){try{return d("WAResultOrError").makeResult(c("MAWEBSwitch").isEnabled())}catch(a){c("FBLogger")("labyrinth_web").catching(a).mustfix("Failed to check EB enabled");return d("WAResultOrError").makeResult(!1)}}g.isEbEnabledPubSub=j;g.isEbEnabledLS=a;g.isEbEnabledEbSwitch=b}),98);
__d("EBMessagePointQueryWithPersistenceQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9664280036967963"}),null);
__d("EBMessagePointQueryWithPersistenceQuery.graphql",["EBMessagePointQueryWithPersistenceQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={defaultValue:null,kind:"LocalArgument",name:"app_id"},c={defaultValue:null,kind:"LocalArgument",name:"restore_payload_string"},d={defaultValue:null,kind:"LocalArgument",name:"restore_type"},e=[{kind:"Variable",name:"app_id",variableName:"app_id"},{kind:"Variable",name:"restore_payload_string",variableName:"restore_payload_string"},{kind:"Variable",name:"restore_type",variableName:"restore_type"}],f={alias:null,args:null,kind:"ScalarField",name:"encryption_version",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"epoch_id",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"encrypted_protobuf_stanza",storageKey:null},j={alias:null,args:null,kind:"ScalarField",name:"protobuf_timestamp_ms",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"sk_ciphertext",storageKey:null},l=[g,h];return{fragment:{argumentDefinitions:[a,c,d],kind:"Fragment",metadata:null,name:"EBMessagePointQueryWithPersistenceQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:e,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages_point_restore",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages"}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[c,d,a],kind:"Operation",name:"EBMessagePointQueryWithPersistenceQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:e,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages_point_restore",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMessage",kind:"LinkedField",name:"encrypted_messages",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEchoDocument",kind:"LinkedField",name:"echo_document",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"echo_document_string",storageKey:null},f,g,h,{alias:null,args:null,kind:"ScalarField",name:"epoch_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"otid",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanzas",kind:"LinkedField",name:"protobuf_stanzas",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"top_level_protobuf",plural:!1,selections:[i,f,g,h,j,k],storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"supplemental_protobufs",plural:!0,selections:[i,f,g,h,j,k,{alias:null,args:null,kind:"ScalarField",name:"supplemental_key",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_id",storageKey:null},{alias:null,args:null,concreteType:"XFBMessageRangeInfo",kind:"LinkedField",name:"message_range_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_more_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"has_more_after",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_after",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"should_delete_mailbox",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_string",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"thread_not_found",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochDerivationSet",kind:"LinkedField",name:"epoch_derivation_set",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupsEpochEdge",kind:"LinkedField",name:"epoch_edges",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"backward_edge",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochForwardEdge",kind:"LinkedField",name:"forward_edge",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"auth_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_entropy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entropy_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_storage_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"psk_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"from_epoch",plural:!1,selections:l,storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"to_epoch",plural:!1,selections:l,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"from_epoch_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"to_epoch_fingerprint",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:b("EBMessagePointQueryWithPersistenceQuery_facebookRelayOperation"),metadata:{},name:"EBMessagePointQueryWithPersistenceQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("MAWMainTraceUtils",["I64","LSRequestId","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return c("LSRequestId").generate()}function e(a,b,c,d,e,f,g){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,i){yield a.data_trace_meta.add({contextOne:f,contextThree:i,contextTwo:g,foregroundTimestampMs:(h||(h=d("I64"))).zero,initTimestampMs:b,predefinedId:void 0,shouldFlush:!1,traceId:c,traceType:e})});return i.apply(this,arguments)}g.createTraceId=a;g.startTraceWithTxn=e}),98);
__d("XFBLSRestoreOperationType.facebook",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum").Mirrored(["DELTA_GENERIC_MESSAGE_SYNC","INITIAL_RESTORE","MESSAGE_QUERY_RESTORE","POINT_QUERY_RESTORE","RANGE_QUERY_RESTORE","SNAPSHOT_RESTORE","SURROUNDING_RESTORE","THREAD_POINT_QUERY_RESTORE","UNKNOWN"]);c=a;f["default"]=c}),66);
__d("EBMessagePointQueryWithPersistence",["Base64Utils","EBAPIQPLPoints","EBAPISharedUtils","EBAPIWorkerCheck","EBIsEbEnabled","EBMessagePointQueryWithPersistenceQuery.graphql","EBSMHydrationUtils","I64","LSDecryptMessageProtobufsStoredProcedure","LSDecryptMessagesStoredProcedure","LSDeleteAndReenrollDeviceStateStoredProcedure","LSEncryptedBackupsBackupTenancy","LSFactory","LSIntEnum","LSMEBDeviceReenrollmentReason","LSMEBTaskCreationSource","LSShape","LSVec","MAWBridge","MAWCurrentUser","MAWEBRestoreTrackingUtils","MAWEncryptedBackupUtils","MAWEncryptedBackupsPersistedDB","MAWJobDefinitions","MAWMainTraceUtils","QPLUserFlow","WAHashStringToNumber","WALogger","WAResultOrError","WorkerRelay","WorkerRelayNetwork","asyncToGeneratorRuntime","cr:14165","gkx","handleRestoreMessagesGraphQLResponse","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] graphQL point restore error ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[protobuf-only] decryptMessageProtobufs failed with error: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[protobuf-only] decryptMessageProtobufs failed with an error"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[echo-only][echo] decryptMessageEcho failed with error: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[echo-only][echo] decryptMessageEcho failed with an error."]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message range info is not complete - cannot proceed with graphQL restore"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] backup_id is null during graphQL restore"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] message range info is null - cannot proceed with graphQL restore"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] server side exception during graphql restore - ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] GQL worker point restore query returned null for message response"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] mandatory params of client state are null"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No client state found - unable to restore"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No client state found - unable to restore"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Calling EBLS without EBLS being available for message point query"]);x=function(){return a};return a}var y=h!==void 0?h:h=b("EBMessagePointQueryWithPersistenceQuery.graphql");function a(a){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e,g=a.jid,h=a.messageId,z=a.sortOrderMs,A=a.source,B=a.threadId;a=a.traceId;if(!d("EBAPIWorkerCheck").runningInWorker())return d("WAResultOrError").makeError("unsupported-context");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql");var C=a!=null?a:d("MAWMainTraceUtils").createTraceId(),D=d("WAHashStringToNumber").hashStringToNumber(C),E=c("qpl")._(521474469,"2612");c("QPLUserFlow").start(E,{annotations:{bool:{mainThreadRestore:!1,workerThreadRestore:!0},"int":{source:(e=A)!=null?e:c("LSMEBTaskCreationSource").UNKNOWN}},instanceKey:D});d("MAWEBRestoreTrackingUtils").markEBRestorePoint(A,C,"GQL_WORKER",!0);try{var F;if(b("cr:14165")==null){d("WALogger").ERROR(x());c("QPLUserFlow").endFailure(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.EBLS_NOT_INITIALIZED,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.EBLS_NOT_INITIALIZED}},instanceKey:D});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(C,!0,"ebls_not_initialized");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("ebls-not-intialized")}c("QPLUserFlow").addPoint(E,"before_ebls_initialization",{instanceKey:D});yield b("cr:14165").genLSClient();c("QPLUserFlow").addPoint(E,"after_ebls_initialization",{instanceKey:D});e=(yield b("cr:14165").getLSStorage());var G=(yield d("EBIsEbEnabled").isEbEnabledLS(e.tables));if(c("gkx")("2489")){var H=d("MAWEncryptedBackupsPersistedDB").getEBLSDB();H=(yield d("EBSMHydrationUtils").loadEBdataToEphemeralRestore(H));var I=d("EBAPISharedUtils").getClientStateFromPersistedEBSM(H);H=d("EBAPISharedUtils").getAvailableEpochsFromPersistedEBSM(H);if(I===null){d("WALogger").ERROR(w());c("QPLUserFlow").endFailure(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE}},instanceKey:D});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(C,!0,"no_client_state");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("no-client-state")}var J=G!=null?G:d("EBAPISharedUtils").isBackupTenancyAuthoritative(I);if(!J){c("QPLUserFlow").addPoint(E,"eb_not_enabled",{instanceKey:D});c("QPLUserFlow").endSuccess(E,{instanceKey:D});d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"eb_not_enabled",traceId:C});d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(C,!0);d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.success");return d("WAResultOrError").makeResult()}J=d("EBAPISharedUtils").getDeviceAndKeyMetadata(I,H)}else{I=(yield d("MAWEncryptedBackupUtils").getBackupTenancy(e.tables));H=G!=null?G:I!=null&&(i||(i=d("I64"))).equal(I,(j||(j=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION));if(!H){c("QPLUserFlow").addPoint(E,"eb_not_enabled",{instanceKey:D});c("QPLUserFlow").endSuccess(E,{instanceKey:D});d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"eb_not_enabled",traceId:C});d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(C,!0);d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.success");return d("WAResultOrError").makeResult()}d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"lsdb_singleton_retrieved",traceId:C});c("QPLUserFlow").addPoint(E,"lsdb_singleton_retrieved",{instanceKey:D});J=(yield d("handleRestoreMessagesGraphQLResponse").getClientState(e))}if(J==null){d("WALogger").ERROR(v());c("QPLUserFlow").endFailure(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE}},instanceKey:D});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(C,!0,"no_client_state");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("no-client-state")}G=J;I=G.backupId;var K=G.device_id;H=G.locally_available_epochs;var L=G.mailboxRootKey;G=G.ocmfClientStateBlob;if(I==null||K==null||L==null||G==null){d("WALogger").ERROR(u());c("QPLUserFlow").endFailure(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE}},instanceKey:D});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(C,!0,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE);d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("invalid-client-state")}d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotationsWorker({annotations:{string:{device_id:(i||(i=d("I64"))).to_string((F=(F=J)==null?void 0:F.device_id)!=null?F:(i||(i=d("I64"))).zero)}},pointName:"client_state_retrieved",traceId:C});c("QPLUserFlow").addPoint(E,"client_state_retrieved",{data:{string:{device_id:i.to_string((J=(F=J)==null?void 0:F.device_id)!=null?J:(i||(i=d("I64"))).zero)}},instanceKey:D});F=d("MAWCurrentUser").getAppID();d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"app_id_retrieved",traceId:C});c("QPLUserFlow").addPoint(E,"app_id_retrieved",{instanceKey:D});J={restore_context:{act_thread_id:d("MAWJobDefinitions").toThreadJidPrimaryId(B),site:"www",tam_thread_subtype:0},success:babelHelpers["extends"]({device_context:{device_id:i.to_string(K),locally_available_epochs:H,raw_tokens:{mailbox_root_key:d("Base64Utils").fromArrayBuffer(L),ocmf_client_state_blob:d("Base64Utils").fromArrayBuffer(G)}},message_id:h},z!=null?{reference_timestamp:z}:{})};d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"graphql_query_start",traceId:C});c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_START,{instanceKey:D});yield d("WorkerRelayNetwork").createWorkerNetworkExecute();L=(yield d("WorkerRelay").createWorkerQuery(y,{app_id:String((H=F)!=null?H:"0"),restore_payload_string:JSON.stringify(J),restore_type:"POINT_QUERY_RESTORE"}));d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"graphql_query_end",traceId:C});c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_END,{instanceKey:D});if(L==null||(L==null?void 0:(G=L.viewer)==null?void 0:(h=G.encrypted_backup)==null?void 0:h.mailbox)==null){c("QPLUserFlow").endFailure(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE}},instanceKey:D});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(C,!0,"gql_point_restore_exception");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("invalid-graphql-response")}G=L==null?void 0:(F=L.viewer)==null?void 0:(H=F.encrypted_backup)==null?void 0:(J=H.mailbox)==null?void 0:J.messages_point_restore;if(G==null){d("WALogger").ERROR(t());c("QPLUserFlow").endFailure(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE}},instanceKey:D});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(C,!0,"gql_point_restore_exception");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("invalid-graphql-response")}h=G;if((h==null?void 0:h.encrypted_messages)==null){c("QPLUserFlow").endFailure(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NULL_MESSAGES,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NULL_MESSAGES}},instanceKey:D});d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"null_messages",traceId:C});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(C,!0,"null_messages");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("invalid-graphql-response")}L=h.backup_id;F=h.encrypted_messages;H=h.epoch_derivation_set;J=h.exception_string;G=h.message_range_info;h=h.should_delete_mailbox;if(J!=null){d("WALogger").ERROR(s(),J);h===!0&&(c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DELETE_MAILBOX,{instanceKey:D}),yield e.runInTransaction(function(a){return c("LSDeleteAndReenrollDeviceStateStoredProcedure")(c("LSFactory")(a),{reenrollmentReason:(j||(j=d("LSIntEnum"))).ofNumber(c("LSMEBDeviceReenrollmentReason").RESTORE_FAILED_WITH_NO_DEVICE_FOUND),targetDeviceId:K})},"readwrite",void 0,void 0,f.id+":538"),d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"delete_mailbox",traceId:C}));c("QPLUserFlow").endFailure(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,exception:J}},instanceKey:D});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(C,!0,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,exception:J}});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("server-side-exception")}d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"derive_and_store_epochs_start",traceId:C});c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_START,{instanceKey:D});c("QPLUserFlow").addAnnotations(E,{bool:{hasEpochs:H!=null&&H.epoch_edges.length>0}},{instanceKey:D});yield d("handleRestoreMessagesGraphQLResponse").deriveAndStoreEpochs(H,e,K,C,!0);d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"derive_and_store_epochs_end",traceId:C});c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_END,{instanceKey:D});F.length===0&&(c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_MESSAGES_TO_RESTORE,{instanceKey:D}),d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"no_messages",traceId:C}));if(G==null){d("WALogger").ERROR(r());c("QPLUserFlow").endFailure(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO}},instanceKey:D});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(C,!0,"missing_message_range_info");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("missing-message-range-info")}L==null&&(d("WALogger").WARN(q()),c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.BACKUP_ID_NULL,{instanceKey:D}),d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"backup_id_null",traceId:C}));h=G.has_more_after;J=G.has_more_before;H=G.next_message_timestamp_ms_after;G=G.next_message_timestamp_ms_before;if(J==null||h==null||H==null||G==null){d("WALogger").ERROR(p());c("QPLUserFlow").endFailure(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO}},instanceKey:D});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(C,!0,"message_range_info_null");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("missing-message-range-info")}F=d("handleRestoreMessagesGraphQLResponse").processMessageArray(F,L!=null?L:(i||(i=d("I64"))).to_string(I),E,D);var M=F.encryptedLSEchoMessages,N=F.encryptedMessagesWithProtobufs;if(N.length===0){d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"decrypt_messages_echo_start",traceId:C});c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_START,{instanceKey:D});L=(yield e.runInTransaction(function(a){return c("LSDecryptMessagesStoredProcedure")(c("LSFactory")(a),{actThreadId:B,encryptedMessages:c("LSVec").ofArray(M)})},"readwrite",void 0,void 0,f.id+":752"));I=L[0];F=L[1];if(F!=null){L=d("LSShape").toRecord(F);d("WALogger").ERROR(o());d("WALogger").WARN(n(),L.error_message);c("QPLUserFlow").endFailure(E,"ECHO_DECRYPTION_FAILURE",{annotations:{string:{error_description:L.error_message}},instanceKey:D});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(a,!1,"ECHO_DECRYPTION_FAILURE",{string:{error_description:L.error_message}});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("echo-decryption-failure")}d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"decrypt_messages_echo_end",traceId:C});c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_END,{instanceKey:D});F=I;if(F!=null){L=c("LSVec").toArray(F).map(function(a){return d("LSShape").toRecord(a).value});c("promiseDone")(d("MAWBridge").getBridge().sendAndReceive("event","uiUpdate",{events:[{tag:"RestoreNativeOp",value:{chatJid:g,echoMessages:c("LSVec").ofArray(L),hasMoreAfter:h,hasMoreBefore:J,isPointQuery:!0,nextMessageTimestampMsAfter:(i||(i=d("I64"))).of_string(H),nextMessageTimestampMsBefore:i.of_string(G),referenceTimestamp:z!=null?(i||(i=d("I64"))).to_string(z):void 0,requestId:C,taskSource:(j||(j=d("LSIntEnum"))).ofNumber((I=A)!=null?I:c("LSMEBTaskCreationSource").UNKNOWN),threadId:B}}]}))}}else{d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"decrypt_messages_protobuf_start",traceId:C});c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_START,{instanceKey:D});F=(yield e.runInTransaction(function(a){return c("LSDecryptMessageProtobufsStoredProcedure")(c("LSFactory")(a),{actThreadId:B,encryptedMessagesWithProtobufs:c("LSVec").ofArray(N)})},"readwrite",void 0,void 0,f.id+":856"));L=F[0];I=F[1];if(I!=null){e=d("LSShape").toRecord(I);d("WALogger").ERROR(m());d("WALogger").WARN(l(),e.error_message);c("QPLUserFlow").endFailure(E,"PROTOBUF_DECRYPTION_FAILURE",{annotations:{string:{error_description:e.error_message}},instanceKey:D});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(a,!1,"PROTOBUF_DECRYPTION_FAILURE",{string:{error_description:e.error_message}});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("protobuf-decryption-failure")}d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"decrypt_messages_protobuf_end",traceId:C});c("QPLUserFlow").addPoint(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_END,{instanceKey:D});if(L!=null){F=d("MAWEncryptedBackupUtils").convertLSTypesToJSTypesForRestoreJob(L);c("promiseDone")(d("MAWBridge").getBridge().sendAndReceive("event","uiUpdate",{events:[{tag:"RestoreNativeOp",value:{chatJid:g,decryptedMessagesProtobufs:F,hasMoreAfter:h,hasMoreBefore:J,isPointQuery:!0,nextMessageTimestampMsAfter:(i||(i=d("I64"))).of_string(H),nextMessageTimestampMsBefore:i.of_string(G),referenceTimestamp:z!=null?(i||(i=d("I64"))).to_string(z):void 0,requestId:C,taskSource:(j||(j=d("LSIntEnum"))).ofNumber((I=A)!=null?I:c("LSMEBTaskCreationSource").UNKNOWN),threadId:B}}]}))}else{c("QPLUserFlow").endFailure(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPTED_PROTOBUFS_NULL,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPTED_PROTOBUFS_NULL}},instanceKey:D});d("MAWEBRestoreTrackingUtils").addQPLRestorePointWorker({pointName:"decrypted_protobufs_null",traceId:C});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(C,!0,"decrypted_protobufs_null");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").makeError("invalid-graphql-response")}}c("QPLUserFlow").endSuccess(E,{annotations:{bool:{isEcho:N.length===0,isProtobuf:N.length>0}},instanceKey:D});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.success");return d("WAResultOrError").makeResult()}catch(b){d("WALogger").ERROR(k(),b);c("QPLUserFlow").endFailure(E,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RUNTIME_ERROR,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RUNTIME_ERROR,errorStackTrace:(a=b.stack)!=null?a:""}},error:b,instanceKey:D});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(C,!0,"gql_point_restore_exception");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.point.gql.error");return d("WAResultOrError").DEPRECATED_makeError("runtime-error",b)}});return z.apply(this,arguments)}g.pointRestoreQuery=y;g.messagePointQueryWithPersistence=a}),98);
__d("EBSMAPI",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=(a=c("requireDeferred"))("EBAddDeviceWithKeys").__setRef("EBSMAPI"),i=a("EBAddDeviceWithRecoveryCode").__setRef("EBSMAPI"),j=a("EBFetchBackupIds").__setRef("EBSMAPI"),k=a("EBGetEBState").__setRef("EBSMAPI"),l=a("EBInitializeBackup").__setRef("EBSMAPI"),m=a("EBIsEbEnabled").__setRef("EBSMAPI");b={addDeviceWithEBKeys:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return h.load().then(function(a){return a.addDeviceWithEBKeys.apply(a,b)})},addDeviceWithRecoveryCode:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return i.load().then(function(a){return a.addDeviceWithRecoveryCode.apply(a,b)})},fetchBackupIds:function(a){return j.load().then(function(b){return b.fetchBackupIds(a)})},getEBState:function(){return k.load().then(function(a){return a.GetEbState()})},initializeBackup:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return l.load().then(function(a){return a.initializeBackup.apply(a,b)})},isEbEnabled:function(){return m.load().then(function(a){return a.isEbEnabledEbSwitch()})}};d=b;g["default"]=d}),98);
__d("EBWorkerODSEntityName.enum",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({MW_EBSM_HYDRATION:"mw_ebsm_hydration",MW_EBSM_IDB:"mw_eb_ebsm_idb",MW_EBSM_CORRUPTION:"mw_ebsm_corruption",MW_EBSM_RESTORE_PERSISTENCE_ERROR:"mw_ebsm_restore_persistence",MW_EBSM_IDB_TABLE_DELETION:"mw_ebsm_idb_table_deletion",MW_EB_AUTO_RESTORE_AUTH_WORKER:"mw_eb_auto_restore_auth_worker",MW_EB_AUTO_RESTORE_AUTH_MAIN_THREAD:"mw_eb_auto_restore_auth_main_thread",MW_EB_DEVICE_MIGRATION_WORKER:"mw_eb_device_migration_worker",EB_WORKER_ADD_DEVICE_WITH_KEYS:"eb_worker_add_device_with_keys",EB_WORKER_ADD_DEVICE_WITH_RC:"eb_worker_add_device_with_rc",EB_WORKER_OPT_OUT:"eb_worker_opt_out"});c=a;f["default"]=c}),66);
__d("EncryptedBackupsUtils",["FBLogger","WAJids","WAStanzaUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";f=function(a){return Date.now()-a>d("WATimeUtils").DAY_MILLISECONDS*30};var h=function(a){return Date.now()-a>d("WATimeUtils").DAY_MILLISECONDS*30};function a(a,b,c,d,e){d={frankingTag:d==null?void 0:d.frankingTag,reportingTag:d==null?void 0:d.reportingTag};d={frankingMetadata:d,messageId:b,senderId:a,timestampMs:c};return{encryptedTransportMessage:e,metadata:d}}function b(a){return JSON.stringify([a.author,a.chat,a.externalId])}function e(a){a=JSON.parse(a);if(!Array.isArray(a))throw c("FBLogger")("labyrinth_web").mustfixThrow("Unable to parse msg id string as proper json");if(a.length!==3)throw c("FBLogger")("labyrinth_web").mustfixThrow("Parsed array should have 3 components");var b=d("WAJids").unsafeCoerceToUserJid(a[0]),e=d("WAJids").unsafeCoerceToChatJid(a[1]);a=d("WAStanzaUtils").toStanzaId(a[2]);return{author:b,chat:e,externalId:a}}g.entryOlderThan30Days=f;g.timestampOlderThan30Days=h;g.asBackupMessage=a;g.convertWAMsgIdToStringId=b;g.convertStringIdToWAMsgId=e}),98);
__d("LSEncryptedBackupsMessagesRangeQueryDirection",[],(function(a,b,c,d,e,f){a=Object.freeze({BEFORE:1,AFTER:2});f["default"]=a}),66);
__d("LSEncryptedBackupsOpStatus",[],(function(a,b,c,d,e,f){a=Object.freeze({SUCCESS:0,FAILURE:1,UNKNOWN:2});f["default"]=a}),66);
__d("LSFetchBackupIds",["LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFetchBackupIdsStoredProcedure] Beginning execution."),d[11]=c.i64.cast([0,0]),d[7]=d[11],d[8]=new c.Map(),d[8].set("backup_tenancy",a[0]),d[8].set("trace_id",void 0),d[9]=c.toJSON(d[8]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",c.i64.cast([0,50008]),d[9],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,d[7]).then(function(a){return a=a,d[10]=a[0],a})},function(a){return d[1]=c.i64.of_float(Date.now()),d[2]=c.i64.random(),d[4]="Finishing execution. Execution time: ",d[5]=c.i64.to_string(c.i64.sub(d[1],d[0])),d[6]=" ms",d[3]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsFetchBackupIdsStoredProcedure] ",d[3],d[4],d[3],d[5],d[3],d[6]].join("")),c.i64.eq(c.i64.mod_(d[2],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[7]=",",d[8]=c.createArray(),void 0!==void 0?d[9]=(d[8].push(void 0),d[8]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFetchBackupIdsStoredProcedure",[d[4],d[7],d[5],d[7],d[6]].join(""),d[8],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsFetchBackupIdsStoredProcedure";a.__tables__=["encrypted_backups"];e.exports=a}),null);
__d("LSFetchBackupIdsStoredProcedure",["LSFetchBackupIds","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSFetchBackupIds"),e.backupTenancy,e.traceId,e.isUiBlocking);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSGetLatestEpochKeys",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][getLatestEpochKeys] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[2]="",d[3]=void 0,d[4]=void 0,a[0]?c.resolve(0):(d[14]=void 0,c.i64.neq(d[14],void 0)?c.sequence([function(a){return c.count(c.db.table(169).fetch([[[d[14]]]])).then(function(a){return d[15]=a})},function(a){return c.i64.le(d[15],c.i64.cast([0,1]))?c.sequence([function(a){return c.db.table(169).fetch([[[d[14]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[25]=new c.Map(),d[25].set("error_msg","Expected a nonempty query result"),d[25].set("code",c.i64.cast([0,3])),d[25].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[26]=c.createArray(),d[27]=(d[26].push(d[25]),d[26]),e=[void 0,d[26]],d[21]=e[0],d[22]=e[1],e):(b=a.item,d[25]=new c.Map(),d[25].set("epoch_id",b.epochId),d[25].set("backup_id",b.backupId),d[25].set("epoch_anon_id_blob",b.epochAnonIdBlob),d[25].set("epoch_root_key_blob",b.epochRootKeyBlob),d[25].set("epoch_status",b.epochStatus),d[25].set("epoch_head",b.epochHead),d[25].set("authority_level",b.authorityLevel),e=[d[25],void 0],d[21]=e[0],d[22]=e[1],e)})},function(a){return d[24]=new c.Map(),d[24].set("value",d[21]),d[24].set("errors",d[22]),d[16]=d[24]}]):c.resolve((d[21]=new c.Map(),d[21].set("error_msg","Expected at most one result"),d[21].set("code",c.i64.cast([0,4])),d[21].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[22]=c.createArray(),d[24]=(d[22].push(d[21]),d[22]),d[23]=new c.Map(),d[23].set("value",void 0),d[23].set("errors",d[22]),d[16]=d[23]))},function(a){return d[17]=d[16].get("value"),d[17]!==void 0?(d[21]=d[17].get("epoch_id"),d[22]=d[17].get("backup_id"),d[23]=d[17].get("epoch_anon_id_blob"),d[24]=d[17].get("epoch_root_key_blob"),d[25]=d[17].get("epoch_status"),d[26]=d[17].get("epoch_head"),d[27]=d[17].get("authority_level"),d[28]=d[16],d[18]=d[28]):(d[21]=d[16].get("errors"),d[22]=d[16].get("errors"),d[23]=new c.Map(),d[23].set("value",void 0),d[23].set("errors",d[21]),d[18]=d[23]),d[19]=d[18].get("value"),d[19]!==void 0?(d[21]=d[19].get("epoch_id"),d[22]=d[19].get("backup_id"),d[23]=d[19].get("epoch_anon_id_blob"),d[24]=d[19].get("epoch_root_key_blob"),d[25]=d[19].get("epoch_status"),d[26]=d[19].get("epoch_head"),d[27]=d[19].get("authority_level"),d[2]=c.blobs.to_string(d[23]),d[3]=d[21],d[4]=d[24],d[20]=!0):(d[21]=d[18].get("errors"),d[22]=d[18].get("errors"),d[20]=!1)}]):c.resolve())},function(b){return c.i64.neq(d[3],void 0)?c.resolve(0):c.sequence([function(b){return d[14]=void 0,d[15]="",d[16]=void 0,c.forEach(c.filter(c.db.table(169).fetch(),function(b){return a[0]||c.i64.eq(b.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[18]=c.blobs.to_string(a.epochAnonIdBlob),c.i64.eq([0,d[18].length],[0,d[15].length])?d[17]=d[18]>d[15]:d[17]=c.i64.gt([0,d[18].length],[0,d[15].length]),d[17]?(d[14]=a.epochId,d[15]=d[18],d[16]=a.epochRootKeyBlob):0})},function(a){return c.i64.neq(d[14],void 0)?(d[2]=d[15],d[3]=d[14],d[4]=d[16],d[17]=c.i64.of_float(Date.now()),0):0}])},function(a){return d[10]=c.blobs.of_string(d[2]),c.i64.neq(d[3],void 0)?(c.blobs.neq(d[10],void 0)?(c.blobs.neq(d[4],void 0)?(d[18]=new c.Map(),d[18].set("epoch_id",d[3]),d[18].set("epoch_root_key",d[4]),d[18].set("epoch_anon_id",d[10]),d[19]=new c.Map(),d[19].set("epoch_keys",d[18]),a=[d[19],void 0],d[16]=a[0],d[17]=a[1],a):(d[18]=new c.Map(),d[18].set("error_code",c.i64.cast([0,402])),d[18].set("error_message","failed to query latest epoch"),d[18].set("stored_procedure","LSEncryptedBackupsGetLatestEpochKeysStoredProcedure"),a=[void 0,d[18]],d[16]=a[0],d[17]=a[1],a),a=[d[16],d[17]],d[14]=a[0],d[15]=a[1],a):(d[16]=new c.Map(),d[16].set("error_code",c.i64.cast([0,403])),d[16].set("error_message","failed to query latest epoch"),d[16].set("stored_procedure","LSEncryptedBackupsGetLatestEpochKeysStoredProcedure"),a=[void 0,d[16]],d[14]=a[0],d[15]=a[1],a),a=[d[14],d[15]],d[5]=a[0],d[6]=a[1],a):(d[14]=new c.Map(),d[14].set("error_code",c.i64.cast([0,400])),d[14].set("error_message","failed to query latest epoch"),d[14].set("stored_procedure","LSEncryptedBackupsGetLatestEpochKeysStoredProcedure"),a=[void 0,d[14]],d[5]=a[0],d[6]=a[1],a),d[7]=c.i64.of_float(Date.now()),d[8]=c.i64.random(),d[11]="Finishing execution. Execution time: ",d[12]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[13]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][getLatestEpochKeys] ",d[9],d[11],d[9],d[12],d[9],d[13]].join("")),c.i64.eq(c.i64.mod_(d[8],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[14]=",",d[15]=c.createArray(),void 0!==void 0?d[16]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"getLatestEpochKeys",[d[11],d[14],d[12],d[14],d[13]].join(""),d[15],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[5],d[6]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsGetLatestEpochKeysStoredProcedure";a.__tables__=["secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSHotEmojiSize",[],(function(a,b,c,d,e,f){a=Object.freeze({NONE:0,SMALL:1,MEDIUM:2,LARGE:3});f["default"]=a}),66);
__d("LSLoadThreadPkFromThreadId",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadThreadPkFromThreadId] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(173).fetch(),function(b){return c.i64.to_string(b.jid)===a[0]}).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,100])),d[13].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[13].set("error_message",""),e=[void 0,d[13]],d[2]=e[0],d[3]=e[1],e):(b=a.item,e=[b.clientThreadPk,void 0],d[2]=e[0],d[3]=e[1],e)})},function(a){return c.i64.neq(d[2],void 0)?(a=[d[2],d[3]],d[5]=a[0],d[6]=a[1],a):(d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,7])),d[13].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[13].set("error_message",""),c.i64.neq(void 0,void 0)?(a=[void 0,d[13]],d[14]=a[0],d[15]=a[1],a):(d[16]=new c.Map(),d[16].set("error_code",c.i64.cast([0,100])),d[16].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[16].set("error_message",""),a=[void 0,d[16]],d[14]=a[0],d[15]=a[1],a),a=[d[14],d[15]],d[5]=a[0],d[6]=a[1],a),d[7]=c.i64.of_float(Date.now()),d[8]=c.i64.random(),d[10]="Finishing execution. Execution time: ",d[11]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[12]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadThreadPkFromThreadId] ",d[9],d[10],d[9],d[11],d[9],d[12]].join("")),c.i64.eq(c.i64.mod_(d[8],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[13]=",",d[14]=c.createArray(),void 0!==void 0?d[15]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"loadThreadPkFromThreadId",[d[10],d[13],d[11],d[13],d[12]].join(""),d[14],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[5],d[6]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure";a.__tables__=["mi_act_mapping_table"];e.exports=a}),null);
__d("LSIssueMessageRangeQueryTask",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSFlushDataTrace.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewTask","LSLoadThreadPkFromThreadId","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] Beginning execution."),d[10]=c.i64.gt(a[1],c.i64.cast([0,0]))&&c.i64.gt(a[5],c.i64.cast([0,0])),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[14]=new c.Map(),d[14].set("error_msg","Expected a nonempty query result"),d[14].set("code",c.i64.cast([0,3])),d[14].set("src_line","MEBClientStateUtils.php:244 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[15]=c.createArray(),d[16]=(d[15].push(d[14]),d[15]),e=[void 0,d[15]],d[1]=e[0],d[2]=e[1],e):(b=a.item,d[14]=new c.Map(),d[14].set("backup_id",b.backupId),d[14].set("device_public_key_blob",b.devicePublicKeyBlob),d[14].set("device_private_key_blob",b.devicePrivateKeyBlob),d[14].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[14].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[14].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[14].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[14].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[14].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[14].set("orf_client_state_v2_blob",void 0),d[14].set("orf_v2_authority_level",void 0),d[14].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[14].set("device_id",b.deviceId),d[14].set("backup_tenancy",b.backupTenancy),d[14].set("encryption_version",b.encryptionVersion),d[14].set("revision_version",b.revisionVersion),d[14].set("initialize_restore_result",void 0),d[14].set("authority_level",b.authorityLevel),e=[d[14],void 0],d[1]=e[0],d[2]=e[1],e)})},function(e){return d[4]=new c.Map(),d[4].set("value",d[1]),d[4].set("errors",d[2]),d[5]=d[4].get("value"),d[5]!==void 0?c.sequence([function(e){return d[14]=d[5].get("backup_id"),d[15]=d[5].get("device_public_key_blob"),d[16]=d[5].get("device_private_key_blob"),d[17]=d[5].get("epoch_storage_public_key_blob"),d[18]=d[5].get("epoch_storage_private_key_blob"),d[19]=d[5].get("epoch_auth_public_key_blob"),d[20]=d[5].get("epoch_auth_private_key_blob"),d[21]=d[5].get("mailbox_root_key_blob"),d[22]=d[5].get("ocmf_client_state_blob"),d[23]=d[5].get("orf_client_state_v2_blob"),d[24]=d[5].get("orf_v2_authority_level"),d[25]=d[5].get("oblivious_validation_token_blob"),d[26]=d[5].get("device_id"),d[27]=d[5].get("backup_tenancy"),d[28]=d[5].get("encryption_version"),d[29]=d[5].get("revision_version"),d[30]=d[5].get("initialize_restore_result"),d[31]=d[5].get("authority_level"),c.i64.neq(d[26],void 0)?c.sequence([function(a){return d[33]=void 0,c.i64.neq(d[33],void 0)?c.resolve(d[34]=d[33]):c.sequence([function(a){return d[39]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[40]=a[0],a})},function(a){return d[40]?d[49]=(d[39].push(c.i64.cast([0,0])),d[39]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[41]=a[0],a})},function(a){return d[41]?d[49]=(d[39].push(c.i64.cast([0,2])),d[39]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[42]=a[0],a})},function(a){return d[42]?d[49]=(d[39].push(c.i64.cast([0,3])),d[39]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[43]?d[49]=(d[39].push(c.i64.cast([0,4])),d[39]):0,d[44]=c.createArray(),d[45]=c.i64.of_int32(d[39].length),c.i64.gt(d[45],c.i64.cast([0,0]))?c.loopAsync(d[45],function(a){return d[49]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[39],d[49]).then(function(a){return a=a,d[50]=a[0],d[51]=a[1],a})},function(a){return d[52]=(d[44].push(d[50]),d[44])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[49]=c.createArray(),d[50]=c.i64.of_int32(d[44].length),c.i64.gt(d[50],c.i64.cast([0,0]))?c.loopAsync(d[50],function(a){return d[52]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[44],d[52]).then(function(a){return a=a,d[53]=a[0],d[54]=a[1],a})},function(a){return d[55]=(d[49].push(c.i64.to_string(d[53])),d[49])}])}):c.resolve()},function(a){return d[51]=d[49].join(","),d[46]=d[51]}])},function(a){return d[44].some(function(a){return c.i64.eq(d[28],a)})?d[47]=d[28]:d[47]=void 0,c.i64.neq(d[47],void 0)?d[48]=d[47]:d[48]=void 0,d[34]=d[48]}])},function(e){return c.i64.neq(d[34],void 0)?d[35]=d[34]:d[35]=c.i64.cast([0,0]),c.i64.neq(d[27],void 0)?d[36]=d[27]:d[36]=c.i64.cast([0,1]),c.storedProcedure(b("LSLoadThreadPkFromThreadId"),a[0]).then(function(a){return a=a,d[37]=a[0],d[38]=a[1],a})},function(e){return c.i64.neq(d[37],void 0)?d[10]?c.sequence([function(e){return c.i64.eq(d[36],c.i64.cast([0,3]))?d[39]=c.i64.cast([0,4]):d[39]=c.i64.cast([0,0]),d[40]=new c.Map(),d[40].set("act_thread_id",a[0]),d[40].set("tam_thread_subtype",d[39]),d[40].set("source",a[6]),c.nativeOperation(b("LSBase64Encode.nop"),d[22]).then(function(a){return a=a,d[41]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[21]).then(function(a){return a=a,d[42]=a[0],a})},function(a){return d[43]=new c.Map(),d[43].set("ocmf_client_state_blob",d[41]==null?"":d[41]),d[43].set("mailbox_root_key",d[42]==null?"":d[42]),d[44]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[55]=(d[44].push(a.epochId),d[44])})},function(a){return d[53]="Queried locally available epochs. Count: ",d[45]=c.i64.of_int32(d[44].length),d[54]=c.i64.to_string(d[45]),d[46]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[46],d[53],d[46],d[54]].join("")),c.resolve()},function(e){return d[47]=new c.Map(),d[47].set("device_id",d[26]),d[47].set("raw_tokens",d[43]),d[47].set("locally_available_epochs",d[44]),d[48]=new c.Map(),d[48].set("reference_timestamp",a[2]),d[48].set("server_thread_key",void 0),d[48].set("device_context",d[47]),d[48].set("source",a[6]),d[49]=new c.Map(),d[49].set("restore_context",d[40]),d[49].set("success",d[48]),d[50]=d[49].get("restore_context"),d[51]=d[50].get("act_thread_id"),d[52]=c.toJSON(d[49]),c.storedProcedure(b("LSIssueNewTask"),["encrypted_backups_restore",":",d[51]].join(""),c.i64.cast([0,50031]),d[52],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.i64.gt(a[1],c.i64.cast([0,0]))?c.sequence([function(e){return c.i64.eq(d[36],c.i64.cast([0,3]))?d[39]=c.i64.cast([0,4]):d[39]=c.i64.cast([0,0]),a[7]===!0?d[40]=!0:d[40]=!1,d[41]=new c.Map(),d[41].set("act_thread_id",a[0]),d[41].set("request_id",a[4]),d[41].set("tam_thread_subtype",d[39]),d[41].set("reference_id",void 0),d[41].set("source",a[6]),c.nativeOperation(b("LSBase64Encode.nop"),d[22]).then(function(a){return a=a,d[42]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[21]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[44]=new c.Map(),d[44].set("ocmf_client_state_blob",d[42]==null?"":d[42]),d[44].set("mailbox_root_key",d[43]==null?"":d[43]),d[45]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[56]=(d[45].push(a.epochId),d[45])})},function(a){return d[54]="Queried locally available epochs. Count: ",d[46]=c.i64.of_int32(d[45].length),d[55]=c.i64.to_string(d[46]),d[47]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[47],d[54],d[47],d[55]].join("")),c.resolve()},function(e){return d[48]=new c.Map(),d[48].set("device_id",d[26]),d[48].set("raw_tokens",d[44]),d[48].set("locally_available_epochs",d[45]),d[49]=new c.Map(),d[49].set("reference_timestamp",a[2]),d[49].set("direction",c.i64.cast([0,1])),d[49].set("server_thread_key",void 0),d[49].set("device_context",d[48]),d[49].set("source",a[6]),d[49].set("include_offset",d[40]),d[50]=new c.Map(),d[50].set("restore_context",d[41]),d[50].set("success",d[49]),d[50].set("queue_name",void 0),d[51]=d[50].get("queue_name"),d[51]!==void 0?d[52]=d[51]:(d[56]=d[50].get("restore_context"),d[57]=d[56].get("act_thread_id"),d[52]=["encrypted_backups_restore",":",d[57]].join("")),d[53]=c.toJSON(d[50]),c.storedProcedure(b("LSIssueNewTask"),d[52],c.i64.cast([0,50030]),d[53],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.sequence([function(e){return c.i64.eq(d[36],c.i64.cast([0,3]))?d[39]=c.i64.cast([0,4]):d[39]=c.i64.cast([0,0]),a[7]===!0?d[40]=!0:d[40]=!1,d[41]=new c.Map(),d[41].set("act_thread_id",a[0]),d[41].set("request_id",a[4]),d[41].set("tam_thread_subtype",d[39]),d[41].set("reference_id",void 0),d[41].set("source",a[6]),c.nativeOperation(b("LSBase64Encode.nop"),d[22]).then(function(a){return a=a,d[42]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[21]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[44]=new c.Map(),d[44].set("ocmf_client_state_blob",d[42]==null?"":d[42]),d[44].set("mailbox_root_key",d[43]==null?"":d[43]),d[45]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[56]=(d[45].push(a.epochId),d[45])})},function(a){return d[54]="Queried locally available epochs. Count: ",d[46]=c.i64.of_int32(d[45].length),d[55]=c.i64.to_string(d[46]),d[47]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[47],d[54],d[47],d[55]].join("")),c.resolve()},function(e){return d[48]=new c.Map(),d[48].set("device_id",d[26]),d[48].set("raw_tokens",d[44]),d[48].set("locally_available_epochs",d[45]),d[49]=new c.Map(),d[49].set("reference_timestamp",a[2]),d[49].set("direction",c.i64.cast([0,2])),d[49].set("server_thread_key",void 0),d[49].set("device_context",d[48]),d[49].set("source",a[6]),d[49].set("include_offset",d[40]),d[50]=new c.Map(),d[50].set("restore_context",d[41]),d[50].set("success",d[49]),d[50].set("queue_name",void 0),d[51]=d[50].get("queue_name"),d[51]!==void 0?d[52]=d[51]:(d[56]=d[50].get("restore_context"),d[57]=d[56].get("act_thread_id"),d[52]=["encrypted_backups_restore",":",d[57]].join("")),d[53]=c.toJSON(d[50]),c.storedProcedure(b("LSIssueNewTask"),d[52],c.i64.cast([0,50030]),d[53],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.sequence([function(e){return d[10]?(d[41]=new c.Map(),d[41].set("error_code",c.i64.cast([0,100])),d[41].set("error_message",""),d[41].set("stored_procedure","issueMessageRangeQueryTask"),d[42]=new c.Map(),d[42].set("act_thread_id",a[0]),d[43]=new c.Map(),d[43].set("restore_context",d[42]),d[43].set("failure",d[41]),d[44]=d[43].get("restore_context"),d[45]=d[44].get("act_thread_id"),d[46]=c.toJSON(d[43]),c.storedProcedure(b("LSIssueNewTask"),["encrypted_backups_restore",":",d[45]].join(""),c.i64.cast([0,50031]),d[46],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[53]=new c.Map(),d[53].set("error_msg","Expected a nonempty query result"),d[53].set("code",c.i64.cast([0,3])),d[53].set("src_line","MEBClientStateUtils.php:244 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[54]=c.createArray(),d[55]=(d[54].push(d[53]),d[54]),e=[void 0,d[54]],d[41]=e[0],d[42]=e[1],e):(b=a.item,d[53]=new c.Map(),d[53].set("backup_id",b.backupId),d[53].set("device_public_key_blob",b.devicePublicKeyBlob),d[53].set("device_private_key_blob",b.devicePrivateKeyBlob),d[53].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[53].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[53].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[53].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[53].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[53].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[53].set("orf_client_state_v2_blob",void 0),d[53].set("orf_v2_authority_level",void 0),d[53].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[53].set("device_id",b.deviceId),d[53].set("backup_tenancy",b.backupTenancy),d[53].set("encryption_version",b.encryptionVersion),d[53].set("revision_version",b.revisionVersion),d[53].set("initialize_restore_result",void 0),d[53].set("authority_level",b.authorityLevel),e=[d[53],void 0],d[41]=e[0],d[42]=e[1],e)})},function(a){return d[44]=new c.Map(),d[44].set("value",d[41]),d[44].set("errors",d[42]),d[45]=d[44].get("value"),d[45]!==void 0?c.sequence([function(a){return d[53]=d[45].get("backup_id"),d[54]=d[45].get("device_public_key_blob"),d[55]=d[45].get("device_private_key_blob"),d[56]=d[45].get("epoch_storage_public_key_blob"),d[57]=d[45].get("epoch_storage_private_key_blob"),d[58]=d[45].get("epoch_auth_public_key_blob"),d[59]=d[45].get("epoch_auth_private_key_blob"),d[60]=d[45].get("mailbox_root_key_blob"),d[61]=d[45].get("ocmf_client_state_blob"),d[62]=d[45].get("orf_client_state_v2_blob"),d[63]=d[45].get("orf_v2_authority_level"),d[64]=d[45].get("oblivious_validation_token_blob"),d[65]=d[45].get("device_id"),d[66]=d[45].get("backup_tenancy"),d[67]=d[45].get("encryption_version"),d[68]=d[45].get("revision_version"),d[69]=d[45].get("initialize_restore_result"),d[70]=d[45].get("authority_level"),c.i64.neq(d[65],void 0)?c.sequence([function(a){return d[72]=void 0,c.i64.neq(d[72],void 0)?c.resolve(d[73]=d[72]):c.sequence([function(a){return d[76]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[77]=a[0],a})},function(a){return d[77]?d[86]=(d[76].push(c.i64.cast([0,0])),d[76]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[78]=a[0],a})},function(a){return d[78]?d[86]=(d[76].push(c.i64.cast([0,2])),d[76]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[79]=a[0],a})},function(a){return d[79]?d[86]=(d[76].push(c.i64.cast([0,3])),d[76]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[80]=a[0],a})},function(a){return d[80]?d[86]=(d[76].push(c.i64.cast([0,4])),d[76]):0,d[81]=c.createArray(),d[82]=c.i64.of_int32(d[76].length),c.i64.gt(d[82],c.i64.cast([0,0]))?c.loopAsync(d[82],function(a){return d[86]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[76],d[86]).then(function(a){return a=a,d[87]=a[0],d[88]=a[1],a})},function(a){return d[89]=(d[81].push(d[87]),d[81])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[86]=c.createArray(),d[87]=c.i64.of_int32(d[81].length),c.i64.gt(d[87],c.i64.cast([0,0]))?c.loopAsync(d[87],function(a){return d[89]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[81],d[89]).then(function(a){return a=a,d[90]=a[0],d[91]=a[1],a})},function(a){return d[92]=(d[86].push(c.i64.to_string(d[90])),d[86])}])}):c.resolve()},function(a){return d[88]=d[86].join(","),d[83]=d[88]}])},function(a){return d[81].some(function(a){return c.i64.eq(d[67],a)})?d[84]=d[67]:d[84]=void 0,c.i64.neq(d[84],void 0)?d[85]=d[84]:d[85]=void 0,d[73]=d[85]}])},function(a){return c.i64.neq(d[73],void 0)?d[74]=d[73]:d[74]=c.i64.cast([0,0]),c.i64.neq(d[66],void 0)?d[75]=d[66]:d[75]=c.i64.cast([0,1]),d[71]=d[65]}]):c.resolve(d[71]=void 0)},function(a){return d[46]=d[71]}]):c.resolve((d[53]=d[44].get("errors"),d[54]=d[44].get("errors"),d[46]=void 0))},function(e){return d[47]=new c.Map(),d[47].set("error_code",c.i64.cast([0,100])),d[47].set("error_message",void 0==null?"":void 0),d[47].set("stored_procedure","issueMessageRangeQueryTask"),d[48]=new c.Map(),d[48].set("act_thread_id",a[0]),d[48].set("source",a[6]),d[48].set("restore_operation_type",c.i64.cast([0,2])),d[48].set("request_id",a[4]),d[48].set("device_id",d[46]),d[49]=new c.Map(),d[49].set("restore_context",d[48]),d[49].set("failure",d[47]),d[50]=d[49].get("queue_name"),d[50]!==void 0?d[51]=d[50]:(d[53]=d[49].get("restore_context"),d[54]=d[53].get("act_thread_id"),d[51]=["encrypted_backups_restore",":",d[54]].join("")),d[52]=c.toJSON(d[49]),c.storedProcedure(b("LSIssueNewTask"),d[51],c.i64.cast([0,50030]),d[52],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(e){return d[40]="threak pk not found for jid",d[40]!==void 0?c.sequence([function(e){return d[42]=["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",d[40]].join(""),function(a){c.logger(a).mustfix(a)}(d[42]),d[41]=c.createArray(),a[4]!==void 0?d[43]=(d[41].push(a[4]),d[41]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",d[40],d[41],c.i64.cast([0,3]))},function(e){return c.sequence([function(e){return a[4]!==void 0?c.sequence([function(e){return a[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,85]),c.i64.cast([0,2]),d[42],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[45]=a[0],a})},function(a){return d[45]?d[46]=!0:d[46]=!1,d[46]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[48]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[48]].join("")),d[47]=c.createArray(),void 0!==void 0?d[49]=(d[47].push(void 0),d[47]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[48],d[47],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[43]?d[44]=!0:d[44]=!1,d[44]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[46]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[46]].join("")),d[45]=c.createArray(),void 0!==void 0?d[47]=(d[45].push(void 0),d[45]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[46],d[45],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(e){return a[4]!==void 0?c.sequence([function(d){return a[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[43]?d[44]=!0:d[44]=!1,d[44]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[46]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[46]].join("")),d[45]=c.createArray(),void 0!==void 0?d[47]=(d[45].push(void 0),d[45]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[46],d[45],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[41]=a[0],a})},function(a){return d[41]?d[42]=!0:d[42]=!1,d[42]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[44]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[44]].join("")),d[43]=c.createArray(),void 0!==void 0?d[45]=(d[43].push(void 0),d[43]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[44],d[43],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[10]?d[39]=c.i64.cast([0,5]):d[39]=c.i64.cast([0,2])}])},function(a){return d[32]=!0}]):c.sequence([function(e){return d[10]?(d[35]=new c.Map(),d[35].set("error_code",c.i64.cast([0,1])),d[35].set("error_message",""),d[35].set("stored_procedure","issueMessageRangeQueryTask"),d[36]=new c.Map(),d[36].set("act_thread_id",a[0]),d[37]=new c.Map(),d[37].set("restore_context",d[36]),d[37].set("failure",d[35]),d[38]=d[37].get("restore_context"),d[39]=d[38].get("act_thread_id"),d[40]=c.toJSON(d[37]),c.storedProcedure(b("LSIssueNewTask"),["encrypted_backups_restore",":",d[39]].join(""),c.i64.cast([0,50031]),d[40],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[47]=new c.Map(),d[47].set("error_msg","Expected a nonempty query result"),d[47].set("code",c.i64.cast([0,3])),d[47].set("src_line","MEBClientStateUtils.php:244 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[48]=c.createArray(),d[49]=(d[48].push(d[47]),d[48]),e=[void 0,d[48]],d[35]=e[0],d[36]=e[1],e):(b=a.item,d[47]=new c.Map(),d[47].set("backup_id",b.backupId),d[47].set("device_public_key_blob",b.devicePublicKeyBlob),d[47].set("device_private_key_blob",b.devicePrivateKeyBlob),d[47].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[47].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[47].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[47].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[47].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[47].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[47].set("orf_client_state_v2_blob",void 0),d[47].set("orf_v2_authority_level",void 0),d[47].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[47].set("device_id",b.deviceId),d[47].set("backup_tenancy",b.backupTenancy),d[47].set("encryption_version",b.encryptionVersion),d[47].set("revision_version",b.revisionVersion),d[47].set("initialize_restore_result",void 0),d[47].set("authority_level",b.authorityLevel),e=[d[47],void 0],d[35]=e[0],d[36]=e[1],e)})},function(a){return d[38]=new c.Map(),d[38].set("value",d[35]),d[38].set("errors",d[36]),d[39]=d[38].get("value"),d[39]!==void 0?c.sequence([function(a){return d[47]=d[39].get("backup_id"),d[48]=d[39].get("device_public_key_blob"),d[49]=d[39].get("device_private_key_blob"),d[50]=d[39].get("epoch_storage_public_key_blob"),d[51]=d[39].get("epoch_storage_private_key_blob"),d[52]=d[39].get("epoch_auth_public_key_blob"),d[53]=d[39].get("epoch_auth_private_key_blob"),d[54]=d[39].get("mailbox_root_key_blob"),d[55]=d[39].get("ocmf_client_state_blob"),d[56]=d[39].get("orf_client_state_v2_blob"),d[57]=d[39].get("orf_v2_authority_level"),d[58]=d[39].get("oblivious_validation_token_blob"),d[59]=d[39].get("device_id"),d[60]=d[39].get("backup_tenancy"),d[61]=d[39].get("encryption_version"),d[62]=d[39].get("revision_version"),d[63]=d[39].get("initialize_restore_result"),d[64]=d[39].get("authority_level"),c.i64.neq(d[59],void 0)?c.sequence([function(a){return d[66]=void 0,c.i64.neq(d[66],void 0)?c.resolve(d[67]=d[66]):c.sequence([function(a){return d[70]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[71]=a[0],a})},function(a){return d[71]?d[80]=(d[70].push(c.i64.cast([0,0])),d[70]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[72]=a[0],a})},function(a){return d[72]?d[80]=(d[70].push(c.i64.cast([0,2])),d[70]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[73]=a[0],a})},function(a){return d[73]?d[80]=(d[70].push(c.i64.cast([0,3])),d[70]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[74]=a[0],a})},function(a){return d[74]?d[80]=(d[70].push(c.i64.cast([0,4])),d[70]):0,d[75]=c.createArray(),d[76]=c.i64.of_int32(d[70].length),c.i64.gt(d[76],c.i64.cast([0,0]))?c.loopAsync(d[76],function(a){return d[80]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[70],d[80]).then(function(a){return a=a,d[81]=a[0],d[82]=a[1],a})},function(a){return d[83]=(d[75].push(d[81]),d[75])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[80]=c.createArray(),d[81]=c.i64.of_int32(d[75].length),c.i64.gt(d[81],c.i64.cast([0,0]))?c.loopAsync(d[81],function(a){return d[83]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[75],d[83]).then(function(a){return a=a,d[84]=a[0],d[85]=a[1],a})},function(a){return d[86]=(d[80].push(c.i64.to_string(d[84])),d[80])}])}):c.resolve()},function(a){return d[82]=d[80].join(","),d[77]=d[82]}])},function(a){return d[75].some(function(a){return c.i64.eq(d[61],a)})?d[78]=d[61]:d[78]=void 0,c.i64.neq(d[78],void 0)?d[79]=d[78]:d[79]=void 0,d[67]=d[79]}])},function(a){return c.i64.neq(d[67],void 0)?d[68]=d[67]:d[68]=c.i64.cast([0,0]),c.i64.neq(d[60],void 0)?d[69]=d[60]:d[69]=c.i64.cast([0,1]),d[65]=d[59]}]):c.resolve(d[65]=void 0)},function(a){return d[40]=d[65]}]):c.resolve((d[47]=d[38].get("errors"),d[48]=d[38].get("errors"),d[40]=void 0))},function(e){return d[41]=new c.Map(),d[41].set("error_code",c.i64.cast([0,1])),d[41].set("error_message",void 0==null?"":void 0),d[41].set("stored_procedure","issueMessageRangeQueryTask"),d[42]=new c.Map(),d[42].set("act_thread_id",a[0]),d[42].set("source",a[6]),d[42].set("restore_operation_type",c.i64.cast([0,2])),d[42].set("request_id",a[4]),d[42].set("device_id",d[40]),d[43]=new c.Map(),d[43].set("restore_context",d[42]),d[43].set("failure",d[41]),d[44]=d[43].get("queue_name"),d[44]!==void 0?d[45]=d[44]:(d[47]=d[43].get("restore_context"),d[48]=d[47].get("act_thread_id"),d[45]=["encrypted_backups_restore",":",d[48]].join("")),d[46]=c.toJSON(d[43]),c.storedProcedure(b("LSIssueNewTask"),d[45],c.i64.cast([0,50030]),d[46],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(e){return d[34]="backup not found",d[34]!==void 0?c.sequence([function(e){return d[36]=["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",d[34]].join(""),function(a){c.logger(a).mustfix(a)}(d[36]),d[35]=c.createArray(),a[4]!==void 0?d[37]=(d[35].push(a[4]),d[35]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",d[34],d[35],c.i64.cast([0,3]))},function(e){return c.sequence([function(e){return a[4]!==void 0?c.sequence([function(e){return a[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,85]),c.i64.cast([0,2]),d[36],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[39]=a[0],a})},function(a){return d[39]?d[40]=!0:d[40]=!1,d[40]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[42]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[42]].join("")),d[41]=c.createArray(),void 0!==void 0?d[43]=(d[41].push(void 0),d[41]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[42],d[41],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[37]=a[0],a})},function(a){return d[37]?d[38]=!0:d[38]=!1,d[38]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[40]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[40]].join("")),d[39]=c.createArray(),void 0!==void 0?d[41]=(d[39].push(void 0),d[39]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[40],d[39],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(e){return a[4]!==void 0?c.sequence([function(d){return a[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[37]=a[0],a})},function(a){return d[37]?d[38]=!0:d[38]=!1,d[38]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[40]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[40]].join("")),d[39]=c.createArray(),void 0!==void 0?d[41]=(d[39].push(void 0),d[39]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[40],d[39],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[35]=a[0],a})},function(a){return d[35]?d[36]=!0:d[36]=!1,d[36]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[38]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[38]].join("")),d[37]=c.createArray(),void 0!==void 0?d[39]=(d[37].push(void 0),d[37]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[38],d[37],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[10]?d[33]=c.i64.cast([0,5]):d[33]=c.i64.cast([0,2]),d[32]=!1}])},function(a){return d[6]=d[32]}]):c.sequence([function(e){return d[14]=d[4].get("errors"),d[15]=d[4].get("errors"),d[10]?(d[18]=new c.Map(),d[18].set("error_code",c.i64.cast([0,1])),d[18].set("error_message",""),d[18].set("stored_procedure","issueMessageRangeQueryTask"),d[19]=new c.Map(),d[19].set("act_thread_id",a[0]),d[20]=new c.Map(),d[20].set("restore_context",d[19]),d[20].set("failure",d[18]),d[21]=d[20].get("restore_context"),d[22]=d[21].get("act_thread_id"),d[23]=c.toJSON(d[20]),c.storedProcedure(b("LSIssueNewTask"),["encrypted_backups_restore",":",d[22]].join(""),c.i64.cast([0,50031]),d[23],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[30]=new c.Map(),d[30].set("error_msg","Expected a nonempty query result"),d[30].set("code",c.i64.cast([0,3])),d[30].set("src_line","MEBClientStateUtils.php:244 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[31]=c.createArray(),d[32]=(d[31].push(d[30]),d[31]),e=[void 0,d[31]],d[18]=e[0],d[19]=e[1],e):(b=a.item,d[30]=new c.Map(),d[30].set("backup_id",b.backupId),d[30].set("device_public_key_blob",b.devicePublicKeyBlob),d[30].set("device_private_key_blob",b.devicePrivateKeyBlob),d[30].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[30].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[30].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[30].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[30].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[30].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[30].set("orf_client_state_v2_blob",void 0),d[30].set("orf_v2_authority_level",void 0),d[30].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[30].set("device_id",b.deviceId),d[30].set("backup_tenancy",b.backupTenancy),d[30].set("encryption_version",b.encryptionVersion),d[30].set("revision_version",b.revisionVersion),d[30].set("initialize_restore_result",void 0),d[30].set("authority_level",b.authorityLevel),e=[d[30],void 0],d[18]=e[0],d[19]=e[1],e)})},function(a){return d[21]=new c.Map(),d[21].set("value",d[18]),d[21].set("errors",d[19]),d[22]=d[21].get("value"),d[22]!==void 0?c.sequence([function(a){return d[30]=d[22].get("backup_id"),d[31]=d[22].get("device_public_key_blob"),d[32]=d[22].get("device_private_key_blob"),d[33]=d[22].get("epoch_storage_public_key_blob"),d[34]=d[22].get("epoch_storage_private_key_blob"),d[35]=d[22].get("epoch_auth_public_key_blob"),d[36]=d[22].get("epoch_auth_private_key_blob"),d[37]=d[22].get("mailbox_root_key_blob"),d[38]=d[22].get("ocmf_client_state_blob"),d[39]=d[22].get("orf_client_state_v2_blob"),d[40]=d[22].get("orf_v2_authority_level"),d[41]=d[22].get("oblivious_validation_token_blob"),d[42]=d[22].get("device_id"),d[43]=d[22].get("backup_tenancy"),d[44]=d[22].get("encryption_version"),d[45]=d[22].get("revision_version"),d[46]=d[22].get("initialize_restore_result"),d[47]=d[22].get("authority_level"),c.i64.neq(d[42],void 0)?c.sequence([function(a){return d[49]=void 0,c.i64.neq(d[49],void 0)?c.resolve(d[50]=d[49]):c.sequence([function(a){return d[53]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[54]=a[0],a})},function(a){return d[54]?d[63]=(d[53].push(c.i64.cast([0,0])),d[53]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[55]=a[0],a})},function(a){return d[55]?d[63]=(d[53].push(c.i64.cast([0,2])),d[53]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[56]=a[0],a})},function(a){return d[56]?d[63]=(d[53].push(c.i64.cast([0,3])),d[53]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[57]=a[0],a})},function(a){return d[57]?d[63]=(d[53].push(c.i64.cast([0,4])),d[53]):0,d[58]=c.createArray(),d[59]=c.i64.of_int32(d[53].length),c.i64.gt(d[59],c.i64.cast([0,0]))?c.loopAsync(d[59],function(a){return d[63]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[53],d[63]).then(function(a){return a=a,d[64]=a[0],d[65]=a[1],a})},function(a){return d[66]=(d[58].push(d[64]),d[58])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[63]=c.createArray(),d[64]=c.i64.of_int32(d[58].length),c.i64.gt(d[64],c.i64.cast([0,0]))?c.loopAsync(d[64],function(a){return d[66]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[58],d[66]).then(function(a){return a=a,d[67]=a[0],d[68]=a[1],a})},function(a){return d[69]=(d[63].push(c.i64.to_string(d[67])),d[63])}])}):c.resolve()},function(a){return d[65]=d[63].join(","),d[60]=d[65]}])},function(a){return d[58].some(function(a){return c.i64.eq(d[44],a)})?d[61]=d[44]:d[61]=void 0,c.i64.neq(d[61],void 0)?d[62]=d[61]:d[62]=void 0,d[50]=d[62]}])},function(a){return c.i64.neq(d[50],void 0)?d[51]=d[50]:d[51]=c.i64.cast([0,0]),c.i64.neq(d[43],void 0)?d[52]=d[43]:d[52]=c.i64.cast([0,1]),d[48]=d[42]}]):c.resolve(d[48]=void 0)},function(a){return d[23]=d[48]}]):c.resolve((d[30]=d[21].get("errors"),d[31]=d[21].get("errors"),d[23]=void 0))},function(e){return d[24]=new c.Map(),d[24].set("error_code",c.i64.cast([0,1])),d[24].set("error_message",void 0==null?"":void 0),d[24].set("stored_procedure","issueMessageRangeQueryTask"),d[25]=new c.Map(),d[25].set("act_thread_id",a[0]),d[25].set("source",a[6]),d[25].set("restore_operation_type",c.i64.cast([0,2])),d[25].set("request_id",a[4]),d[25].set("device_id",d[23]),d[26]=new c.Map(),d[26].set("restore_context",d[25]),d[26].set("failure",d[24]),d[27]=d[26].get("queue_name"),d[27]!==void 0?d[28]=d[27]:(d[30]=d[26].get("restore_context"),d[31]=d[30].get("act_thread_id"),d[28]=["encrypted_backups_restore",":",d[31]].join("")),d[29]=c.toJSON(d[26]),c.storedProcedure(b("LSIssueNewTask"),d[28],c.i64.cast([0,50030]),d[29],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(e){return d[17]="backup not found",d[17]!==void 0?c.sequence([function(e){return d[19]=["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",d[17]].join(""),function(a){c.logger(a).mustfix(a)}(d[19]),d[18]=c.createArray(),a[4]!==void 0?d[20]=(d[18].push(a[4]),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",d[17],d[18],c.i64.cast([0,3]))},function(e){return c.sequence([function(e){return a[4]!==void 0?c.sequence([function(e){return a[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,85]),c.i64.cast([0,2]),d[19],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[22]?d[23]=!0:d[23]=!1,d[23]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[25]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[25]].join("")),d[24]=c.createArray(),void 0!==void 0?d[26]=(d[24].push(void 0),d[24]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[25],d[24],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[21]=!0:d[21]=!1,d[21]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[23]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[23]].join("")),d[22]=c.createArray(),void 0!==void 0?d[24]=(d[22].push(void 0),d[22]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[23],d[22],c.i64.cast([0,3]))):c.resolve()}])}]):c.sequence([function(e){return a[4]!==void 0?c.sequence([function(d){return a[4]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[4],c.i64.cast([0,85]),c.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",""].join(""),void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[21]=!0:d[21]=!1,d[21]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[23]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[23]].join("")),d[22]=c.createArray(),void 0!==void 0?d[24]=(d[22].push(void 0),d[22]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[23],d[22],c.i64.cast([0,3]))):c.resolve()}]):c.resolve()},function(d){return a[4]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[4]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[18]?d[19]=!0:d[19]=!1,d[19]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[21]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[21]].join("")),d[20]=c.createArray(),void 0!==void 0?d[22]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[21],d[20],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[10]?d[16]=c.i64.cast([0,5]):d[16]=c.i64.cast([0,2]),d[6]=!1}])},function(a){return d[7]=c.i64.of_float(Date.now()),d[8]=c.i64.random(),d[11]="Finishing execution. Execution time: ",d[12]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[13]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ",d[9],d[11],d[9],d[12],d[9],d[13]].join("")),c.i64.eq(c.i64.mod_(d[8],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[14]=",",d[15]=c.createArray(),void 0!==void 0?d[16]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",[d[11],d[14],d[12],d[14],d[13]].join(""),d[15],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSIssueMessageRangeQueryTaskStoredProcedure",["LSIssueMessageRangeQueryTask","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSIssueMessageRangeQueryTask"),e.threadId,e.numMessages,e.startSortKey,e.isPointQuery,e.traceId,e.newerNumMessages,e.source,e.includeOffset);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSMessageReplySourceTypeV2",[],(function(a,b,c,d,e,f){a=Object.freeze({NONE:0,MESSAGE:1,STORY:2,FORWARD:3,FB_STORY_SHARE:4,IG_STORY_SHARE:5,STORY_BASE64_ENCODED:6,LIGHTWEIGHT_STATUS:7,CLOSE_FRIENDS:8,XMA:9,IG_NOTE:10,CLOSE_FRIENDS_NOTE_REPLY:11,LIGHTWEIGHT_STATUS_REACTION:12,FB_FEED_POST:13,HIGHLIGHTS_TAB_POST_REPLY:14,HIGHLIGHTS_TAB_LOCAL_EVENT_REPLY:15,SHARED_ALBUM:16,AVATAR_DETAIL:17,NOTE_REPLY_ARMADILLO:18,HIGHLIGHTS_TAB_CARDS_FOR_MOM:19,HIGHLIGHTS_TAB_CARDS_FOR_BIRTHDAY:20,NOTE_MENTION:21,FB_STORY_MENTION:22,EXPIRED_STORY:23,FB_PRODUCER_STORY_REPLY:24,FB_POST_MENTION:25});f["default"]=a}),66);
__d("LSReplyMessageAttachmentType",[],(function(a,b,c,d,e,f){a=Object.freeze({OTHER:0,PHOTO:1,VIDEO:2,GIF:3,STICKER:4,LINK:5,MULTIPHOTO:6,PERMANENT_RAVEN_PHOTO:7,PERMANENT_RAVEN_VIDEO:8,AUDIO:10,ROLL_CALL_PHOTO_CONTRIBUTION:11,ROLL_CALL_VIDEO_CONTRIBUTION:12,FEED_POST:13,POWER_UP:14,XMA:15,ROLL_CALL_TEXT_CONTRIBUTION:16,BLOKS_XMA:17,EPHEMERAL_RAVEN_MESSAGE:18,THIRD_PARTY_STICKER:19,SOUND_BITE:9});f["default"]=a}),66);
__d("LSSymmetricEncryptionCreateEncryptedData.nop",["SymmetricEncryptionCreateEncryptedData"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,d,e,f){return c("SymmetricEncryptionCreateEncryptedData")(d,e,f)};a.__nop_name__="LSSymmetricEncryptionCreateEncryptedData";g["default"]=a}),98);
__d("LSSymmetricEncryptionCreateEncryptedString.nop",["Base64Utils","CryptoLogger","LSCryptoUtils","LSSymmetricEncryptionCreateEncryptedData.nop","Promise","RetUtil"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e,f,g,i){var j=d("CryptoLogger").CryptoLogger("symmetric_encryption_create_encrypted_string");return c("LSSymmetricEncryptionCreateEncryptedData.nop")(a,e,f,g,d("LSCryptoUtils").strToBuf(i)).then(function(a){return a[0]}).then(function(a){return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult(a?d("Base64Utils").fromArrayBuffer(a):void 0))})["catch"](function(a){d("CryptoLogger").captureError(j,a).mustfix("symmetric string encryption failed");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())})};a.__nop_name__="LSSymmetricEncryptionCreateEncryptedString";g["default"]=a}),98);
__d("LSThreadMediaGalleryGroup",[],(function(a,b,c,d,e,f){a=Object.freeze({PHOTOS_AND_VIDEOS:0,FILES_ONLY:1,LINKS:2});f["default"]=a}),66);
__d("MAWAdminMsgNormalized",["MAWLocalizationType"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_PROMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_DEMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PHOTO:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UNPINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_UK_OSA_ADMIN_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_PROMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SELF_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CLEAR_PARTICIPANT_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_CURRENT_USER_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_TAKE_SCREENSHOT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_RECORD_SCREEN:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ADMIN_ONLY:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ALL_MEMBERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_CURRENT_USER_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_OWN_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE:return{contactIds:b,contents:[]};case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CREATED_POLL:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MIXED_POLL_UPDATE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_HOTLIKE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_CURRENT_USER_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS:a=b[0];var c=b[1];return{contactIds:[a],contents:[c]};case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PARTICIPANT_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_PARTICIPANT_NICKNAME:a=b[0];c=b[1];var e=b[2];return{contactIds:[a,c],contents:[e]};case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_AI_THEME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_THEME:a=b[0];c=b[1];e=b[2];return{contactIds:[a],contents:[c,e]};case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CHANGED_POLL_VOTE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_POLL_VOTE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_POLL_VOTE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_POLL_OPTION:a=b[0];c=b[1];b[2];return{contactIds:[a],contents:[c]};case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CHANGED_MULTIPLE_POLL_VOTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MULTIPLE_POLL_VOTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MULTIPLE_POLL_VOTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MULTIPLE_POLL_OPTIONS:e=b[0];a=b[1];c=b[2];b[3];return{contactIds:[e],contents:[a,c]};case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CHANGED_MULTIPLE_POLL_VOTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MULTIPLE_POLL_VOTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_POLL_VOTE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MULTIPLE_POLL_VOTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_POLL_VOTE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_AI_THEME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_THEME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_HOTLIKE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CREATED_POLL:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_POLL_OPTION:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MULTIPLE_POLL_OPTIONS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MIXED_POLL_UPDATE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CHANGED_POLL_VOTE:case d("MAWLocalizationType").LOCALIZATION_TYPE.POLL_UNSENT_UPDATE:default:return{contactIds:[],contents:b}}}g.deconstructContactIdsFromAdminContent=a}),98);
__d("MAWAsyncEBPendingQueryPromise",["Promise"],(function(a,b,c,d,e,f){"use strict";var g,h=new Map(),i=new Map(),j=new Map(),k=new Map(),l=new Map(),m=new Map();function a(a){var c=new(g||(g=b("Promise")))(function(b,c){i.set(a,b),k.set(a,c)});h.set(a,c);return c}function c(a,b){j.set(a,b)}function d(a){return j.get(a)}function e(a){var c=new(g||(g=b("Promise")))(function(b,c){l.set(a,{data:null,resolve:b}),m.set(a,c)});return c}function n(a,b){var c=i.get(a);c!=null&&(i["delete"](a),c(b));c=l.get(a);c!=null&&l.set(a,{data:b,resolve:c.resolve})}function o(a,b){var c=k.get(a);c!=null&&(i["delete"](a),c(b));c=m.get(a);c!=null&&(m["delete"](a),c(b),l["delete"](a))}function p(a){var b=l.get(a);b!=null&&b.data!=null&&(b.resolve(b.data),l["delete"](a),m["delete"](a))}f.getPendingQueryPromiseFromTrace=a;f.setJidFromThreadId=c;f.getJidFromThreadId=d;f.getWaitForRestorePromiseFromTrace=e;f.resolvePendingQueryIfPresent=n;f.rejectPendingQueryIfPresent=o;f.resolvePendingQueryUponReStore=p}),66);
__d("MAWDbChatId__UNSAFE_DO_NOT_USE",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return(h||(h=d("I64"))).of_float(a)}function b(a,b){return a+"_"+b}g.convertToChatId64__DEPRECATED=a;g.craftAltIndex__DEPRECATED=b}),98);
__d("MAWHexUtils",["err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.toString(16);return(a.length-1).toString(16)+a}function b(a){for(var b=1;b<a.length;b++){var d=a.substring(0,b),e=a.substring(b);if(e.length-1===parseInt(d,16))return parseInt(e,16)}throw c("err")("Cannot convert the order-preserving-hex back to number")}g.orderPreservingHex=a;g.reverseOrderPreservingHex=b}),98);
__d("WAMsg",["WAAssertUnreachable","WAJids","WAMsgType","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.author,c=a.chat;a=a.externalId;return c+"_"+a+"_"+b}function h(a){switch(a.type){case d("WAMsgType").MSG_TYPE.TEXT:case d("WAMsgType").MSG_TYPE.IMAGE:case d("WAMsgType").MSG_TYPE.VIDEO:case d("WAMsgType").MSG_TYPE.PTT:case d("WAMsgType").MSG_TYPE.GIF:case d("WAMsgType").MSG_TYPE.STICKER:case d("WAMsgType").MSG_TYPE.RECEIVER_FETCH:return{author:a.id.author,deleteTs:a.deleteTs,ephemeralSetting:a.ephemeralSetting,expirationTs:a.expirationTs,externalId:a.id.externalId,sentTs:a.sentTs,serverTs:a.serverTs,ts:a.ts};case d("WAMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("WAMsgType").MSG_TYPE.UNAVAILABLE:return{author:a.id.author,externalId:a.id.externalId,sentTs:a.sentTs,ts:a.ts};default:a.type;return null}}function b(a){var b=h(a);if(b==null)return null;switch(a.type){case d("WAMsgType").MSG_TYPE.TEXT:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("WAMsgType").MSG_TYPE.TEXT});case d("WAMsgType").MSG_TYPE.IMAGE:return babelHelpers["extends"]({},b,{mediaId:a.mediaId,type:d("WAMsgType").MSG_TYPE.IMAGE});case d("WAMsgType").MSG_TYPE.VIDEO:return babelHelpers["extends"]({},b,{mediaId:a.mediaId,type:d("WAMsgType").MSG_TYPE.VIDEO});case d("WAMsgType").MSG_TYPE.PTT:return babelHelpers["extends"]({},b,{mediaId:a.mediaId,type:d("WAMsgType").MSG_TYPE.PTT});case d("WAMsgType").MSG_TYPE.STICKER:return babelHelpers["extends"]({},b,{mediaId:a.mediaId,type:d("WAMsgType").MSG_TYPE.STICKER});case d("WAMsgType").MSG_TYPE.RECEIVER_FETCH:return babelHelpers["extends"]({},b,{type:d("WAMsgType").MSG_TYPE.RECEIVER_FETCH});case d("WAMsgType").MSG_TYPE.GIF:return babelHelpers["extends"]({},b,{mediaId:a.mediaId,type:d("WAMsgType").MSG_TYPE.PTT});case d("WAMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:return babelHelpers["extends"]({},b,{type:d("WAMsgType").MSG_TYPE.EXPIRED_EPHEMERAL});case d("WAMsgType").MSG_TYPE.UNAVAILABLE:return babelHelpers["extends"]({},b,{type:d("WAMsgType").MSG_TYPE.UNAVAILABLE});case d("WAMsgType").MSG_TYPE.REVOKED:case d("WAMsgType").MSG_TYPE.REACTION:case d("WAMsgType").MSG_TYPE.ICDC_ALERT:case d("WAMsgType").MSG_TYPE.ADMIN:case d("WAMsgType").MSG_TYPE.FUTUREPROOF:case d("WAMsgType").MSG_TYPE.CIPHERTEXT:case d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("WAMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("WAMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:case d("WAMsgType").MSG_TYPE.GROUP_INVITE:case d("WAMsgType").MSG_TYPE.DELETE_FOR_ME:case d("WAMsgType").MSG_TYPE.DOCUMENT_FILE:case d("WAMsgType").MSG_TYPE.EDIT_ACTION:return null;default:return c("WAAssertUnreachable")(a.type)}}function e(a){if(d("WAJids").isAuthorSystem(a.author))throw c("err")("Cannot send @system messages");else return{author:a.author,chat:a.chat,externalId:a.externalId}}g.craftWAMsgIdString=a;g.asQuotedMsg=b;g.asProtocolMsgId=e}),98);
__d("MAWDbMsg",["FBLogger","I64","MAWDbChatId__UNSAFE_DO_NOT_USE","MAWHexUtils","MAWMsgType","WAMsg","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i;i=[(i=d("MAWMsgType")).MSG_TYPE.REVOKED,i.MSG_TYPE.EPHEMERAL_SYNC_RESPONSE,i.MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE,i.MSG_TYPE.GROUP_INVITE,i.MSG_TYPE.SK_DISTRIBUTION,i.MSG_TYPE.RAVEN_ACTION];var j=0,k=Number.MAX_SAFE_INTEGER;function a(a){return a}function b(a){return a}function e(a){return x(a)?a:null}function f(a){return a}function l(a){return a}var m="futureproof",n="futureproof_spam",o="spam",p="toBeRead",q="e2ee_admin_msg",r="cutover_admin_msg";function s(a,b){return d("MAWHexUtils").orderPreservingHex(a)+"_"+d("MAWHexUtils").orderPreservingHex(b)+"_m"}function t(a,b,e){a=d("MAWHexUtils").orderPreservingHex(a)+"_"+d("MAWHexUtils").orderPreservingHex(b)+"_m";return!c("justknobx")._("621")?a:a+"_"+e.externalId}function u(a,b){return!c("justknobx")._("1903")?s(a,b):d("MAWHexUtils").orderPreservingHex(a)+"_"+d("MAWHexUtils").orderPreservingHex(b)+"_um"}function v(a,b){return!c("justknobx")._("1903")?s(a,b):d("MAWHexUtils").orderPreservingHex(a)+"_"+d("MAWHexUtils").orderPreservingHex(b)+"_r"}function w(a,b,c){c=(c=c)!=null?c:d("MAWHexUtils").orderPreservingHex(Math.floor(Math.random()*1e4));return d("MAWHexUtils").orderPreservingHex(a)+"_"+d("MAWHexUtils").orderPreservingHex(b)+"_DEBUG_"+c+")}"}function x(a){a=a.split("_");return a.length>=3&&a[0]!==""&&a[1]!==""&&a[2]==="m"}function y(a){return d("MAWDbChatId__UNSAFE_DO_NOT_USE").craftAltIndex__DEPRECATED(a,p)}function z(a){return d("MAWDbChatId__UNSAFE_DO_NOT_USE").craftAltIndex__DEPRECATED(a,q)}function A(a){return d("MAWDbChatId__UNSAFE_DO_NOT_USE").craftAltIndex__DEPRECATED(a,r)}function B(a){a=a.split("_");a[0];a=a[1];return d("MAWHexUtils").reverseOrderPreservingHex(a)}function C(a){return d("MAWHexUtils").orderPreservingHex(a)+"_"}function D(a){return d("MAWHexUtils").orderPreservingHex(a)+"_z"}function E(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.XMA:return!0;case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE:return!1}throw c("FBLogger")("messenger_web").mustfixThrow('Invalid msg type for isXMAMsg check: "%s"',a.type)}function F(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.RAVEN:return!0;case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.XMA:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE:return!1}throw c("FBLogger")("messenger_web").mustfixThrow('Invalid msg type for isMediaMsg check: "%s"',a.type)}function G(a){return a.type===d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH}function H(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:return!0;case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.XMA:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:return!1;default:c("FBLogger")("messenger_web").mustfix('Invalid msg type for isPhotoOrVideoMediaMsg check: "%s"',a.type);return!1}}function I(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return!0;case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.XMA:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:return!1;default:c("FBLogger")("messenger_web").mustfix('Invalid msg type for isDocumentFileMediaMsg check: "%s"',a.type);return!1}}function J(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:case d("MAWMsgType").MSG_TYPE.XMA:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:return!0;case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION:case d("MAWMsgType").MSG_TYPE.RAVEN_ACTION:case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:return!1}throw c("FBLogger")("messenger_web").mustfixThrow('Invalid msg type for isContentMsg check: "%s"',a.type)}function K(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.XMA:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return!0;case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:case d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION:case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:return!1}throw c("FBLogger")("messenger_web").mustfixThrow('Invalid msg type for isMsgEligibleForTriggeringEphemeralSyncResponse check: "%s"',a.type)}function L(a){return N(a.type)}function M(a){return a.type===d("MAWMsgType").MSG_TYPE.ADMIN}function N(a){return a==="EphemeralSyncResponse"||a==="EphemeralSettingChangeFromCurrentDevice"||a==="GroupInvite"||a==="SenderKeyDistribution"||a==="RavenAction"||a==="EditAction"}function O(a){return a==="RavenAction"}function P(a){return a.originalTs!=null?a.originalTs:Q(a)}function Q(a){return a.serverTs!=null?a.serverTs:a.ts}function R(a){if(a.sortOrderMs!=null)return a.sortOrderMs;else return Q(a)*1e3}function S(a,b){if(a.serverTs!=null)return Math.max(b+1,a.serverTs*1e3);else return b+1}function T(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.TEXT:return a.msgContent;case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:return a.editMsgContent;case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE:case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.XMA:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:return}throw c("FBLogger")("messenger_web").mustfixThrow('Invalid msg type for getMsgContent check: "%s"',a.type)}function U(a){return d("WAMsg").craftWAMsgIdString({author:a.author,chat:a.threadJid,externalId:a.externalId})}function V(a){return(h||(h=d("I64"))).to_float(a)}g.NO_CONTENT_MESSAGE_TYPES_ALLOWLIST=i;g.MIN_MSG_SORT_ORDER=j;g.MAX_MSG_SORT_ORDER=k;g.toCachedMsgId__UNSAFE_DO_NOT_USE=a;g.toMsgId__UNSAFE_DO_NOT_USE=b;g.toMsgId=e;g.stanzaIdToMsgId=f;g.instamadilloMsgIdToMsgId=l;g.FUTUREPROOF_ALT_INDEX=m;g.FUTUREPROOF_SPAM_ALT_INDEX=n;g.SPAM_ALT_INDEX=o;g.craftMsgId__DEPRECATED=s;g.craftMsgIdV2=t;g.craftUnrenderedMsgId=u;g.craftReactionId=v;g.craftDebugMsgId=w;g.isValidMsgId=x;g.craftToBeReadAltIndex=y;g.craftE2eeAdminMsgAltIndex=z;g.craftCutoverAdminMsgAltIndex=A;g.getInChatMsgIdFromMsgId=B;g.msgIdsInChatLowerBound=C;g.msgIdsInChatUpperBound=D;g.isXMAMsg=E;g.isMediaMsg=F;g.isReceiverFetchStickerMsg=G;g.isPhotoOrVideoMediaMsg=H;g.isDocumentFileMediaMsg=I;g.isContentMsg=J;g.isMsgEligibleForTriggeringEphemeralSyncResponse=K;g.isUnrenderedMsg=L;g.isAdminMsg=M;g.isUnrenderedMsgType=N;g.isRavenActionMsgType=O;g.getOriginalTsFromMsg=P;g.getCanonicalTsFromMsg=Q;g.getSortOrderWithFallback=R;g.getSortOrderFromPrevious=S;g.getMsgContent=T;g.getWAMsgId=U;g.convertMsgRowId64=V}),98);
__d("MAWMediaGalleryEBTaggingUtils",["LSThreadMediaGalleryGroup","qex"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a===void 0&&(a={isSilent:!1});return a.isSilent===!0?c("qex")._("3655")===!0:c("qex")._("1975")===!0}function b(a){return a===c("LSThreadMediaGalleryGroup").PHOTOS_AND_VIDEOS}g.isMediaGalleryEBTaggingRestoreEnabled=a;g.isMediaGalleryGroupSupportedForTaggedRestore=b}),98);
__d("MAWMediaGalleryM2Utils",["MAWMediaGalleryEBTaggingUtils","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){return c("gkx")("4219")}function a(){return c("justknobx")._("3060")&&(h()||d("MAWMediaGalleryEBTaggingUtils").isMediaGalleryEBTaggingRestoreEnabled({isSilent:!0}))}function b(){return c("gkx")("4219")}g.isMediaGalleryM2Enabled=h;g.shouldSkipSyncToLSDB=a;g.isFilesEBRestoreEnabled=b}),98);
__d("MAWUserJidWrapper",["ExecutionEnvironment","MAWCurrentUser","MAWODSProxy","WAGlobals","WAJids","WAOdsEnums"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){var a=d("WAJids").toMsgrUserJid(d("MAWCurrentUser").getID());if((h||(h=c("ExecutionEnvironment"))).isInWorker){var b=d("WAGlobals").getMyUserJid();d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_MY_USER_JID_GETTER,key:b===a?"same":"different"});return b}return a}g.getMyUserJid=a}),98);
__d("getReplyContentForNoteReply",["WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=a.author,e=a.msgId;c=d("WAJids").authorToUserId(c,b);b=(b=a.quote)==null?void 0:(b=b.content.msgContent)==null?void 0:b.content;a=(a=a.quote)==null?void 0:a.content.expirationTs;return{isNoteReply:!0,replyMediaExpirationTimestampMs:a!=null?a*1e3:void 0,replyMessageText:b,replySourceId:e,replyToUserId:c}}g["default"]=a}),98);
__d("MAWBridgeMsg",["LSHotEmojiSize","LSIntEnum","MAWDbMsg","MAWImageUtils","MAWMediaGalleryM2Utils","MAWMsgType","MAWUserJidWrapper","MAWVault","MAWXMAUtils","MWPBumpEntityKey","WAAssertUnreachable","WAHashUtils","WAJids","WALogger","WAMsgType","WATimeUtils","getReplyContentForNoteReply","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MAWBridgeMsg] Missing content for external link share XMA message"]);i=function(){return a};return a}function j(a,b,e){var f,g;f=((f=a.quote)==null?void 0:f.content.type)===d("WAMsgType").NOTE_REPLY;if(f)return c("getReplyContentForNoteReply")(a,e);f=(f=a.quote)==null?void 0:f.content;if(d("MAWXMAUtils").isXMAStoryShare(a.xmaMessageType)||d("MAWXMAUtils").isXMAStoryReaction(a.xmaMessageType)||d("MAWXMAUtils").isXMAStoryMention(a.xmaMessageType)||d("MAWXMAUtils").isXMAStoryHighlightShare(a.xmaMessageType)||d("MAWXMAUtils").isXMAMsgHighlightsTabFriendUpdatesReply(a.xmaMessageType)||d("MAWXMAUtils").isFBXMAPostMention(a.xmaMessageType)){var h=a.author,i=a.mediaId,j=a.msgId,k=d("WAJids").authorToUserId(h,e);if(d("MAWXMAUtils").isXMAStoryMention(a.xmaMessageType)||d("MAWXMAUtils").isFBXMAPostMention(a.xmaMessageType)){var l=a.threadJid,m;l!=null&&(m=d("WAJids").interpretAsUserJid(l));m!=null&&(k=d("WAJids").userIdFromJid(m))}i!=null&&a.plaintextHash==null&&d("MWPBumpEntityKey").bumpEntityKeyWithAppId("maw.reply_attachment_media_missing_plaintext_hash","bridge_msg_get_reply_content");return{isFBPostMention:d("MAWXMAUtils").isFBXMAPostMention(a.xmaMessageType),isFBStoryMention:d("MAWXMAUtils").isFBXMAStoryMention(a.xmaMessageType),isIGStoryMention:d("MAWXMAUtils").isIGXMAStoryMention(a.xmaMessageType),isIGXMAStoryShare:d("MAWXMAUtils").isIGXMAStoryShare(a.xmaMessageType),isMsgHighlightsTabFriendUpdatesReply:d("MAWXMAUtils").isXMAMsgHighlightsTabFriendUpdatesReply(a.xmaMessageType),isStoryHighlightShare:d("MAWXMAUtils").isXMAStoryHighlightShare(a.xmaMessageType),isStoryReaction:d("MAWXMAUtils").isXMAStoryReaction(a.xmaMessageType),isStoryReply:d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType),replyMediaExpirationTimestampMs:f==null?void 0:f.expirationTs,replyMediaId:i,replyMediaUrlMimeType:i!=null?"image/jpeg":void 0,replyPlaintextHash:(l=a.plaintextHash)!=null?l:void 0,replySenderIsMe:h===d("WAJids").AUTHOR_ME||k===e,replySourceId:j,replySourceTimestampMs:a.sortOrderMs,replyStatusType:i!=null?"Image":void 0,replyToUserId:k,storyShareAuthor:b==null?void 0:b.storyShareAuthor}}if(f==null||(f==null?void 0:f.msgId)==null&&(f==null?void 0:f.sourceId)==null)return;l=f||{};h=l.author;j=l.mediaId;a=l.msgId;i=l.plaintextHash;k=l.sourceId;var n=l.specialTextSize,o=l.ts,p=l.type;l=l.xmaMessageType;o=o!=null?o*1e3:void 0;g=f.type===d("MAWMsgType").MSG_TYPE.TEXT||d("MAWXMAUtils").isXMAExternalLinkShare(l)?(g=f.msgContent)==null?void 0:g.content:void 0;var q=d("WAJids").authorToUserId(h,e),r=f.type===d("MAWMsgType").MSG_TYPE.TEXT?f.msgContent.mentionedJids:void 0;h=h===d("WAJids").AUTHOR_ME||q===e;e=b||{};b=e.replyMediaId;var s=e.replyMediaPreviewHeight,t=e.replyMediaPreviewWidth,u=e.replyMediaUrlFallback,v=e.replyMediaUrlMimeType,w=e.replyPlaintextHash;e=e.replyXMAId;if(d("MAWXMAUtils").isXMAStoryReply(l)){return{isStoryProducerReply:d("MAWXMAUtils").isXMAStoryProducerReply(l),isStoryReaction:d("MAWXMAUtils").isXMAStoryReaction(l),isStoryReply:!0,replyMediaExpirationTimestampMs:f==null?void 0:f.expirationTs,replyMediaId:j,replyMediaUrlMimeType:j!=null?"image/jpeg":void 0,replyPlaintextHash:(f=w!=null?d("WAHashUtils").stringToPlaintextHash(w):i)!=null?f:void 0,replySenderIsMe:h,replySourceId:k,replySourceTimestampMs:o,replyStatusType:j!=null?"Image":void 0,replyToUserId:q}}i=d("MAWImageUtils").boundHeightWidth(s,t,96*.8);f=i.height;k=i.width;return{isIGXMAPostShare:d("MAWXMAUtils").isIGXMAPostShare(l),isIGXMAStoryShare:d("MAWXMAUtils").isIGXMAStoryShare(l),isStoryReply:!1,replyMediaId:b,replyMediaPreviewHeight:p===d("MAWMsgType").MSG_TYPE.STICKER?f:s,replyMediaPreviewWidth:p===d("MAWMsgType").MSG_TYPE.STICKER?k:t,replyMediaUrlFallback:u,replyMediaUrlMimeType:v,replyMentionedJids:r,replyMessageText:g,replyPlaintextHash:w!=null?d("WAHashUtils").stringToPlaintextHash(w):void 0,replySenderIsMe:h,replySourceId:a,replySourceTimestampMs:o,replyStatusType:n===1||n===2||n===3?d("MAWMsgType").MSG_TYPE.STICKER:p,replyToUserId:q,replyXMAId:e}}function a(a){a=a.specialTextSize;switch(a){case 1:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSHotEmojiSize").SMALL);case 2:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSHotEmojiSize").MEDIUM);case 3:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSHotEmojiSize").LARGE);default:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSHotEmojiSize").NONE)}}function b(a,b,e,f,g){var h,k,l=d("WAJids").extractUserId(d("MAWUserJidWrapper").getMyUserJid());h=((h=a.isForwarded)!=null?h:!1)&&a.type!==d("MAWMsgType").MSG_TYPE.STICKER;k=(k=a.forwardingScore)!=null?k:0;var m=d("MAWDbMsg").getCanonicalTsFromMsg(a),n=j(a,e,l),o=d("MAWXMAUtils").isXMAStoryShare(a.xmaMessageType),p=d("MAWXMAUtils").isXMAStoryReaction(a.xmaMessageType),q=d("MAWXMAUtils").isXMAExternalLinkShare(a.xmaMessageType),r=d("MAWXMAUtils").isIGXMAStoryMention(a.xmaMessageType),s=d("MAWXMAUtils").isFBXMAStoryMention(a.xmaMessageType),t=d("MAWXMAUtils").isXMAStoryHighlightShare(a.xmaMessageType),u=d("MAWXMAUtils").isXMAPostPrivateReply(a.xmaMessageType),v=d("MAWXMAUtils").isXMAMsgHighlightsTabFriendUpdatesReply(a.xmaMessageType),w=a.messageExpirationTs!=null&&a.messageExpirationTs<=d("WATimeUtils").unixTime(),x=d("MAWDbMsg").getSortOrderWithFallback(a),y=a.externalId;f=c("justknobx")._("3424")&&d("MAWMediaGalleryM2Utils").isMediaGalleryM2Enabled()&&a.source==="media_restore"?"EncryptedBackupsMedia":f;var z=void 0;if(!c("justknobx")._("2996"))z=(e==null?void 0:e.replyPlaintextHash)!=null?d("WAHashUtils").stringToPlaintextHash(e==null?void 0:e.replyPlaintextHash):void 0;else{z=(e==null?void 0:e.replyPlaintextHash)!=null?d("WAHashUtils").stringToPlaintextHash(e==null?void 0:e.replyPlaintextHash):(e=n==null?void 0:n.replyPlaintextHash)!=null?e:void 0}switch(a.type){case d("MAWMsgType").MSG_TYPE.TEXT:e=d("MAWVault").isVaulted(a.msgContent.content)?a.msgContent.content:d("MAWVault").vault(a.msgContent.content);return babelHelpers["extends"]({},n,{ack:a.ack,applicationErrorCode:a.applicationErrorCode,chatJid:a.threadJid,commands:a.msgContent.commands,content:e,editCount:a.editCount,ephemeralDurationInSec:(e=a.ephemeralSetting)==null?void 0:e.ephemeralExpirationInSec,externalId:y,forwardingScore:k,instanceKey:g,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:w,isForwarded:h,mentionedJids:a.msgContent.mentionedJids,msgId:a.msgId,offlineMsg:b,replyPlaintextHash:z,sender:d("WAJids").authorToUserId(a.author,l),sortOrderMs:x,specialTextSize:a.specialTextSize,transportKey:f,ts:m,type_:a.type});case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return babelHelpers["extends"]({},n,{ack:a.ack,applicationErrorCode:a.applicationErrorCode,chatJid:a.threadJid,ephemeralDurationInSec:(e=a.ephemeralSetting)==null?void 0:e.ephemeralExpirationInSec,externalId:y,forwardingScore:k,groupId:a.groupId,groupIndex:a.groupIndex,groupSize:a.groupSize,instanceKey:g,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:w,isForwarded:h,msgId:a.msgId,offlineMsg:b,replyPlaintextHash:z,sender:d("WAJids").authorToUserId(a.author,l),sortOrderMs:x,transportKey:f,ts:m,type_:a.type});case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:return babelHelpers["extends"]({},n,{ack:a.ack,chatJid:a.threadJid,externalId:y,forwardingScore:k,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:w,isForwarded:h,msgId:a.msgId,offlineMsg:b,replyPlaintextHash:z,sender:d("WAJids").authorToUserId(a.author,l),sortOrderMs:x,transportKey:f,ts:m,type_:a.type,unsupportedType:a.msgContent.subtype});case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:return{ack:a.ack,chatJid:a.threadJid,externalId:y,forwardingScore:k,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:w,isForwarded:h,msgId:a.msgId,offlineMsg:b,sender:d("WAJids").authorToUserId(a.author,l),sortOrderMs:x,transportKey:f,ts:m,type_:a.type};case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:return babelHelpers["extends"]({},n,{ack:a.ack,chatJid:a.threadJid,externalId:y,forwardingScore:k,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:w,isForwarded:h,msgId:a.msgId,offlineMsg:b,replyPlaintextHash:z,sender:d("WAJids").authorToUserId(a.author,l),sortOrderMs:x,transportKey:f,ts:m,type_:a.type});case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:return{ack:a.ack,adminContent:[a.msgContent.authorName],adminType:a.msgContent.adminType,chatJid:a.threadJid,externalId:y,forwardingScore:k,isAdminMessage:!0,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:w,isForwarded:h,msgId:a.msgId,offlineMsg:b,sender:d("WAJids").authorToUserId(a.author,l),sortOrderMs:x,transportKey:f,ts:m,type_:a.type};case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE:return{ack:a.ack,adminContent:(e=a.msgContent)==null?void 0:(e=e.adminMsgContent)==null?void 0:e.map(function(a){return a==="Facebook User"?"0":a}),adminType:(e=a.msgContent)==null?void 0:e.adminType,adminVersion:(e=a.msgContent)==null?void 0:e.version,chatJid:a.threadJid,externalId:y,forwardingScore:k,isAdminMessage:!0,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:w,isForwarded:h,msgId:a.msgId,offlineMsg:b,sender:d("WAJids").authorToUserId(a.author,l),sortOrderMs:x,transportKey:f,ts:m,type_:a.type};case d("MAWMsgType").MSG_TYPE.REVOKED:return{ack:a.ack,chatJid:a.threadJid,externalId:y,forwardingScore:k,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:w,isForwarded:h,msgId:a.msgId,offlineMsg:b,originalTs:a.originalTs,sender:d("WAJids").authorToUserId(a.author,l),sortOrderMs:x,transportKey:f,ts:m,type_:a.type};case d("MAWMsgType").MSG_TYPE.XMA:var A;e=(e=a.msgContent)==null?void 0:e.content;A=e!=null?d("MAWVault").isVaulted(e)?(A=a.msgContent)==null?void 0:A.content:d("MAWVault").vault(e):void 0;q&&A==null&&d("WALogger").WARN(i());e=c("justknobx")._("1191")||p||q?A:void 0;return babelHelpers["extends"]({},n,{ack:a.ack,applicationErrorCode:a.applicationErrorCode,chatJid:a.threadJid,commands:(q=a.msgContent)==null?void 0:q.commands,content:e,ephemeralDurationInSec:(A=a.ephemeralSetting)==null?void 0:A.ephemeralExpirationInSec,externalId:y,forwardingScore:k,instanceKey:g,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isCollapsed:a.isCollapsed,isExpiredMsg:w,isExpiredXmaMsg:a.isExpiredXmaMsg,isFBPostMention:d("MAWXMAUtils").isFBXMAPostMention(a.xmaMessageType),isFBStoryMention:s,isForwarded:h,isIGStoryMention:r,isMsgHighlightsTabFriendUpdatesReply:v,isPostPrivateReply:u,isStoryHighlightShare:t,isStoryReaction:p,isStoryShare:o,mentionedJids:(n=a.msgContent)==null?void 0:n.mentionedJids,msgId:a.msgId,offlineMsg:b,replyPlaintextHash:z,sender:d("WAJids").authorToUserId(a.author,l),sortOrderMs:x,transportKey:f,ts:m,type_:a.type,xmaMessageType:a.xmaMessageType});default:return c("WAAssertUnreachable")(a.type)}}g.getSpecialTextSize=a;g.createBridgeMsg=b}),98);
__d("MAWFTSIsMessageValidForSearch",["MAWMsgType"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a.ephemeralSetting!=null&&a.ephemeralSetting.ephemeralExpirationInSec>0}function a(a){var b=a.msgContent,c=a.sortOrderMs,e=a.type;b=b==null?void 0:b.content;if(b==null||c==null)return null;if(e!==d("MAWMsgType").MSG_TYPE.TEXT&&e!==d("MAWMsgType").MSG_TYPE.XMA)return null;return h(a)?null:{content:b,sortOrderMs:c}}g.verifyMessageValidity=a}),98);
__d("MAWBridgeSearchMsg",["MAWCurrentUser","MAWDbMsg","MAWFTSIsMessageValidForSearch","MAWVault","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){var e;c===void 0&&(c=!0);var f=d("MAWFTSIsMessageValidForSearch").verifyMessageValidity(a);if(f==null)return null;var g=d("MAWCurrentUser").getID(),h=a.author,i=a.externalId,j=a.msgId;e=(e=a.threadJid)!=null?e:b;if(e==null)return null;b=f.content;f=f.sortOrderMs;e={chatJid:e,externalId:i,msg:{msgId:j,sender:d("WAJids").authorToUserId(h,g),ts:d("MAWDbMsg").getCanonicalTsFromMsg(a)},sortOrderMs:f};i=b;return babelHelpers["extends"]({},e,{msg:babelHelpers["extends"]({},e.msg,{content:i!=null?d("MAWVault").isVaulted(i)?c?i:d("MAWVault").unvault(i):c?d("MAWVault").vault(i):i:void 0})})}b="message_content_search";c="non_message_content_search";g.createBridgeSearchMsg=a;g.MESSAGE_CONTENT_SEARCH=b;g.NON_MESSAGE_CONTENT_SEARCH=c}),98);
__d("MAWBridgeTraceEvent",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["ReceivedReceipt","ReceivedSent","FlowEndForFailure","FlowEndForSuccess"]);c=a;f["default"]=c}),66);
__d("MAWBridgeUIEventDataValidation",["FBLogger","I64"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){try{return(h||(h=d("I64"))).of_string(a)}catch(b){c("FBLogger")("messenger_web").catching(b).mustfix("Cannot convert string to i64: %s",a)}}g.stringToI64Opt=a}),98);
__d("MAWConvertExtendedContentTypeToLSXmaContentType",["LSXmaContentType","WAArmadilloXMA.pb"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a==null)return null;switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE:return c("LSXmaContentType").FB_FEED_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY:return c("LSXmaContentType").FB_STORY_REPLY;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE:return c("LSXmaContentType").FB_STORY_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION:return c("LSXmaContentType").FB_STORY_MENTION;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_VIDEO_SHARE:return c("LSXmaContentType").FB_FEED_VIDEO_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE:return c("LSXmaContentType").FB_GAMING_CUSTOM_UPDATE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY:return c("LSXmaContentType").FB_PRODUCER_STORY_REPLY;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_EVENT:return c("LSXmaContentType").FB_EVENT;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_POST_PRIVATE_REPLY:return c("LSXmaContentType").FB_FEED_POST_PRIVATE_REPLY;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_HIGHLIGHTS_TAB_FRIEND_UPDATES_REPLY:return c("LSXmaContentType").MSG_HIGHLIGHTS_TAB_FRIEND_UPDATES_REPLY;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_SHORT:return c("LSXmaContentType").FB_SHORT;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING:return c("LSXmaContentType").MSG_LOCATION_SHARING;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING_V2:return c("LSXmaContentType").MSG_LOCATION_SHARING_V2;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_POST_MENTION:return c("LSXmaContentType").FB_POST_MENTION;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_CONTACT:return c("LSXmaContentType").MSG_CONTACT;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_AI_CONTACT:return c("LSXmaContentType").MSG_AI_CONTACT;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_MEMORIES_SHARE:return c("LSXmaContentType").MSG_MEMORIES_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE:return c("LSXmaContentType").MSG_EXTERNAL_LINK_SHARE;default:return null}}g.convertExtendedContentTypeToLSXmaContentType=a}),98);
__d("MNXMAPreviewImageDecorationType",[],(function(a,b,c,d,e,f){a=Object.freeze({DEFAULT:0,COLLAGE:1,VIDEO:2,MESSENGER_ICON:3,INSTAGRAM_ICON:4,SHOPPING:5,UPCOMING_EVENT:6,LIVE:7,REEL:8,IGTV:9,YOUTUBE_VIDEO:10,YOUTUBE_SHORTS:11,COMMENT:12,BLUR:13,PILL:14,MESSENGER_CHANNEL_IMAGE:15,TROPHY:16,DXMA_LIVE:17,DXMA_LIVE_ENDED:18,LIKE_BUBBLE_REPLY:19,LIKE_BUBBLES:20,REPOST:21});f["default"]=a}),66);
__d("MAWBridgeXMAUtils",["I64","LSIntEnum","MAWBridgeUIEventDataValidation","MAWConvertExtendedContentTypeToLSXmaContentType","MAWDbMsg","MAWXMAUtils","MNLSXMALayoutType","MNXMAPreviewImageDecorationType","MWPBumpEntityKey","MessagingAttachmentType","Promise","Random","ReQL","WAArmadilloXMA.pb","WAJids","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,b,c,d,e,f){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f,g,i){var k=c.ctas,l=c.defaultCTA,o=m(c.targetId,c.targetType),q=(j||(j=d("I64"))).of_int32(d("Random").uint32());if(l!=null){var u=r(l,q,f,e,g,o,c.targetType);yield t(a,u,q,i.defaultCta)}u=p(q,c,f,e,g);c=u.blobCtaAttachment;u=u.blobCtaId;if(c!=null&&u!=null){yield t(a,c,u,i.attachmentCta1);return{attachmentCta1Id:u,defaultCtaId:l==null?void 0:q}}c=[];k!=null&&(c=(yield (h||(h=b("Promise"))).all(k.map(function(b,c){var d=n(q,c);b=s(b,d,f,e,g,o);c=c===0?i.attachmentCta1:c===1?i.attachmentCta2:c===2?i.attachmentCta3:void 0;return t(a,b,d,c)}))));return{attachmentCta1Id:c.length>0?c[0]:void 0,attachmentCta2Id:c.length>1?c[1]:void 0,attachmentCta3Id:c.length>2?c[2]:void 0,defaultCtaId:l==null?void 0:q}});return k.apply(this,arguments)}function l(a){var b="xma_web_url";switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:b="xma_rtc_audio";break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:b="xma_rtc_video";break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:b="xma_rtc_missed_audio";break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:b="xma_rtc_missed_video";break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE:b="igd_web_post_share";break}return b}function m(a,b){return d("MAWXMAUtils").isFBXMAPostMention(b)?void 0:a!=null?d("MAWBridgeUIEventDataValidation").stringToI64Opt(a):void 0}function n(a,b){return(j||(j=d("I64"))).add(a,j.of_int32(b+1))}function o(a){if(!d("MAWXMAUtils").isFBXMAPostMention(a.targetType))return null;if(a.author===d("WAJids").AUTHOR_ME)return null;if(a.xmaDataclass!=null){a=JSON.parse(a.xmaDataclass);a=a==null?void 0:a.content;a=a==null?void 0:a.cta_1;if(a!=null)return{actionUrl:a==null?void 0:a.action_url,ctaType:a==null?void 0:a.cta_type,nativeUrl:a==null?void 0:a.native_url,title:a==null?void 0:a.title}}return null}function p(a,b,c,d,e){b=o(b);if(b==null)return{};a=n(a,0);b=s(b,a,c,d,e,void 0);return{blobCtaAttachment:b,blobCtaId:a}}function q(a,b,c,e,f,g,h){h===void 0&&(h="xma_web_url");var i=a.actionUrl,k=a.nativeUrl;return{actionContentBlob:void 0,actionUrl:i!=null?i:k,attachmentFbid:f,attachmentIndex:(j||(j=d("I64"))).zero,ctaId:b,enableExtensions:!1,extensionHeightType:void 0,messageId:c,nativeUrl:k!=null?k:i,platformToken:void 0,targetId:(f=g)!=null?f:void 0,threadKey:e,title:(b=a.title)!=null?b:"Tap to view status update",type_:(c=h)!=null?c:"xma_web_url",urlWebviewType:void 0}}function r(a,b,c,d,e,f,g){g=l(g);return q(a,b,c,d,e,f,g)}function s(a,b,c,d,e,f){var g;switch(a.ctaType){case"contact_sharing_profile":g="contact_sharing_profile";break;case"contact_sharing_message":g="contact_sharing_message";break}return q(a,b,c,d,e,f,g)}function t(a,b,c,d){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,d){d!=null?yield a.attachment_ctas.upsert([d.ctaId],b):yield a.attachment_ctas.add(b);return c});return u.apply(this,arguments)}function e(a,b,c){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=null,f={attachmentCta1:void 0,attachmentCta2:void 0,attachmentCta3:void 0,defaultCta:void 0};e=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.attachments).getKeyRange(b,c)));e!=null&&(f.defaultCta=(yield w(a,e.defaultCtaId)),f.attachmentCta1=(yield w(a,e.attachmentCta1Id)),f.attachmentCta2=(yield w(a,e.attachmentCta2Id)),f.attachmentCta3=(yield w(a,e.attachmentCta3Id)));return[e,f]});return v.apply(this,arguments)}function w(a,c){return c==null?(h||(h=b("Promise"))).resolve(void 0):(a=d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.attachment_ctas).getKeyRange(c)))!=null?a:void 0}function f(a,b,e,f,g,h,k,l,m){var n,p=(j||(j=d("I64"))).of_int32(d("MAWDbMsg").getInChatMsgIdFromMsgId(f)),q=x(a),r=d("MAWConvertExtendedContentTypeToLSXmaContentType").convertExtendedContentTypeToLSXmaContentType(a.targetType);r=r?(j||(j=d("I64"))).of_int32(r):void 0;n=(n=a==null?void 0:(n=a.defaultCTA)==null?void 0:n.actionUrl)!=null?n:a==null?void 0:(n=a.defaultCTA)==null?void 0:n.nativeUrl;a.defaultPreviewMediaId!=null&&d("MWPBumpEntityKey").bumpEntityKeyWithAppId("maw.new_xma_handler","xma_preview_media_has_plaintext_hash."+m+"."+a.targetType+"."+(a.defaultPreviewMediaPlaintextHash!=null?"true":"false"));m=o(a);var s=m!=null?m.title:z(a.ctas,1);m=m!=null?"xma_web_url":y(a.ctas,1);var t=c("gkx")("11351");return{accessibilitySummaryText:void 0,actionUrl:(n=n)!=null?n:void 0,attachmentCta1Id:g,attachmentCta2Id:h,attachmentCta3Id:k,attachmentFbid:e,attachmentIndex:j.zero,attachmentLoggingType:void 0,attachmentType:(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").XMA),attributionAppIcon:void 0,attributionAppIconFallback:void 0,attributionAppIconUrlExpirationTimestampMs:void 0,attributionAppId:void 0,attributionAppName:void 0,authorityLevel:j.zero,avatarCount:void 0,avatarViewAccessibilityLabel:void 0,avatarViewSize:void 0,avatarViewTitleList:void 0,avatarViewUrlExpirationTimestampList:void 0,avatarViewUrlFallbackList:void 0,avatarViewUrlList:void 0,captionBodyText:void 0,cta1Title:s,cta1Type:m,cta2Title:z(a.ctas,2),cta2Type:y(a.ctas,2),cta3Title:z(a.ctas,3),cta3Type:y(a.ctas,3),dashManifest:void 0,decryptionKey:void 0,defaultCtaId:l,defaultCtaTitle:(n=a.defaultCTA)==null?void 0:n.title,defaultCtaType:q.xmaContentType,descriptionText:void 0,ephemeralMediaState:void 0,faviconUrl:void 0,faviconUrlExpirationTimestampMs:void 0,faviconUrlFallback:void 0,filename:void 0,filesize:a.filesize!=null?(j||(j=d("I64"))).of_int32(a.filesize):void 0,gatingTitle:a.overlayTitle,gatingType:a.overlayIconGlyph!=null?String(a.overlayIconGlyph):void 0,hasMedia:a.hasMedia!=null?a.hasMedia:!1,hasXma:!0,hasXmaFavicon:t?a.faviconPlaintextHash!=null:a.faviconMediaId!=null,hasXmaHeaderImage:t?a.headerMediaPlaintextHash!=null:a.headerMediaId!=null,hasXmaPreview:t?a.defaultPreviewMediaPlaintextHash!=null:a.defaultPreviewMediaId!=null,headerImageUrl:void 0,headerImageUrlExpirationTimestampMs:void 0,headerImageUrlFallback:void 0,headerImageUrlMimeType:void 0,headerTitle:a.headerTitle,imageUrl:void 0,imageUrlExpirationTimestampMs:void 0,imageUrlFallback:void 0,imageUrlMimeType:void 0,isBorderless:void 0,isPreviewImage:void 0,isSharable:!0,listItemAccessibilityText1:void 0,listItemAccessibilityText2:void 0,listItemAccessibilityText3:void 0,listItemContactUrlExpirationTimestampList1:void 0,listItemContactUrlExpirationTimestampList2:void 0,listItemContactUrlExpirationTimestampList3:void 0,listItemContactUrlFallbackList1:void 0,listItemContactUrlFallbackList2:void 0,listItemContactUrlFallbackList3:void 0,listItemContactUrlList1:void 0,listItemContactUrlList2:void 0,listItemContactUrlList3:void 0,listItemId1:void 0,listItemId2:void 0,listItemId3:void 0,listItemProfilePictureUrl1:void 0,listItemProfilePictureUrl2:void 0,listItemProfilePictureUrl3:void 0,listItemProfilePictureUrlExpirationTimestamp1:void 0,listItemProfilePictureUrlExpirationTimestamp2:void 0,listItemProfilePictureUrlExpirationTimestamp3:void 0,listItemProfilePictureUrlFallback1:void 0,listItemProfilePictureUrlFallback2:void 0,listItemProfilePictureUrlFallback3:void 0,listItemProgressBarFilledPercentage1:void 0,listItemProgressBarFilledPercentage2:void 0,listItemProgressBarFilledPercentage3:void 0,listItemsDescriptionSubtitleText:void 0,listItemsDescriptionText:void 0,listItemsId:void 0,listItemsSecondaryDescriptionText:void 0,listItemTitleText1:void 0,listItemTitleText2:void 0,listItemTitleText3:void 0,localPlayableUrl:void 0,maxSubtitleNumOfLines:a.maxSubtitleNumOfLines!=null?(j||(j=d("I64"))).of_int32(a.maxSubtitleNumOfLines):void 0,maxTitleNumOfLines:a.maxTitleNumOfLines!=null?(j||(j=d("I64"))).of_int32(a.maxTitleNumOfLines):void 0,messageId:f,miniPreview:void 0,offlineAttachmentId:(g=a.offlineAttachmentId)!=null?g:e,originalFileHash:void 0,originalPageSenderId:void 0,playableDurationMs:void 0,playableUrl:void 0,playableUrlExpirationTimestampMs:void 0,playableUrlFallback:void 0,playableUrlMimeType:void 0,preheaderText:void 0,previewHeight:q.height,previewHeightLarge:a.previewHeightLarge!=null?(j||(j=d("I64"))).of_int32(a.previewHeightLarge):void 0,previewImageDecorationType:B(a.targetType),previewUrl:void 0,previewUrlExpirationTimestampMs:void 0,previewUrlFallback:void 0,previewUrlLarge:void 0,previewUrlMimeType:void 0,previewWidth:q.width,previewWidthLarge:a.previewWidthLarge!=null?(j||(j=d("I64"))).of_int32(a.previewWidthLarge):void 0,samplingFrequencyHz:void 0,shouldAutoplayVideo:void 0,shouldHighlightHeaderTitleInTitle:void 0,shouldRespectServerPreviewSize:void 0,sourceText:void 0,subtitleIconUrl:void 0,subtitleText:a.subtitleText,targetId:void 0,threadKey:b,timestampMs:p,titleText:a.titleText,transportKey:"WhatsApp",viewerSeenTimestampMs:void 0,waveformData:void 0,xmaContentType:r,xmaDataclass:a.xmaDataclass,xmaFaviconFbid:t?a.faviconPlaintextHash:c("gkx")("8162")?(h=a.faviconPlaintextHash)!=null?h:(k=a.faviconMediaId)==null?void 0:k.toString():(s=a.faviconMediaId)==null?void 0:s.toString(),xmaHeaderImageFbid:t?a.headerMediaPlaintextHash:c("gkx")("8162")?(m=a.headerMediaPlaintextHash)!=null?m:(l=a.headerMediaId)==null?void 0:l.toString():(n=a.headerMediaId)==null?void 0:n.toString(),xmaLayoutType:a.xmaLayoutType!=null?A(a.xmaLayoutType):void 0,xmaPreviewFbid:t?a.defaultPreviewMediaPlaintextHash:c("gkx")("8162")?(f=a.defaultPreviewMediaPlaintextHash)!=null?f:(g=a.defaultPreviewMediaId)==null?void 0:g.toString():(e=a.defaultPreviewMediaId)==null?void 0:e.toString(),xmasTemplateType:a.xmaLayoutType!=null?A(a.xmaLayoutType):void 0}}function x(a){var b;switch(a.targetType){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE:b={height:(j||(j=d("I64"))).of_int32(108),width:(j||(j=d("I64"))).of_int32(72),xmaContentType:"xma_montage_share"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:b={xmaContentType:"xma_rtc_audio"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:b={xmaContentType:"xma_rtc_video"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:b={xmaContentType:"xma_rtc_missed_audio"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:b={xmaContentType:"xma_rtc_missed_video"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:b={xmaContentType:"xma_rtc_missed_group_audio"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:b={xmaContentType:"xma_rtc_missed_group_video"};break;default:b={height:a.previewHeight!=null?(j||(j=d("I64"))).of_int32(a.previewHeight):void 0,width:a.previewWidth!=null?(j||(j=d("I64"))).of_int32(a.previewWidth):void 0,xmaContentType:"xma_web_url"};break}return b}function y(a,b){if(a==null)return;a=a[b-1];if(a==null)return;b=a.buttonType;a=a.ctaType;switch(a){case"contact_sharing_profile":return"contact_sharing_profile";case"contact_sharing_message":return"contact_sharing_message";default:return b===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_VIDEO_POST_SHARE?"xma_open_native":void 0}}function z(a,b){if(a==null)return;a=a[b-1];if(a!=null)return a.title}function A(a){return a===0||a!==3?(i||(i=d("LSIntEnum"))).ofNumber(c("MNLSXMALayoutType").SINGLE):(i||(i=d("LSIntEnum"))).ofNumber(c("MNLSXMALayoutType").PORTRAIT)}function B(a){switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE:return(i||(i=d("LSIntEnum"))).ofNumber(c("MNXMAPreviewImageDecorationType").COLLAGE);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE:return(i||(i=d("LSIntEnum"))).ofNumber(c("MNXMAPreviewImageDecorationType").REEL);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_MENTION:return(i||(i=d("LSIntEnum"))).ofNumber(c("MNXMAPreviewImageDecorationType").INSTAGRAM_ICON);default:return(i||(i=d("LSIntEnum"))).ofNumber(c("MNXMAPreviewImageDecorationType").DEFAULT)}}g.addAttachmentCtas=a;g.maybeBridgeToLSTargetId=m;g.getCtaIdFromDefaultCtaId=n;g.createBlobCtaAttachment=p;g.composeDefaultAttachmentCta=r;g.composeAttachmentCta=s;g.getExistingAttachmentAndAttachmentCtas=e;g.composeAttachmentXMA=f}),98);
__d("MAWDbEditMsgHistory",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return a}function b(a){return(h||(h=d("I64"))).of_float(a)}function c(a){return(h||(h=d("I64"))).to_float(a)}g.unsafeCoerceToEditMsgHistoryId=a;g.convertToEditMsgHistoryId64=b;g.convertToEditMsgHistoryId=c}),98);
__d("MAWDbPoll",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a){return a}function c(a,b){a=(a+b).split("");return Math.abs(a.reduce(function(a,b){b=b.charCodeAt(0);a=(a<<5)-a+b;a&=a;return a},0))}f.convertStringToOptionHash=a;f.convertOptionHashToString=b;f.generateStableIdFromOptionHash=c}),66);
__d("MAWDbXMA",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return a}function b(a){return a}function c(a){return(h||(h=d("I64"))).to_float(a)}g.convertNumbersToXMAIds=a;g.convertNumberToXMAId=b;g.convertXMAId64ToXMAId=c}),98);
__d("MAWEphemeralConsts",["WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=300;b=600;c=900;e=1800;d=Math.imul((f=d("WATimeUtils")).HOUR_SECONDS,6);var h=Math.imul(f.HOUR_SECONDS,12),i=Math.imul(f.DAY_SECONDS,14),j=1e3,k=5,l=10,m=30,n=60,o=d;g.fiveMinutesInSeconds=a;g.tenMinutesInSeconds=b;g.fifteenMinutesInSeconds=c;g.thirtyMinutesInSeconds=e;g.oneHourInSeconds=f.HOUR_SECONDS;g.sixHoursInSeconds=d;g.twelveHoursInSeconds=h;g.oneDayInSeconds=f.DAY_SECONDS;g.ephemeralMaxDelectionWindowForUnseenMessage=i;g.msPerSec=j;g.fiveSeconds=k;g.tenSeconds=l;g.thirtySeconds=m;g.oneMinuteInSeconds=n;g.ephemeralReportingWindowInSeconds=o}),98);
__d("MAWExtractMsFromExternalId",["I64","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to convert externalId to number: ",""]);i=function(){return a};return a}function j(a){return new Date(a).getTime()>0}var k=2199023255551;function a(a){try{a=(h||(h=d("I64"))).of_string_opt(a);if(a!=null){return(a=l(a))!=null?a:0}}catch(a){d("WALogger").ERROR(i(),a)}return 0}function l(a){a=Number((h||(h=d("I64"))).to_string(h.and_(h.lsr_(a,22),h.of_float(k))));if(j(a)){a=Math.floor(Number(a)%1e5/100);return a}}g.extractMsFromStanzaId=a;g.extractMsFromExternalId=l}),98);
__d("MAWJidUtils",["FBLogger","I64","LSIntEnum","MAWJids","WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b,e){if(d("WAJids").isAuthorSystem(a)||b==null||e==null){c("FBLogger")("messenger_e2ee_web").warn("Failed to create protocolMsgId with externalId %s for a msg to edit",e);return}return{author:a,chat:b,externalId:e}}function a(a){var b;return j(a.author,a.threadJid,(b=a.externalId)!=null?b:a.editExternalId)}function b(a){return d("WAJids").isAuthorMe(a)?d("WAGlobals").getMyUserJid():a}function e(a,b){a=(h||(h=d("I64"))).to_string(a);b=(i||(i=d("LSIntEnum"))).unwrapIntEnum(b);switch(b){case 15:return d("MAWJids").jidUtils.toUserJid(a);case 16:return d("WAJids").toGroupJid(a);default:return null}}function f(a){return a.threadJid+"."+a.externalId}g.maybeToProtocolMsgId=j;g.toProtocolMsgId=a;g.getAuthorJid=b;g.LSJidtoChatJid=e;g.toProtocolMsgIdStringForMAWStorage=f}),98);
__d("MAWMessagesDirection",["I64","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return c("err")("Unhandled direction: "+a)}function a(a,b){return k(a,{asc:b.maxTimestampMs,desc:b.minTimestampMs})}function b(a,b){return k(a,{asc:b.maxMessageId,desc:b.minMessageId})}function e(a,b){return b==="desc"&&(h||(h=d("I64"))).equal(a.maxTimestampMs,(h||(h=d("I64"))).max_int)&&a.minMessageId===a.maxMessageId&&a.hasMoreBefore&&!a.hasMoreAfter}function f(a){return k(a,{asc:"after",desc:"before"})}function j(a){return l(a,{after:"asc",before:"desc"})}function k(a,b){var c=b.asc;b=b.desc;switch(a){case"asc":return c;case"desc":return b;default:a;throw i(a)}}function l(a,b){var c=b.after;b=b.before;switch(a){case"after":return c;case"before":return b;default:a;throw i(a)}}g.unhandledDirectionError=i;g.getI64RangeTimestampForDirection=a;g.getRangeMsgIdForDirection=b;g.isFirstPageRange=e;g.translateMwpDirectionToMawDirection=f;g.translateMawDirectionToMwpDirection=j;g.switchOnMWPMessagesDirection=k;g.switchOnMAWMessagesDirection=l}),98);
__d("MAWMessagesCompare",["MAWMessagesDirection"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return function(b,c){if(c.sortOrderMs==null||b.sortOrderMs==null)return 0;if(b.sortOrderMs===c.sortOrderMs){var d,e;d=(d=b.externalId)!=null?d:"";e=(e=c.externalId)!=null?e:"";if(a!=null){d=a.has(d);e=a.has(e);if(d&&!e)return-1;else if(!d&&e)return 1}return((d=c.externalId)!=null?d:"").localeCompare((e=b.externalId)!=null?e:"")}return c.sortOrderMs-b.sortOrderMs}}var i=h(),j=function(a,b){return-1*h()(a,b)};function a(a){return d("MAWMessagesDirection").switchOnMWPMessagesDirection(a,{asc:j,desc:i})}g.makeCompareMessageMetadataForDescOrderFn=h;g.getSortComparisonFunctionForDirection=a}),98);
__d("MAWMsg",["$InternalEnum","I64","LSBitFlag","LSIntEnum","LSMessagingThreadTypeUtil","LSReplyMessageAttachmentType","MAWMsgType","WAArmadilloXMA.pb"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,b,c,e,f,g){if(a===d("MAWMsgType").MSG_TYPE.TEXT)if(b)return(i||(i=d("LSIntEnum"))).ofNumber(8192);else return(i||(i=d("LSIntEnum"))).ofNumber(1);else if(a===d("MAWMsgType").MSG_TYPE.IMAGE||a===d("MAWMsgType").MSG_TYPE.VIDEO||a===d("MAWMsgType").MSG_TYPE.RAVEN)return(i||(i=d("LSIntEnum"))).ofNumber(2);else if(a===d("MAWMsgType").MSG_TYPE.PTT)return(i||(i=d("LSIntEnum"))).ofNumber(4);else if(a===d("MAWMsgType").MSG_TYPE.FUTUREPROOF)return k(f);else if(a===d("MAWMsgType").MSG_TYPE.CIPHERTEXT)return(i||(i=d("LSIntEnum"))).ofNumber(65536);else if(a===d("MAWMsgType").MSG_TYPE.UNAVAILABLE)return(i||(i=d("LSIntEnum"))).ofNumber(262144);else if(a===d("MAWMsgType").MSG_TYPE.GIF)return(i||(i=d("LSIntEnum"))).ofNumber(16384);else if(a===d("MAWMsgType").MSG_TYPE.STICKER)return(i||(i=d("LSIntEnum"))).ofNumber(4096);else if(a===d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE)return(i||(i=d("LSIntEnum"))).ofNumber(64);else if(a===d("MAWMsgType").MSG_TYPE.XMA)if(c!=null&&c)return(i||(i=d("LSIntEnum"))).ofNumber(256);else return g===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_RECEIVER_FETCH?(i||(i=d("LSIntEnum"))).ofNumber(536870912):(i||(i=d("LSIntEnum"))).ofNumber(1024);else if(a===d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE)if(!e)return(i||(i=d("LSIntEnum"))).ofNumber(33554432);else return(i||(i=d("LSIntEnum"))).ofNumber(1);else if(a===d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH)return(i||(i=d("LSIntEnum"))).ofNumber(134217728);else return(i||(i=d("LSIntEnum"))).ofNumber(1)}function k(a){switch(a){case"liveLocationMessage":return(i||(i=d("LSIntEnum"))).ofNumber(4294967296);case"locationMessage":return(i||(i=d("LSIntEnum"))).ofNumber(524288);case"pollCreationMessage":return(i||(i=d("LSIntEnum"))).ofNumber(1048576);case"contactShareMessage":return(i||(i=d("LSIntEnum"))).ofNumber(2097152);case"storyMentionMessage":return(i||(i=d("LSIntEnum"))).ofNumber(4194304);case"postMentionMessage":return(i||(i=d("LSIntEnum"))).ofNumber(2147483648);case"metaAiMessage":return(i||(i=d("LSIntEnum"))).ofNumber(8388608);case"bumpMessage":return(i||(i=d("LSIntEnum"))).ofNumber(16777216);case"stickerReceiverFetchMessage":return(i||(i=d("LSIntEnum"))).ofNumber(67108864);case"noteMention":return(i||(i=d("LSIntEnum"))).ofNumber(1073741824);case"messengerMemory":return(i||(i=d("LSIntEnum"))).ofNumber(8589934592);default:return(i||(i=d("LSIntEnum"))).ofNumber(131072)}}function e(a){a=a.displayedContentTypes;return(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(2))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(4))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(16384))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(16))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(64))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(4096))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(134217728))}function f(a,b){var e=a.replyAttachmentType;if(e==null)return!1;b=d("LSMessagingThreadTypeUtil").isArmadilloSecure(b);return b&&a.replyAttachmentId==null?!1:(j||(j=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSReplyMessageAttachmentType").PHOTO))||(j||(j=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSReplyMessageAttachmentType").GIF))||(j||(j=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSReplyMessageAttachmentType").AUDIO))||(j||(j=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSReplyMessageAttachmentType").STICKER))||(j||(j=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSReplyMessageAttachmentType").VIDEO))}function l(a){return(j||(j=d("I64"))).equal(a.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(134217728))}function m(a){return d("LSBitFlag").has((i||(i=d("LSIntEnum"))).ofNumber(536870912),a.displayedContentTypes)}function n(a){a=a.displayedContentTypes;if((j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(32)))return!0;else return!1}function o(a){return(j||(j=d("I64"))).lt(a.sendStatusV2,(i||(i=d("LSIntEnum"))).ofNumber(2))}function p(a){a=a.displayedContentTypes;return d("LSBitFlag").has((i||(i=d("LSIntEnum"))).ofNumber(1024),a)||d("LSBitFlag").has((i||(i=d("LSIntEnum"))).ofNumber(536870912),a)}function q(a){a=a.displayedContentTypes;return(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(65536))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(131072))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(524288))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(4294967296))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(1048576))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(2097152))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(4194304))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(2147483648))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(8388608))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(16777216))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(1073741824))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(8589934592))?!0:(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(262144))}var r=(b=b("$InternalEnum"))({PLAYED:0,SCREENSHOTTED:1,FORCE_DISABLED:2}),s=b({PERMANENT:0,UNSEEN:1,SEEN:2,REPLAYED:3,EXPIRED:4}),t=b({VIEW_ONCE:0,ALLOW_REPLAY:1,KEEP_IN_CHAT:2});b=b({IMAGE:0,VIDEO:1});g.text=(h=d("MAWMsgType")).MSG_TYPE.TEXT;g.image=h.MSG_TYPE.IMAGE;g.video=h.MSG_TYPE.VIDEO;g.ptt=h.MSG_TYPE.PTT;g.unsent=h.MSG_TYPE.REVOKED;g.gif=h.MSG_TYPE.GIF;g.bumpExistingMessage=h.MSG_TYPE.BUMP_EXISTING_MESSAGE;g.getDisplayedContentTypes=a;g.isMediaMsg=e;g.isMediaReplyAttachmentType=f;g.isReceiverFetchMsg=l;g.isReceiverFetchXMAMsg=m;g.isAdminMsg=n;g.isOptimistic=o;g.isXMAMsg=p;g.isPlaceholder=q;g.MAWRavenActionNotifType=r;g.MAWRavenMsgEphemeralMediaState=s;g.MAWRavenMsgEphemeralType=t;g.MAWRavenMsgMediaType=b}),98);
__d("MAWOneTimeCodeGating",["gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("1910")&&c("justknobx")._("1601")}g.isOneTimeCodeEnabled=a}),98);
__d("MAWUpdateClientRestoreStatusOperationType",[],(function(a,b,c,d,e,f){"use strict";a=0;b=1;f.upsertClientRestoreStatus=a;f.markCompleteClientRestoreStatus=b}),66);
__d("MAWXMALoggingUtils",["WAArmadilloXMA.pb","objectEntries"],(function(a,b,c,d,e,f,g){"use strict";var h=c("objectEntries")(d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE).reduce(function(a,b){var c=b[0];b=b[1];a.set(b,c);return a},new Map());function a(a){return a!=null?h.get(a):void 0}g.getXmaTargetTypeStringFromEnum=a}),98);
__d("MWChatEncryptedBackupsLogging",["MWEBODSCategory","MWEBODSEntityKey.enum","ODS","QPLUserFlow"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){var b=a.cancelEndPoint,d=a.event,e=a.instanceKey;a=a.source;a!=null&&c("QPLUserFlow").addAnnotations(d,{string:{source:a}},{instanceKey:e});c("QPLUserFlow").addPoint(d,"cancel",{instanceKey:e});c("QPLUserFlow").addAnnotations(d,{string:{cancel_end_point:b}},{instanceKey:e});c("QPLUserFlow").endCancel(d,{instanceKey:e})}function a(a){var b=a.event,d=a.instanceKey,e=a.onClose;a=a.source;a!=null&&c("QPLUserFlow").addAnnotations(b,{string:{source:a}},{instanceKey:d});i({cancelEndPoint:"dialog_x_button",event:b,instanceKey:d});e()}function b(a){var b=a.annotations,e=a.event,f=a.instanceKey;a=a.odsEntityName;c("QPLUserFlow").addPoint(e,"success",{instanceKey:f});c("QPLUserFlow").endSuccess(e,{annotations:b,instanceKey:f});a&&(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),a,c("MWEBODSEntityKey.enum").SUCCESS)}function e(a){var b=a.annotations,e=a.errorName,f=a.event,g=a.instanceKey,i=a.odsEntityKey;a=a.odsEntityName;c("QPLUserFlow").addPoint(f,"failure",{instanceKey:g});c("QPLUserFlow").endFailure(f,e,{annotations:b,instanceKey:g});a&&(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),a,(f=i)!=null?f:c("MWEBODSEntityKey.enum").FAIL)}g.cancelFlow=i;g.closeDialogCancelFlow=a;g.endSuccess=b;g.endFailure=e}),98);
__d("MWChatEncryptedBackupsQPLEvents",["qpl"],(function(a,b,c,d,e,f,g){"use strict";b=(a=c("qpl"))._(521476140,"378");d=a._(521472542,"295");e=a._(521482085,"409");f=a._(521485406,"272");c=a._(521482763,"296");var h=a._(521484295,"1460"),i=a._(521482969,"1519"),j=a._(521479124,"1939"),k=a._(521474385,"263"),l=a._(521476098,"504"),m=a._(521482858,"1290"),n=a._(521473194,"1331");a=a._(521471024,"2275");g.pinCodeChangeQplEvent=b;g.optOutQplEvent=d;g.backupSetupQplEvent=e;g.mobileOnboardingQplEvent=f;g.restoreQplEvent=c;g.restoreDeviceAuthQplEvent=h;g.messageRestoreQplEvent=i;g.restoreWithAutoRestoreConsentQplEvent=j;g.hsmFleetMigrationQplEvent=k;g.virtualDeviceRevocationQplEvent=l;g.onboardingAuthQplEvent=m;g.processBackupIdsQPLEvent=n;g.fetchBackupIdsQPLEvent=a}),98);
__d("MediaDownloadMediator",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";var g=new Map();function a(a,b){g.set(a,b)}function c(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c;yield (c=g.get(a))==null?void 0:c["continue"](b);g["delete"](a)});return h.apply(this,arguments)}function d(a,b){var c;void ((c=g.get(a))==null?void 0:c.handleError(b));g["delete"](a)}f.mapDeliveryObjectIdToMediaDownloader=a;f.handleNewCDNUrlFromMI=c;f.handleMIDownloadFailure=d}),66);
__d("WAArmadilloApplication.pb",["WAArmadilloXMA.pb","WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h,i;a={ES_OPEN:1,ES_CLOSE:2};b={PAYMENT_UNKNOWN:-1,REQUEST_INITED:4,REQUEST_DECLINED:5,REQUEST_TRANSFER_INITED:6,REQUEST_TRANSFER_COMPLETED:7,REQUEST_TRANSFER_FAILED:8,REQUEST_CANCELED:9,REQUEST_EXPIRED:10,TRANSFER_INITED:11,TRANSFER_PENDING:12,TRANSFER_PENDING_RECIPIENT_VERIFICATION:13,TRANSFER_CANCELED:14,TRANSFER_COMPLETED:15,TRANSFER_NO_RECEIVER_CREDENTIAL_NO_RTS_PENDING_CANCELED:16,TRANSFER_NO_RECEIVER_CREDENTIAL_NO_RTS_PENDING_OTHER:17,TRANSFER_REFUNDED:18,TRANSFER_PARTIAL_REFUND:19,TRANSFER_CHARGED_BACK:20,TRANSFER_EXPIRED:21,TRANSFER_DECLINED:22,TRANSFER_UNAVAILABLE:23};c={SCREENSHOT_IMAGE:1,SCREEN_RECORDING:2};e={PLAYED:0,SCREENSHOT:1,FORCE_DISABLE:2};f={VIEW_ONCE:0,ALLOW_REPLAY:1,KEEP_IN_CHAT:2};var j={SMALL_LIKE:1,MEDIUM_LIKE:2,LARGE_LIKE:3},k={},l={},m={},n={},o={},p={},q={},r={},s={},t={},u={},v={},w={},x={},y={},z={},A={},B={},C={},D={},E={},F={},G={},H={},I={},J={},K={},L={},M={},N={},O={};k.internalSpec={payload:[1,(h=d("WAProtoConst")).TYPES.MESSAGE,m],metadata:[2,h.TYPES.MESSAGE,l]};l.internalSpec={};m.internalSpec={content:[1,h.TYPES.MESSAGE,E],applicationData:[2,h.TYPES.MESSAGE,r],signal:[3,h.TYPES.MESSAGE,o],subProtocol:[4,h.TYPES.MESSAGE,n],__oneofs__:{payload:["content","applicationData","signal","subProtocol"]}};n.internalSpec={futureProof:[1,h.TYPES.ENUM,(i=d("WACommon.pb")).FUTURE_PROOF_BEHAVIOR]};o.internalSpec={encryptedBackupsSecrets:[1,h.TYPES.MESSAGE,p],__oneofs__:{signal:["encryptedBackupsSecrets"]}};p.internalSpec={backupId:[1,h.TYPES.UINT64],serverDataId:[2,h.TYPES.UINT64],epoch:[3,h.FLAGS.REPEATED|h.TYPES.MESSAGE,q],tempOcmfClientState:[4,h.TYPES.BYTES],mailboxRootKey:[5,h.TYPES.BYTES],obliviousValidationToken:[6,h.TYPES.BYTES]};q.internalSpec={id:[1,h.TYPES.UINT64],anonId:[2,h.TYPES.BYTES],rootKey:[3,h.TYPES.BYTES],status:[4,h.TYPES.ENUM,a]};r.internalSpec={metadataSync:[1,h.TYPES.MESSAGE,D],aiBotResponse:[2,h.TYPES.MESSAGE,t],messageHistoryDocumentMessage:[3,h.TYPES.MESSAGE,s],__oneofs__:{applicationData:["metadataSync","aiBotResponse","messageHistoryDocumentMessage"]}};s.internalSpec={document:[1,h.TYPES.MESSAGE,i.SubProtocolSpec]};t.internalSpec={summonToken:[1,h.TYPES.STRING],messageText:[2,h.TYPES.STRING],serializedExtras:[3,h.TYPES.STRING]};u.internalSpec={actionTimestamp:[1,h.TYPES.INT64],chatAction:[101,h.TYPES.MESSAGE,x],messageAction:[102,h.TYPES.MESSAGE,v],__oneofs__:{actionType:["chatAction","messageAction"]}};v.internalSpec={key:[1,h.TYPES.MESSAGE,i.MessageKeySpec],messageDelete:[101,h.TYPES.MESSAGE,w],__oneofs__:{action:["messageDelete"]}};w.internalSpec={};x.internalSpec={chatId:[1,h.TYPES.STRING],chatArchive:[101,h.TYPES.MESSAGE,A],chatDelete:[102,h.TYPES.MESSAGE,z],chatRead:[103,h.TYPES.MESSAGE,y],__oneofs__:{action:["chatArchive","chatDelete","chatRead"]}};y.internalSpec={messageRange:[1,h.TYPES.MESSAGE,C],read:[2,h.TYPES.BOOL]};z.internalSpec={messageRange:[1,h.TYPES.MESSAGE,C]};A.internalSpec={messageRange:[1,h.TYPES.MESSAGE,C],archived:[2,h.TYPES.BOOL]};B.internalSpec={key:[1,h.TYPES.MESSAGE,i.MessageKeySpec],timestamp:[2,h.TYPES.INT64]};C.internalSpec={lastMessageTimestamp:[1,h.TYPES.INT64],lastSystemMessageTimestamp:[2,h.TYPES.INT64],messages:[3,h.FLAGS.REPEATED|h.TYPES.MESSAGE,B]};D.internalSpec={actions:[2,h.FLAGS.REPEATED|h.TYPES.MESSAGE,u]};E.internalSpec={commonSticker:[1,h.TYPES.MESSAGE,O],screenshotAction:[3,h.TYPES.MESSAGE,K],extendedContentMessage:[4,h.TYPES.MESSAGE,d("WAArmadilloXMA.pb").ExtendedContentMessageSpec],ravenMessage:[5,h.TYPES.MESSAGE,N],ravenActionNotifMessage:[6,h.TYPES.MESSAGE,M],extendedMessageContentWithSear:[7,h.TYPES.MESSAGE,L],imageGalleryMessage:[8,h.TYPES.MESSAGE,J],paymentsTransactionMessage:[10,h.TYPES.MESSAGE,F],bumpExistingMessage:[11,h.TYPES.MESSAGE,I],noteReplyMessage:[13,h.TYPES.MESSAGE,H],ravenMessageMsgr:[14,h.TYPES.MESSAGE,N],networkVerificationMessage:[15,h.TYPES.MESSAGE,G],__oneofs__:{content:["commonSticker","screenshotAction","extendedContentMessage","ravenMessage","ravenActionNotifMessage","extendedMessageContentWithSear","imageGalleryMessage","paymentsTransactionMessage","bumpExistingMessage","noteReplyMessage","ravenMessageMsgr","networkVerificationMessage"]}};F.internalSpec={transactionId:[1,h.TYPES.UINT64],amount:[2,h.TYPES.STRING],currency:[3,h.TYPES.STRING],paymentStatus:[4,h.TYPES.ENUM,b],extendedContentMessage:[5,h.TYPES.MESSAGE,d("WAArmadilloXMA.pb").ExtendedContentMessageSpec]};G.internalSpec={codeText:[1,h.TYPES.STRING]};H.internalSpec={noteId:[1,h.TYPES.STRING],noteText:[2,h.TYPES.MESSAGE,i.MessageTextSpec],noteTimestampMs:[3,h.TYPES.INT64],textContent:[4,h.TYPES.MESSAGE,i.MessageTextSpec],stickerContent:[5,h.TYPES.MESSAGE,i.SubProtocolSpec],videoContent:[6,h.TYPES.MESSAGE,i.SubProtocolSpec],__oneofs__:{noteReplyContent:["textContent","stickerContent","videoContent"]}};I.internalSpec={key:[1,h.TYPES.MESSAGE,i.MessageKeySpec]};J.internalSpec={images:[1,h.FLAGS.REPEATED|h.TYPES.MESSAGE,i.SubProtocolSpec]};K.internalSpec={screenshotType:[1,h.TYPES.ENUM,c]};L.internalSpec={searId:[1,h.TYPES.STRING],payload:[2,h.TYPES.BYTES],nativeUrl:[3,h.TYPES.STRING],searAssociatedMessage:[4,h.TYPES.MESSAGE,i.SubProtocolSpec],searSentWithMessageId:[5,h.TYPES.STRING]};M.internalSpec={key:[1,h.TYPES.MESSAGE,i.MessageKeySpec],actionTimestamp:[2,h.TYPES.INT64],actionType:[3,h.TYPES.ENUM,e]};N.internalSpec={ephemeralType:[1,h.TYPES.ENUM,f],imageMessage:[2,h.TYPES.MESSAGE,i.SubProtocolSpec],videoMessage:[3,h.TYPES.MESSAGE,i.SubProtocolSpec],__oneofs__:{mediaContent:["imageMessage","videoMessage"]}};O.internalSpec={stickerType:[1,h.TYPES.ENUM,j]};g.ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS=a;g.ARMADILLO_CONTENT_PAYMENTS_TRANSACTION_MESSAGE_PAYMENT_STATUS=b;g.ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE=c;g.ARMADILLO_CONTENT_RAVEN_ACTION_NOTIF_MESSAGE_ACTION_TYPE=e;g.ARMADILLO_CONTENT_RAVEN_MESSAGE_EPHEMERAL_TYPE=f;g.ARMADILLO_CONTENT_COMMON_STICKER_STICKER_TYPE=j;g.ArmadilloSpec=k;g.Armadillo$MetadataSpec=l;g.Armadillo$PayloadSpec=m;g.Armadillo$SubProtocolPayloadSpec=n;g.Armadillo$SignalSpec=o;g.Armadillo$Signal$EncryptedBackupsSecretsSpec=p;g.Armadillo$Signal$EncryptedBackupsSecrets$EpochSpec=q;g.Armadillo$ApplicationDataSpec=r;g.Armadillo$ApplicationData$MessageHistoryDocumentMessageSpec=s;g.Armadillo$ApplicationData$AIBotResponseMessageSpec=t;g.Armadillo$ApplicationData$MetadataSyncActionSpec=u;g.Armadillo$ApplicationData$MetadataSyncAction$SyncMessageActionSpec=v;g.Armadillo$ApplicationData$MetadataSyncAction$SyncMessageAction$ActionMessageDeleteSpec=w;g.Armadillo$ApplicationData$MetadataSyncAction$SyncChatActionSpec=x;g.Armadillo$ApplicationData$MetadataSyncAction$SyncChatAction$ActionChatReadSpec=y;g.Armadillo$ApplicationData$MetadataSyncAction$SyncChatAction$ActionChatDeleteSpec=z;g.Armadillo$ApplicationData$MetadataSyncAction$SyncChatAction$ActionChatArchiveSpec=A;g.Armadillo$ApplicationData$MetadataSyncAction$SyncActionMessageSpec=B;g.Armadillo$ApplicationData$MetadataSyncAction$SyncActionMessageRangeSpec=C;g.Armadillo$ApplicationData$MetadataSyncNotificationSpec=D;g.Armadillo$ContentSpec=E;g.Armadillo$Content$PaymentsTransactionMessageSpec=F;g.Armadillo$Content$NetworkVerificationMessageSpec=G;g.Armadillo$Content$NoteReplyMessageSpec=H;g.Armadillo$Content$BumpExistingMessageSpec=I;g.Armadillo$Content$ImageGalleryMessageSpec=J;g.Armadillo$Content$ScreenshotActionSpec=K;g.Armadillo$Content$ExtendedContentMessageWithSearSpec=L;g.Armadillo$Content$RavenActionNotifMessageSpec=M;g.Armadillo$Content$RavenMessageSpec=N;g.Armadillo$Content$CommonStickerSpec=O}),98);
__d("WAArmadilloBackupCommon.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={payload:[1,d("WAProtoConst").TYPES.BYTES],version:[2,d("WAProtoConst").TYPES.INT32]};g.SubprotocolSpec=a}),98);
__d("WAArmadilloBackupMessage.pb",["WAArmadilloBackupCommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};a.internalSpec={metadata:[1,(e=d("WAProtoConst")).TYPES.MESSAGE,b],encryptedTransportMessage:[2,e.TYPES.BYTES],encryptedTransportEvent:[5,e.TYPES.MESSAGE,d("WAArmadilloBackupCommon.pb").SubprotocolSpec],encryptedTransportLocallyTransformedMessage:[6,e.TYPES.MESSAGE,d("WAArmadilloBackupCommon.pb").SubprotocolSpec],miTransportAdminMessage:[7,e.TYPES.MESSAGE,d("WAArmadilloBackupCommon.pb").SubprotocolSpec],__oneofs__:{payload:["encryptedTransportMessage","encryptedTransportEvent","encryptedTransportLocallyTransformedMessage","miTransportAdminMessage"]}};b.internalSpec={senderId:[1,e.TYPES.STRING],messageId:[2,e.TYPES.STRING],timestampMs:[3,e.TYPES.INT64],frankingMetadata:[4,e.TYPES.MESSAGE,c],payloadVersion:[5,e.TYPES.INT32],futureProofBehavior:[6,e.TYPES.INT32],threadTypeTag:[7,e.TYPES.INT32]};c.internalSpec={frankingTag:[3,e.TYPES.BYTES],reportingTag:[4,e.TYPES.BYTES]};g.BackupMessageSpec=a;g.BackupMessage$MetadataSpec=b;g.BackupMessage$Metadata$FrankingMetadataSpec=c}),98);
__d("WAArmadilloLocallyTransformedMessage.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.internalSpec={pollUpdateMessage:[1,d("WAProtoConst").TYPES.MESSAGE,b],__oneofs__:{content:["pollUpdateMessage"]}};b.internalSpec={pollCreationMessageId:[1,d("WAProtoConst").TYPES.STRING],pollUpdateMessageId:[2,d("WAProtoConst").TYPES.STRING]};g.LocallyTransformedMessageSpec=a;g.LocallyTransformedMessage$PollUpdateAdminMessageSpec=b}),98);
__d("WAConsumerApplication.pb",["WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={SMALL:1,MEDIUM:2,LARGE:3};b={SANS_SERIF:0,SERIF:1,NORICAN_REGULAR:2,BRYNDAN_WRITE:3,BEBASNEUE_REGULAR:4,OSWALD_HEAVY:5};c={NONE:0,VIDEO:1};e={};f={};var i={},j={},k={},l={},m={},n={},o={},p={},q={},r={},s={},t={},u={},v={},w={},x={},y={},z={},A={},B={},C={},D={},E={},F={},G={},H={},I={},J={},K={},L={},M={};e.internalSpec={payload:[1,(h=d("WAProtoConst")).TYPES.MESSAGE,f],metadata:[2,h.TYPES.MESSAGE,j]};f.internalSpec={content:[1,h.TYPES.MESSAGE,m],applicationData:[2,h.TYPES.MESSAGE,l],signal:[3,h.TYPES.MESSAGE,k],subProtocol:[4,h.TYPES.MESSAGE,i],__oneofs__:{payload:["content","applicationData","signal","subProtocol"]}};i.internalSpec={futureProof:[1,h.TYPES.ENUM,(d=d("WACommon.pb")).FUTURE_PROOF_BEHAVIOR]};j.internalSpec={specialTextSize:[1,h.TYPES.ENUM,a]};k.internalSpec={};l.internalSpec={revoke:[1,h.TYPES.MESSAGE,v],__oneofs__:{applicationContent:["revoke"]}};m.internalSpec={messageText:[1,h.TYPES.MESSAGE,d.MessageTextSpec],imageMessage:[2,h.TYPES.MESSAGE,I],contactMessage:[3,h.TYPES.MESSAGE,A],locationMessage:[4,h.TYPES.MESSAGE,D],extendedTextMessage:[5,h.TYPES.MESSAGE,C],statusTextMessage:[6,h.TYPES.MESSAGE,B],documentMessage:[7,h.TYPES.MESSAGE,F],audioMessage:[8,h.TYPES.MESSAGE,H],videoMessage:[9,h.TYPES.MESSAGE,G],contactsArrayMessage:[10,h.TYPES.MESSAGE,z],liveLocationMessage:[11,h.TYPES.MESSAGE,y],stickerMessage:[12,h.TYPES.MESSAGE,E],groupInviteMessage:[13,h.TYPES.MESSAGE,x],viewOnceMessage:[14,h.TYPES.MESSAGE,w],reactionMessage:[16,h.TYPES.MESSAGE,u],pollCreationMessage:[17,h.TYPES.MESSAGE,s],pollUpdateMessage:[18,h.TYPES.MESSAGE,r],editMessage:[19,h.TYPES.MESSAGE,n],__oneofs__:{content:["messageText","imageMessage","contactMessage","locationMessage","extendedTextMessage","statusTextMessage","documentMessage","audioMessage","videoMessage","contactsArrayMessage","liveLocationMessage","stickerMessage","groupInviteMessage","viewOnceMessage","reactionMessage","pollCreationMessage","pollUpdateMessage","editMessage"]}};n.internalSpec={key:[1,h.TYPES.MESSAGE,d.MessageKeySpec],message:[2,h.TYPES.MESSAGE,d.MessageTextSpec],timestampMs:[3,h.TYPES.INT64]};o.internalSpec={pollOption:[1,h.FLAGS.REPEATED|h.TYPES.MESSAGE,t]};p.internalSpec={selectedOptions:[1,h.FLAGS.REPEATED|h.TYPES.BYTES],senderTimestampMs:[2,h.TYPES.INT64]};q.internalSpec={encPayload:[1,h.TYPES.BYTES],encIv:[2,h.TYPES.BYTES]};r.internalSpec={pollCreationMessageKey:[1,h.TYPES.MESSAGE,d.MessageKeySpec],vote:[2,h.TYPES.MESSAGE,q],addOption:[3,h.TYPES.MESSAGE,q]};s.internalSpec={encKey:[1,h.TYPES.BYTES],name:[2,h.TYPES.STRING],options:[3,h.FLAGS.REPEATED|h.TYPES.MESSAGE,t],selectableOptionsCount:[4,h.TYPES.UINT32]};t.internalSpec={optionName:[1,h.TYPES.STRING]};u.internalSpec={key:[1,h.TYPES.MESSAGE,d.MessageKeySpec],text:[2,h.TYPES.STRING],groupingKey:[3,h.TYPES.STRING],senderTimestampMs:[4,h.TYPES.INT64],reactionMetadataDataclassData:[5,h.TYPES.STRING],style:[6,h.TYPES.INT32]};v.internalSpec={key:[1,h.TYPES.MESSAGE,d.MessageKeySpec]};w.internalSpec={imageMessage:[1,h.TYPES.MESSAGE,I],videoMessage:[2,h.TYPES.MESSAGE,G],__oneofs__:{viewOnceContent:["imageMessage","videoMessage"]}};x.internalSpec={groupJid:[1,h.TYPES.STRING],inviteCode:[2,h.TYPES.STRING],inviteExpiration:[3,h.TYPES.INT64],groupName:[4,h.TYPES.STRING],jpegThumbnail:[5,h.TYPES.BYTES],caption:[6,h.TYPES.MESSAGE,d.MessageTextSpec]};y.internalSpec={location:[1,h.TYPES.MESSAGE,L],accuracyInMeters:[2,h.TYPES.UINT32],speedInMps:[3,h.TYPES.FLOAT],degreesClockwiseFromMagneticNorth:[4,h.TYPES.UINT32],caption:[5,h.TYPES.MESSAGE,d.MessageTextSpec],sequenceNumber:[6,h.TYPES.INT64],timeOffset:[7,h.TYPES.UINT32]};z.internalSpec={displayName:[1,h.TYPES.STRING],contacts:[2,h.FLAGS.REPEATED|h.TYPES.MESSAGE,A]};A.internalSpec={contact:[1,h.TYPES.MESSAGE,d.SubProtocolSpec]};B.internalSpec={text:[1,h.TYPES.MESSAGE,C],textArgb:[6,h.TYPES.FIXED32],backgroundArgb:[7,h.TYPES.FIXED32],font:[8,h.TYPES.ENUM,b]};C.internalSpec={text:[1,h.TYPES.MESSAGE,d.MessageTextSpec],matchedText:[2,h.TYPES.STRING],canonicalUrl:[3,h.TYPES.STRING],description:[4,h.TYPES.STRING],title:[5,h.TYPES.STRING],thumbnail:[6,h.TYPES.MESSAGE,d.SubProtocolSpec],previewType:[7,h.TYPES.ENUM,c]};D.internalSpec={location:[1,h.TYPES.MESSAGE,L],address:[2,h.TYPES.STRING]};E.internalSpec={sticker:[1,h.TYPES.MESSAGE,d.SubProtocolSpec]};F.internalSpec={document:[1,h.TYPES.MESSAGE,d.SubProtocolSpec],fileName:[2,h.TYPES.STRING]};G.internalSpec={video:[1,h.TYPES.MESSAGE,d.SubProtocolSpec],caption:[2,h.TYPES.MESSAGE,d.MessageTextSpec]};H.internalSpec={audio:[1,h.TYPES.MESSAGE,d.SubProtocolSpec],ptt:[2,h.TYPES.BOOL]};I.internalSpec={image:[1,h.TYPES.MESSAGE,d.SubProtocolSpec],caption:[2,h.TYPES.MESSAGE,d.MessageTextSpec]};J.internalSpec={polygonVertices:[1,h.FLAGS.REPEATED|h.TYPES.MESSAGE,K],location:[2,h.TYPES.MESSAGE,L],__oneofs__:{action:["location"]}};K.internalSpec={x:[1,h.TYPES.DOUBLE],y:[2,h.TYPES.DOUBLE]};L.internalSpec={degreesLatitude:[1,h.TYPES.DOUBLE],degreesLongitude:[2,h.TYPES.DOUBLE],name:[3,h.TYPES.STRING]};M.internalSpec={protocol:[1,h.TYPES.MESSAGE,d.SubProtocolSpec]};g.CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE=a;g.CONSUMER_APPLICATION_STATUS_TEXT_MESAGE_FONT_TYPE=b;g.CONSUMER_APPLICATION_EXTENDED_TEXT_MESSAGE_PREVIEW_TYPE=c;g.ConsumerApplicationSpec=e;g.ConsumerApplication$PayloadSpec=f;g.ConsumerApplication$SubProtocolPayloadSpec=i;g.ConsumerApplication$MetadataSpec=j;g.ConsumerApplication$SignalSpec=k;g.ConsumerApplication$ApplicationDataSpec=l;g.ConsumerApplication$ContentSpec=m;g.ConsumerApplication$EditMessageSpec=n;g.ConsumerApplication$PollAddOptionMessageSpec=o;g.ConsumerApplication$PollVoteMessageSpec=p;g.ConsumerApplication$PollEncValueSpec=q;g.ConsumerApplication$PollUpdateMessageSpec=r;g.ConsumerApplication$PollCreationMessageSpec=s;g.ConsumerApplication$OptionSpec=t;g.ConsumerApplication$ReactionMessageSpec=u;g.ConsumerApplication$RevokeMessageSpec=v;g.ConsumerApplication$ViewOnceMessageSpec=w;g.ConsumerApplication$GroupInviteMessageSpec=x;g.ConsumerApplication$LiveLocationMessageSpec=y;g.ConsumerApplication$ContactsArrayMessageSpec=z;g.ConsumerApplication$ContactMessageSpec=A;g.ConsumerApplication$StatusTextMesageSpec=B;g.ConsumerApplication$ExtendedTextMessageSpec=C;g.ConsumerApplication$LocationMessageSpec=D;g.ConsumerApplication$StickerMessageSpec=E;g.ConsumerApplication$DocumentMessageSpec=F;g.ConsumerApplication$VideoMessageSpec=G;g.ConsumerApplication$AudioMessageSpec=H;g.ConsumerApplication$ImageMessageSpec=I;g.ConsumerApplication$InteractiveAnnotationSpec=J;g.ConsumerApplication$PointSpec=K;g.ConsumerApplication$LocationSpec=L;g.ConsumerApplication$MediaPayloadSpec=M}),98);
__d("WAMediaTransport.pb",["WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={NONE:0,LQ_4K:1,HQ_4K:2};b={NONE:0,GIPHY:1,TENOR:2};c={TALKING_A:0,IDLE_A:1,TALKING_B:2,IDLE_B:3,BACKGROUND:4};e={UNKNOWN:0,OPUS:1};f={};var i={},j={},k={},l={},m={},n={},o={},p={},q={},r={},s={},t={},u={},v={},w={},x={},y={},z={},A={},B={},C={},D={},E={},F={};f.internalSpec={integral:[1,(h=d("WAProtoConst")).TYPES.MESSAGE,l],ancillary:[2,h.TYPES.MESSAGE,i]};i.internalSpec={fileLength:[1,h.TYPES.UINT64],mimetype:[2,h.TYPES.STRING],thumbnail:[3,h.TYPES.MESSAGE,j],objectId:[4,h.TYPES.STRING]};j.internalSpec={jpegThumbnail:[1,h.TYPES.BYTES],downloadableThumbnail:[2,h.TYPES.MESSAGE,k],thumbnailWidth:[3,h.TYPES.UINT32],thumbnailHeight:[4,h.TYPES.UINT32]};k.internalSpec={fileSha256:[1,h.TYPES.BYTES],fileEncSha256:[2,h.TYPES.BYTES],directPath:[3,h.TYPES.STRING],mediaKey:[4,h.TYPES.BYTES],mediaKeyTimestamp:[5,h.TYPES.INT64],objectId:[6,h.TYPES.STRING],thumbnailScansSidecar:[7,h.TYPES.BYTES],thumbnailScanLengths:[8,h.FLAGS.REPEATED|h.TYPES.UINT32]};l.internalSpec={fileSha256:[1,h.TYPES.BYTES],mediaKey:[2,h.TYPES.BYTES],fileEncSha256:[3,h.TYPES.BYTES],directPath:[4,h.TYPES.STRING],mediaKeyTimestamp:[5,h.TYPES.INT64]};m.internalSpec={integral:[1,h.TYPES.MESSAGE,o],ancillary:[2,h.TYPES.MESSAGE,n]};n.internalSpec={height:[1,h.TYPES.UINT32],width:[2,h.TYPES.UINT32],scansSidecar:[3,h.TYPES.BYTES],scanLengths:[4,h.FLAGS.REPEATED|h.TYPES.UINT32],midQualityFileSha256:[5,h.TYPES.BYTES],hdType:[6,h.TYPES.ENUM,a],memoriesConceptScores:[7,h.FLAGS.REPEATED|h.FLAGS.PACKED|h.TYPES.FLOAT],memoriesConceptIds:[8,h.FLAGS.REPEATED|h.FLAGS.PACKED|h.TYPES.UINT32]};o.internalSpec={transport:[1,h.TYPES.MESSAGE,f]};p.internalSpec={integral:[1,h.TYPES.MESSAGE,r],ancillary:[2,h.TYPES.MESSAGE,q]};q.internalSpec={seconds:[1,h.TYPES.UINT32],caption:[2,h.TYPES.MESSAGE,d("WACommon.pb").MessageTextSpec],gifPlayback:[3,h.TYPES.BOOL],height:[4,h.TYPES.UINT32],width:[5,h.TYPES.UINT32],sidecar:[6,h.TYPES.BYTES],gifAttribution:[7,h.TYPES.ENUM,b],accessibilityLabel:[8,h.TYPES.STRING],isHd:[9,h.TYPES.BOOL]};r.internalSpec={transport:[1,h.TYPES.MESSAGE,f]};s.internalSpec={integral:[1,h.TYPES.MESSAGE,w],ancillary:[2,h.TYPES.MESSAGE,t]};t.internalSpec={seconds:[1,h.TYPES.UINT32],avatarAudio:[2,h.TYPES.MESSAGE,u]};u.internalSpec={poseId:[1,h.TYPES.UINT32],avatarAnimations:[2,h.FLAGS.REPEATED|h.TYPES.MESSAGE,v]};v.internalSpec={fileSha256:[1,h.TYPES.BYTES],fileEncSha256:[2,h.TYPES.BYTES],directPath:[3,h.TYPES.STRING],mediaKey:[4,h.TYPES.BYTES],mediaKeyTimestamp:[5,h.TYPES.INT64],objectId:[6,h.TYPES.STRING],animationsType:[7,h.TYPES.ENUM,c]};w.internalSpec={transport:[1,h.TYPES.MESSAGE,f],audioFormat:[2,h.TYPES.ENUM,e]};x.internalSpec={integral:[1,h.TYPES.MESSAGE,z],ancillary:[2,h.TYPES.MESSAGE,y]};y.internalSpec={pageCount:[1,h.TYPES.UINT32]};z.internalSpec={transport:[1,h.TYPES.MESSAGE,f]};A.internalSpec={integral:[1,h.TYPES.MESSAGE,C],ancillary:[2,h.TYPES.MESSAGE,B]};B.internalSpec={pageCount:[1,h.TYPES.UINT32],height:[2,h.TYPES.UINT32],width:[3,h.TYPES.UINT32],firstFrameLength:[4,h.TYPES.UINT32],firstFrameSidecar:[5,h.TYPES.BYTES],mustacheText:[6,h.TYPES.STRING],isThirdParty:[7,h.TYPES.BOOL],receiverFetchId:[8,h.TYPES.STRING],accessibilityLabel:[9,h.TYPES.STRING]};C.internalSpec={transport:[1,h.TYPES.MESSAGE,f],isAnimated:[2,h.TYPES.BOOL],receiverFetchId:[3,h.TYPES.STRING]};D.internalSpec={integral:[1,h.TYPES.MESSAGE,F],ancillary:[2,h.TYPES.MESSAGE,E]};E.internalSpec={displayName:[1,h.TYPES.STRING]};F.internalSpec={vcard:[1,h.TYPES.STRING],downloadableVcard:[2,h.TYPES.MESSAGE,f],__oneofs__:{contact:["vcard","downloadableVcard"]}};g.IMAGE_TRANSPORT_ANCILLARY_HD_TYPE=a;g.VIDEO_TRANSPORT_ANCILLARY_ATTRIBUTION=b;g.AUDIO_TRANSPORT_ANCILLARY_AVATAR_AUDIO_ANIMATIONS_TYPE=c;g.AUDIO_TRANSPORT_INTEGRAL_AUDIO_FORMAT=e;g.WAMediaTransportSpec=f;g.WAMediaTransport$AncillarySpec=i;g.WAMediaTransport$Ancillary$ThumbnailSpec=j;g.WAMediaTransport$Ancillary$Thumbnail$DownloadableThumbnailSpec=k;g.WAMediaTransport$IntegralSpec=l;g.ImageTransportSpec=m;g.ImageTransport$AncillarySpec=n;g.ImageTransport$IntegralSpec=o;g.VideoTransportSpec=p;g.VideoTransport$AncillarySpec=q;g.VideoTransport$IntegralSpec=r;g.AudioTransportSpec=s;g.AudioTransport$AncillarySpec=t;g.AudioTransport$Ancillary$AvatarAudioSpec=u;g.AudioTransport$Ancillary$AvatarAudio$DownloadableAvatarAnimationsSpec=v;g.AudioTransport$IntegralSpec=w;g.DocumentTransportSpec=x;g.DocumentTransport$AncillarySpec=y;g.DocumentTransport$IntegralSpec=z;g.StickerTransportSpec=A;g.StickerTransport$AncillarySpec=B;g.StickerTransport$IntegralSpec=C;g.ContactTransportSpec=D;g.ContactTransport$AncillarySpec=E;g.ContactTransport$IntegralSpec=F}),98);
__d("WAMsgApplication.pb",["WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={DEFAULT:0,VANISH_MODE:1,DISAPPEARING_MESSAGES:2};b={UNKNOWN:0,SEEN_ONCE:1,SEEN_BASED_WITH_TIMER:2,SEND_BASED_WITH_TIMER:3};c={};e={};f={};var i={},j={},k={},l={},m={},n={},o={};c.internalSpec={payload:[1,(h=d("WAProtoConst")).TYPES.MESSAGE,j],metadata:[2,h.TYPES.MESSAGE,e]};e.internalSpec={chatEphemeralSetting:[1,h.TYPES.MESSAGE,o],ephemeralSettingList:[2,h.TYPES.MESSAGE,i],ephemeralSharedSecret:[3,h.TYPES.BYTES],forwardingScore:[5,h.TYPES.UINT32],isForwarded:[6,h.TYPES.BOOL],businessMetadata:[7,h.TYPES.MESSAGE,(d=d("WACommon.pb")).SubProtocolSpec],frankingKey:[8,h.TYPES.BYTES],frankingVersion:[9,h.TYPES.INT32],quotedMessage:[10,h.TYPES.MESSAGE,f],threadType:[11,h.TYPES.ENUM,a],readonlyMetadataDataclass:[12,h.TYPES.STRING],groupId:[13,h.TYPES.STRING],groupSize:[14,h.TYPES.UINT32],groupIndex:[15,h.TYPES.UINT32],botResponseId:[16,h.TYPES.STRING],collapsibleId:[17,h.TYPES.STRING],secondaryOtid:[18,h.TYPES.STRING],__oneofs__:{ephemeral:["chatEphemeralSetting","ephemeralSettingList","ephemeralSharedSecret"]}};f.internalSpec={stanzaId:[1,h.TYPES.STRING],remoteJid:[2,h.TYPES.STRING],participant:[3,h.TYPES.STRING],payload:[4,h.TYPES.MESSAGE,j]};i.internalSpec={chatJid:[1,h.TYPES.STRING],ephemeralSetting:[2,h.TYPES.MESSAGE,o]};j.internalSpec={coreContent:[1,h.TYPES.MESSAGE,n],signal:[2,h.TYPES.MESSAGE,m],applicationData:[3,h.TYPES.MESSAGE,l],subProtocol:[4,h.TYPES.MESSAGE,k],__oneofs__:{content:["coreContent","signal","applicationData","subProtocol"]}};k.internalSpec={futureProof:[1,h.TYPES.ENUM,d.FUTURE_PROOF_BEHAVIOR],consumerMessage:[2,h.TYPES.MESSAGE,d.SubProtocolSpec],businessMessage:[3,h.TYPES.MESSAGE,d.SubProtocolSpec],paymentMessage:[4,h.TYPES.MESSAGE,d.SubProtocolSpec],multiDevice:[5,h.TYPES.MESSAGE,d.SubProtocolSpec],voip:[6,h.TYPES.MESSAGE,d.SubProtocolSpec],armadillo:[7,h.TYPES.MESSAGE,d.SubProtocolSpec],__oneofs__:{subProtocol:["consumerMessage","businessMessage","paymentMessage","multiDevice","voip","armadillo"]}};l.internalSpec={};m.internalSpec={};n.internalSpec={};o.internalSpec={ephemeralExpiration:[2,h.TYPES.UINT32],ephemeralSettingTimestamp:[3,h.TYPES.INT64],ephemeralityType:[5,h.TYPES.ENUM,b],isEphemeralSettingReset:[4,h.TYPES.BOOL]};g.MESSAGE_APPLICATION_METADATA_THREAD_TYPE=a;g.MESSAGE_APPLICATION_EPHEMERAL_SETTING_EPHEMERALITY_TYPE=b;g.MessageApplicationSpec=c;g.MessageApplication$MetadataSpec=e;g.MessageApplication$Metadata$QuotedMessageSpec=f;g.MessageApplication$Metadata$EphemeralSettingMapSpec=i;g.MessageApplication$PayloadSpec=j;g.MessageApplication$SubProtocolPayloadSpec=k;g.MessageApplication$ApplicationDataSpec=l;g.MessageApplication$SignalSpec=m;g.MessageApplication$ContentSpec=n;g.MessageApplication$EphemeralSettingSpec=o}),98);
__d("WAParseMessageApplication",["decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b,c,e=a.payload;if(e==null)return{version:"v3",type:"error",error:"The messageApplication has no payload"};if(d("decodeProtobuf").getUnknownFields(a.payload)!=null)return{version:"v3",type:"error",error:"There are unknown fields in the message application payload"};e=e.subProtocol;if(e==null)return{version:"v3",type:"error",error:"The messageApplication payload has no subProtocol"};if(d("decodeProtobuf").getUnknownFields(e)!=null)return{version:"v3",type:"error",error:"messageApplication subProtocol has unknown fields",futureProof:e.futureProof};e=[];b=(b=a.payload)==null?void 0:(b=b.subProtocol)==null?void 0:b.consumerMessage;c=(c=a.payload)==null?void 0:(c=c.subProtocol)==null?void 0:c.armadillo;a=(a=a.payload)==null?void 0:(a=a.subProtocol)==null?void 0:a.multiDevice;if(b!=null){if(b.payload==null)return{version:"v3",type:"error",error:"subprotocol of type consumerMessage has no payload"};e.push({payload:new Uint8Array(b.payload),type:"success",subprotocolType:"consumerMessage"})}if(c!=null){if(c.payload==null)return{version:"v3",type:"error",error:"subprotocol of type armadillo has no payload"};e.push({payload:new Uint8Array(c.payload),type:"success",subprotocolType:"armadillo"})}if(a!=null){if(a.payload==null)return{version:"v3",type:"error",error:"subprotocol of type multiDevice has no payload"};e.push({payload:new Uint8Array(a.payload),type:"success",subprotocolType:"multiDevice"})}return e.length!==1?{version:"v3",type:"error",error:"Wrong number of subprotocols: "+e.length}:e[0]}g.parseMessageApplication=a}),98);
__d("MpsDeserializers",["WAArmadilloApplication.pb","WAArmadilloBackupMessage.pb","WAArmadilloLocallyTransformedMessage.pb","WAArmadilloTransportEvent.pb","WAConsumerApplication.pb","WAMediaTransport.pb","WAMsgApplication.pb","WAParseMessageApplication","decodeProtobuf","err","memoize","memoizeWithArgsWeak","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a){var b;this.image=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").ImageTransportSpec,(b=a.image)==null?void 0:b.payload);this.caption=a.caption},i=function(a){var b;this.audio=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").AudioTransportSpec,(b=a.audio)==null?void 0:b.payload);this.ptt=a.ptt},j=function(a){var b;this.video=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").VideoTransportSpec,(b=a.video)==null?void 0:b.payload);this.caption=a.caption},k=function(a){var b;this.document=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").DocumentTransportSpec,(b=a.document)==null?void 0:b.payload);this.fileName=a.fileName},l=function(a){this.sticker=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").StickerTransportSpec,(a=a.sticker)==null?void 0:a.payload)},m=function(a){var b=this,e;this.kind="consumerApplication";this.imageMessage=(e=c("memoize"))(function(){var a;a=(a=b.payload)==null?void 0:(a=a.content)==null?void 0:a.imageMessage;if(a==null)return;return new h(a)});this.audioMessage=e(function(){var a;a=(a=b.payload)==null?void 0:(a=a.content)==null?void 0:a.audioMessage;if(a==null)return;return new i(a)});this.videoMessage=e(function(){var a;a=(a=b.payload)==null?void 0:(a=a.content)==null?void 0:a.videoMessage;if(a==null)return;return new j(a)});this.documentMessage=e(function(){var a;a=(a=b.payload)==null?void 0:(a=a.content)==null?void 0:a.documentMessage;if(a==null)return;return new k(a)});this.stickerMessage=e(function(){var a;a=(a=b.payload)==null?void 0:(a=a.content)==null?void 0:a.stickerMessage;if(a==null)return;return new l(a)});this.proto=d("decodeProtobuf").decodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,a);this.payload=this.proto.payload;this.metadata=this.proto.metadata},n=function(){function a(a){var b=this;this.kind="messageApplication";this.subProtocol=c("memoize")(function(){var a=d("WAParseMessageApplication").parseMessageApplication(b.proto);if(a.payload!=null)switch(a.subprotocolType){case"consumerMessage":return new m(c("nullthrows")(a.payload));case"armadillo":return{kind:"armadillo",value:d("decodeProtobuf").decodeProtobuf(d("WAArmadilloApplication.pb").ArmadilloSpec,a.payload)};case"businessMessage":case"paymentMessage":case"multiDevice":case"voip":break;default:a.subprotocolType}});this.proto=d("decodeProtobuf").decodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,a)}var b=a.prototype;b.consumerMessage=function(){var a=this.subProtocol();return(a==null?void 0:a.kind)!=="consumerApplication"?null:a};b.armadillo=function(){var a=this.subProtocol();return(a==null?void 0:a.kind)!=="armadillo"?null:a.value};return a}(),o=function(a){this.kind="transportEvent",this.proto=d("decodeProtobuf").decodeProtobuf(d("WAArmadilloTransportEvent.pb").TransportEventSpec,a)},p=function(a){this.kind="locallyTransformedMessage",this.proto=d("decodeProtobuf").decodeProtobuf(d("WAArmadilloLocallyTransformedMessage.pb").LocallyTransformedMessageSpec,a)},q="SKIP_CACHE",r=function(){function a(a,b){var e=this;this.payload=c("memoize")(function(){if(e.proto.encryptedTransportEvent!=null)return new o(c("nullthrows")(e.proto.encryptedTransportEvent.payload));else if(e.proto.encryptedTransportLocallyTransformedMessage!=null)return new p(c("nullthrows")(e.proto.encryptedTransportLocallyTransformedMessage.payload));else if(e.proto.encryptedTransportMessage!=null)return new n(c("nullthrows")(e.proto.encryptedTransportMessage));throw c("err")("BackupMessage proto has no payload")});this.proto=d("decodeProtobuf").decodeProtobuf(d("WAArmadilloBackupMessage.pb").BackupMessageSpec,a)}var b=a.prototype;b.encryptedTransportMessage=function(){var a=this.payload();if(a.kind!=="messageApplication")return;return a};b.encryptedTransportEvent=function(){var a=this.payload();if(a.kind!=="transportEvent")return;return a};b.locallyTransformedMessage=function(){var a=this.payload();if(a.kind!=="locallyTransformedMessage")return;return a};return a}();r.create=c("memoizeWithArgsWeak")(function(a){return new r(a,q)});g.DeserializedMessageApplication=n;g.DeserializedTransportEvent=o;g.DeserializedLocallyTransformedMessage=p;g.DeserializedBackupMessage=r}),98);
__d("MpsEditToBridge",["LSMessageSendStatus","MAWDbEditMsgHistory","WAJids","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){var e=d("MAWDbEditMsgHistory").convertToEditMsgHistoryId64(d("MAWDbEditMsgHistory").unsafeCoerceToEditMsgHistoryId(Number(a.getExternalId()))),f=a.topLevelMetadata();e={author:a.getAuthor(),editExternalId:d("WAStanzaUtils").toStanzaId(a.getExternalId()),editMsgHistoryId:e,editTs:a.getUnixTs(),msgContent:b,originalMsgExternalId:d("WAStanzaUtils").toStanzaId(f.getExternalId()),originalMsgId:f.getMsgId(),sendStatus:c("LSMessageSendStatus").SENDING_TO_SERVER,threadJid:a.getChatJid()};return{kind:"bridgeEditHistoryMsg",value:e}}function a(a){var b;b=(b=a.deserialize().encryptedTransportMessage())==null?void 0:(b=b.consumerMessage())==null?void 0:(b=b.payload)==null?void 0:(b=b.content)==null?void 0:(b=b.editMessage)==null?void 0:b.message;if(b==null)return;return h(a,{commands:b==null?void 0:b.commands,content:((a=b==null?void 0:b.text)!=null?a:"")+" *",mentionedJids:b==null?void 0:b.mentionedJid.map(d("WAJids").validateUserJid).filter(Boolean)})}function b(a){var b,c=a.message,d=a.supplementals,e=a.topLevel;if(e.kind!=="bridgeMsg")return a;var f=d.map(function(a){return a.kind==="bridgeEditHistoryMsg"?a.value:null}).filter(Boolean).sort(function(a,b){return b.editTs-a.editTs});if(f.length===0)return a;d.push(h(c,{commands:e.value.commands&&[].concat(e.value.commands),content:(a=e.value.content)!=null?a:"",mentionedJids:e.value.mentionedJids&&[].concat(e.value.mentionedJids)}));a=f[0].msgContent;e.value=babelHelpers["extends"]({},e.value,{commands:(b=a.commands)!=null?b:e.value.commands,content:(b=a.content)!=null?b:e.value.content,editCount:f.length,mentionedJids:(b=a.mentionedJids)!=null?b:e.value.mentionedJids});return{message:c,supplementals:d,topLevel:e}}g.editMessageToBridgeMsg=a;g.processEditedMessage=b}),98);
__d("MpsMessageTextToBridge",["MAWAckLevel","MAWVault","WAJids","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b,c,e=a.deserialize().encryptedTransportMessage(),f=e==null?void 0:e.consumerMessage();b=f==null?void 0:(b=f.payload)==null?void 0:(b=b.content)==null?void 0:b.messageText;if(f==null||b==null||e==null)return;c=(c=b.text)!=null?c:"";var g=Array.from(c).length<=1;g||(c+="*");c=d("MAWVault").vault(c);c={ack:d("MAWAckLevel").ACK.received,chatJid:a.getChatJid(),commands:b.commands,content:c,externalId:a.getExternalId(),forwardingScore:(c=(g=e.proto.metadata)==null?void 0:g.forwardingScore)!=null?c:0,isAdminMessage:!1,isAuthorMe:a.isAuthorMe(),isForwarded:(c=(g=e.proto.metadata)==null?void 0:g.isForwarded)!=null?c:!1,mentionedJids:b.mentionedJid.map(d("WAJids").validateUserJid).filter(Boolean),msgId:a.getMsgId(),sender:a.message.senderId,sortOrderMs:a.message.timestampMs,specialTextSize:(g=(e=f.metadata)==null?void 0:e.specialTextSize)!=null?g:void 0,ts:a.getUnixTs(),type_:d("WAMsgType").MSG_TYPE.TEXT};return{kind:"bridgeMsg",value:c}}g.messageTextToBridgeMsg=a}),98);
__d("MpsToBridgeMessageId",["MAWDbMsg","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return c("nullthrows")(d("MAWDbMsg").toMsgId(a+"_"+b+"_m"))}g.mpsToBridgeMsgId=a}),98);
__d("MpsMessageToBridgeWrapper",["MAWUserJidWrapper","MpsDeserializers","MpsToBridgeMessageId","WAJids","WATimeUtils","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h=d("WAJids").createJidUtils({platform:"msgr"});a=function(){function a(a,b){this.message=a,this.topLevel=b}a.fromTopLevel=function(b){return new a(b,b)};a.fromSupplemental=function(b,e){var f=d("MpsDeserializers").DeserializedBackupMessage.create(b.payload);f={messageId:b.messageId,payload:b.payload,senderId:c("nullthrows")((f=f.proto.metadata)==null?void 0:f.senderId),threadId:e.threadId,timestampMs:b.timestampMs};return new a(f,e)};var b=a.prototype;b.getChatJid=function(){return d("WAJids").unsafeCoerceToChatJid(this.message.threadId)};b.getExternalId=function(){return this.message.messageId};b.getMsgId=function(){return d("MpsToBridgeMessageId").mpsToBridgeMsgId(this.message.threadId,this.message.messageId)};b.getSenderJid=function(){return h.toUserJid(this.message.senderId)};b.topLevelMetadata=function(){return a.fromTopLevel(this.topLevel)};b.isAuthorMe=function(){return d("WAJids").userIdFromJid(d("MAWUserJidWrapper").getMyUserJid())===this.message.senderId};b.getAuthor=function(){return this.isAuthorMe()?d("WAJids").AUTHOR_ME:this.getSenderJid()};b.getUnixTs=function(){return d("WATimeUtils").castMilliSecondsToUnixTime(this.message.timestampMs)};b.deserialize=function(){return d("MpsDeserializers").DeserializedBackupMessage.create(this.message.payload)};return a}();g.MpsMessageToBridgeWrapper=a}),98);
__d("MpsReactionToBridge",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b;b=(b=a.deserialize().encryptedTransportMessage())==null?void 0:(b=b.consumerMessage())==null?void 0:(b=b.payload)==null?void 0:(b=b.content)==null?void 0:b.reactionMessage;if(b==null)return;b={reaction:{actorId:a.message.senderId,chatJid:a.getChatJid(),messageId:a.topLevelMetadata().getMsgId(),reaction:(b=b.text)!=null?b:"",ts:a.topLevelMetadata().getUnixTs()},type:"upsert"};return{kind:"bridgeReactionAction",value:b}}f.reactionMessageToBridgeMsg=a}),66);
__d("MpsReplyToBridge",["MAWUserJidWrapper","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.message,c=a.supplementals,e=a.topLevel,f=b.deserialize().encryptedTransportMessage();if(e.kind!=="bridgeMsg"||f==null)return a;f=(f=f.proto.metadata)==null?void 0:f.quotedMessage;if(f==null)return a;a=f.participant!=null?d("WAJids").validateUserJid(f==null?void 0:f.participant):null;a=a!=null?d("WAJids").userIdFromJid(a):void 0;var g=d("WAJids").userIdFromJid(d("MAWUserJidWrapper").getMyUserJid());e.value=babelHelpers["extends"]({},e.value,{replySenderIsMe:a===g,replySourceId:f==null?void 0:f.stanzaId,replyToUserId:a});return{message:b,supplementals:c,topLevel:e}}g.processReplyMessage=a}),98);
__d("MpsRevokeMessageToBridgeMsg",["MAWAckLevel","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b,c=a.deserialize().encryptedTransportMessage();b=c==null?void 0:(b=c.consumerMessage())==null?void 0:(b=b.payload)==null?void 0:(b=b.applicationData)==null?void 0:b.revoke;if(c==null||b==null)return;return{kind:"bridgeMsg",value:{ack:d("MAWAckLevel").ACK.received,chatJid:a.getChatJid(),externalId:a.getExternalId(),forwardingScore:(b=(b=c.proto.metadata)==null?void 0:b.forwardingScore)!=null?b:0,isAdminMessage:!1,isAuthorMe:a.isAuthorMe(),isForwarded:(c=(b=c.proto.metadata)==null?void 0:b.isForwarded)!=null?c:!1,msgId:a.getMsgId(),sender:a.message.senderId,sortOrderMs:a.message.timestampMs,ts:a.getUnixTs(),type_:d("WAMsgType").MSG_TYPE.REVOKED}}}g.revokeMessageToBridgeMsg=a}),98);
__d("MpsMessageToBridge",["MpsEditToBridge","MpsMessageTextToBridge","MpsMessageToBridgeWrapper","MpsReactionToBridge","MpsReplyToBridge","MpsRevokeMessageToBridgeMsg"],(function(a,b,c,d,e,f,g){"use strict";var h=[d("MpsEditToBridge").editMessageToBridgeMsg,d("MpsReactionToBridge").reactionMessageToBridgeMsg,d("MpsMessageTextToBridge").messageTextToBridgeMsg,d("MpsRevokeMessageToBridgeMsg").revokeMessageToBridgeMsg],i=[d("MpsEditToBridge").processEditedMessage,d("MpsReplyToBridge").processReplyMessage];function j(a){for(var b=0;b<h.length;b++){var c=h[b];c=c(a);if(c!=null)return c}}function a(a){var b=d("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(a.toplevelProtobuf),c=j(b);if(c==null)return;var e=a.supplementalProtobufs.values().toArray().map(function(b){return j(d("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromSupplemental(b,a.toplevelProtobuf))}).filter(Boolean);b=i.reduce(function(a,b){return b(a)},{message:b,supplementals:e,topLevel:c});return{supplementals:b.supplementals,topLevel:b.topLevel}}g.mpsFullMessagetoBridge=a}),98);
__d("RavenMessagingState",[],(function(a,b,c,d,e,f){a=Object.freeze({PERMANENT:0,UNSEEN:1,SEEN:2,REPLAYED:3,EXPIRED:4});f["default"]=a}),66);
__d("WAGetPlatformFromStanzaId",["I64","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to parse stanza id "," for platform: ",""]);i=function(){return a};return a}function a(a){try{var b=(1<<5)-1;b=(h||(h=d("I64"))).of_float(b<<17);var c=h.of_float(0),e=h.of_float(1<<17);b=h.and_(h.of_string(a),b);if((h||(h=d("I64"))).equal(b,c))return"web";return(h||(h=d("I64"))).equal(b,e)?"mobile":"unknown"}catch(b){d("WALogger").ERROR(i(),a,b);return"error"}}g.getPlatformFromStanzaId=a}),98);
__d("WAMapContentTypeToFbType",[],(function(a,b,c,d,e,f){"use strict";function a(a){switch(a){case"text":return"text";case"media":return"media";case"reaction":return"reaction";case"live_location":case"pay":case"product_list":case"poll_creation":case"poll_vote":case"scheduled_call":return"text";default:return"text"}}f.mapContentTypeToFbType=a}),66);
__d("WAMediaHdType",[],(function(a,b,c,d,e,f,g){"use strict";a=0;b=1;c=2;d={HD_TYPE_NONE:a,HD_TYPE_LQ_4K:b,HD_TYPE_HQ_4K:c};g.HD_TYPE_NONE=a;g.HD_TYPE_LQ_4K=b;g.HD_TYPE_HQ_4K=c;g.HD_TYPE=d}),98);
__d("WAPREList",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({APP_STATE_SYNC_DAILY:"app_state_sync_daily",CREATE_GROUP:"create_group",DECRYPT_MESSAGE_FINAL:"decrypt_message_final",DELETE_THREAD:"delete_thread",DOWNLOAD_AND_DECRYPT:"download_and_decrypt",EB_RESTORE_WITH_HIM:"eb_restore_with_him",EBDB_INIT:"ebdb_init",FRANKING_VALIDATION:"franking_validation",GET_DEVICES:"get_devices",ICDC_ERROR:"icdc_error",MEDIA_DOWNLOAD:"media_download",MEDIA_UPLOAD:"media_upload",MEDIA_VALIDATE:"media_validate",MESSAGE_DECRYPTION:"message_decryption",MESSAGE_ENCRYPTION:"message_encryption",OFFLINE_QUEUE:"offline_queue",OFFLINE_RETRY:"offline_retry",ONE_QUEUE:"one_queue",QUERY_GROUP:"query_group",QUERY_GROUPS:"query_groups",RECEIVE_MESSAGE:"receive_message",REMOVE_PARTICIPANTS:"remove_participants",SEND_MESSAGE:"send_message",STANZA_QUEUE_MESSAGE_CONSUMER:"stanza_queue_message_consumer",SYNCD:"syncd",SYNCD_BOOTSTRAP_APP_STATE_DOWNLOAD:"syncd_bootstrap_app_state_download",SYNCD_BOOTSTRAP_DATA_APPLIED:"syncd_bootstrap_data_applied",SYNCD_CRITICAL_BOOTSTRAP_STAGE:"syncd_critical_bootstrap_stage",SYNCD_CRITICAL_EVENT:"syncd_critical_event",SYNCD_DECRYPT_MUTATIONS:"syncd_decrypt_mutations",SYNCD_FATAL_ERROR:"syncd_fatal_error",SYNCD_KEY_ROTATION:"syncd_key_rotation",WA_DISCONNECT:"wa_disconnect",WA_FAIL_STANZA_QUEUE_ITEM:"stanza_queue_item_failure",WA_JOB_MANAGER:"wa_job_manager",WA_JOBS_ORCHESTRATOR:"wa_jobs_orchestrator",WA_NO_SIGNED_PRE_KEY:"wa_no_signed_pre_key",WORKER_SCHEDULER:"worker_scheduler",WORKER_SCHEDULER_STUCK:"worker_scheduler_stuck",WORM:"worm"});f.PRE_METRIC=a}),66);
__d("WAPREMetrics",["WALogger","WAPREList"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PRE][","] EventFlow still active during garbage collection"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PRE] There are no subscribers to PRE events "," ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Removing all listeners from PRE_METRICS"]);j=function(){return a};return a}c=6e4;e=18e4;f=10*60*1e3;var k=0;function a(){var c=[];function e(a){c.push(a)}function b(){d("WALogger").WARN(j()),c.length=0}function a(a){c.length===0&&d("WALogger").WARN(i(),a.name,a.stage),c.forEach(function(b){b(a)})}return{subscribe:e,notify:a,clear:b}}a=a();var l=a.notify,m=a.clear;a=a.subscribe;var n;"FinalizationRegistry"in self&&"WeakRef"in self&&(n=new FinalizationRegistry(function(a){var b=a.event;a=a.eventFlow;if(a.isActive())try{d("WALogger").ERROR(h(),b)}catch(a){}}));var o=new Set([d("WAPREList").PRE_METRIC.SEND_MESSAGE,d("WAPREList").PRE_METRIC.MEDIA_DOWNLOAD]);function b(a,b,c,d){var e;c==null&&k++;var f=(e=c)!=null?e:k,g="open";c==null?l({name:a,stage:"START",instanceKey:f,annotations:b,timeoutInMs:d}):l({name:a,stage:"RESUME",instanceKey:f,annotations:b});var h;function i(){if(h!=null){var a=h.deref();if(a!=null){var b;(b=n)==null?void 0:b.unregister(a)}}}e={addPoint:function(c,b){l({name:a,stage:"POINT",reason:c,instanceKey:f,annotations:b})},addAnnotations:function(b){l({name:a,stage:"ANNOTATE",instanceKey:f,annotations:b})},endSuccess:function(b){l({name:a,stage:"SUCCESS",instanceKey:f,annotations:b}),g="closed",i()},endCancel:function(b){l({name:a,stage:"CANCEL",instanceKey:f,annotations:b}),i()},endFail:function(c,b){l({name:a,stage:"FAIL",reason:c,instanceKey:f,annotations:b}),g="closed",i()},getFlowDetails:function(){return{name:a,instanceKey:f}},isActive:function(){return g==="open"}};n&&!o.has(a)&&c==null&&(n.register(e,{event:a,eventFlow:{endCancel:e.endCancel,isActive:e.isActive}}),h=new WeakRef(e));return e}g.QPL_DEFAULT_TIMEOUT_IN_MS=c;g.QPL_RECEIVE_MESSAGE_TIMEOUT_IN_MS=e;g.QPL_MEDIA_DOWNLOAD_TIMEOUT_IN_MS=f;g.clear=m;g.subscribe=a;g.startMetric=b}),98);
__d("WAProtocolQueue",["WAGlobals","WAJids","WALogger","WAMapContentTypeToFbType","WAPersistedQueue","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Protocol Queue is already initialized"]);h=function(){return a};return a}var i=5e3,j=null;function a(a){if(j!=null){d("WALogger").WARN(h());return j}a=d("WAPersistedQueue").initPersistedQueue("stanzaQueue",a,{cacheSize:null,maxDelay:i});j=a;return j}function k(){if(!j)throw c("err")("Protocol queue not initialized");return j}var l=function(){function a(){this.$1=[],this.$2=[],this.$3=[]}var b=a.prototype;b.enqueue=function(a,b,c){this.$1.push(a),b&&this.$2.push(b),c&&this.$3.push(c)};b.flush=function(a,b,c,d,e){a=this.$1;var f=this.$2,g=this.$3;this.$1=[];this.$2=[];this.$3=[];return k().addAndCommit(a).then(function(){return f.forEach(function(a){return a()})})["catch"](function(a){return g.forEach(function(b){return b(a)})})};return a}(),m=new l();function b(a){return{flush:function(){return a.commit()}}}function e(a){return a.map(function(a){return a.type==="message"?n(a):babelHelpers["extends"]({},a)})}function n(a){switch(a.subtype){case"unavailable":var b=a,c=d("WAJids").extractUserJid(b.from);c={id:{author:d("WAGlobals").getMyUserJid()===c?"@me":c,chat:b.jid,externalId:b.stanzaId},ts:b.serverTs,type:"UnavailableMsg"};return{incomingType:"wa",jid:b.jid,message:{decrypted:c,details:{count:null,externalId:b.stanzaId,folder:b.fbFolderId,from:d("WAJids").switchOnMsgrChatJidType(b.jid,{group:function(a){return{author:b.from,chat:a,groupJid:a,type:"group"}},user:function(a){return{author:b.from,chat:a,deviceJid:b.from,type:"device"}}}),hideDecryptionFailure:!1,isInstamadillo:!1,offline:b.offline,recipient:b.recipient,reportingMeta:b.reportingMeta,retryCount:b.retryCount,ts:b.serverTs,type:d("WAMapContentTypeToFbType").mapContentTypeToFbType(b.contentType)}},priority:b.priority,stanzaId:b.stanzaId,stanzaQueueId:a.stanzaQueueId,type:b.type};case"armadillo":var e=a;c=d("WAJids").extractUserJid(e.from);c={folder:e.fbFolderId,id:{author:d("WAGlobals").getMyUserJid()===c?"@me":c,chat:e.jid,externalId:e.stanzaId},msg:e.message,recipientsCount:null,reportingMeta:e.reportingMeta,ts:e.serverTs,type:"IncomingMsg"};return{incomingType:a.incomingType,jid:e.jid,message:{decrypted:c,details:{count:null,externalId:e.stanzaId,folder:e.fbFolderId,from:d("WAJids").switchOnMsgrChatJidType(e.jid,{group:function(a){return{author:e.from,chat:a,groupJid:a,type:"group"}},user:function(a){return{author:e.from,chat:a,deviceJid:e.from,type:"device"}}}),hideDecryptionFailure:!1,isInstamadillo:!1,offline:e.offline,recipient:e.recipient,reportingMeta:e.reportingMeta,retryCount:e.retryCount,ts:e.serverTs,type:d("WAMapContentTypeToFbType").mapContentTypeToFbType(e.contentType)}},priority:e.priority,stanzaId:e.stanzaId,stanzaQueueId:a.stanzaQueueId,type:e.type,ebTimestampMs:e.ebTimestampMs};case"instamadillo":var f=a;c=d("WAJids").extractUserJid(f.from);c={folder:f.fbFolderId,id:{author:d("WAGlobals").getMyUserJid()===c?"@me":c,chat:f.jid,externalId:f.stanzaId},msg:f.message,recipientsCount:null,reportingMeta:f.reportingMeta,ts:f.serverTs,type:"InstamadilloMsg"};return{incomingType:"wa",jid:f.jid,message:{decrypted:c,details:{count:null,externalId:f.stanzaId,folder:f.fbFolderId,from:d("WAJids").switchOnMsgrChatJidType(f.jid,{group:function(a){return{author:f.from,chat:a,groupJid:a,type:"group"}},user:function(a){return{author:f.from,chat:a,deviceJid:f.from,type:"device"}}}),hideDecryptionFailure:!1,isInstamadillo:!0,offline:f.offline,recipient:f.recipient,reportingMeta:f.reportingMeta,retryCount:f.retryCount,ts:f.serverTs,type:d("WAMapContentTypeToFbType").mapContentTypeToFbType(f.contentType)}},priority:f.priority,stanzaId:f.stanzaId,stanzaQueueId:a.stanzaQueueId,type:f.type};case"ciphertext":c=function(){if(g.contentType==="reaction")return!1;return g.hideDecryptionFailure===!0?!1:!0};var g=a,h=d("WAJids").extractUserJid(g.from);c={createPlaceholder:c(),id:{author:d("WAGlobals").getMyUserJid()===h?"@me":h,chat:g.jid,externalId:g.stanzaId},ts:g.serverTs,type:"IncomingCiphertextMsg"};return{incomingType:"wa",jid:g.jid,message:{decrypted:c,details:{count:null,type:d("WAMapContentTypeToFbType").mapContentTypeToFbType(g.contentType),externalId:g.stanzaId,folder:g.fbFolderId,from:d("WAJids").switchOnMsgrChatJidType(g.jid,{group:function(a){return{author:g.from,chat:a,groupJid:a,type:"group"}},user:function(a){return{author:g.from,chat:a,deviceJid:g.from,type:"device"}}}),hideDecryptionFailure:!1,isInstamadillo:!1,offline:g.offline,recipient:g.recipient,reportingMeta:g.reportingMeta,retryCount:g.retryCount,ts:g.serverTs}},priority:g.priority,stanzaId:g.stanzaId,stanzaQueueId:a.stanzaQueueId,type:g.type};default:a;return babelHelpers["extends"]({},a)}}var o=9,p=7,q=5,r=2;function f(a){return a}function s(a){return a}function t(a){return a}g.initProtocolQueue=a;g.protocolQueue=k;g.PQFlushable=l;g.pqFlushable=m;g.protocolQueueFlushable=b;g.mapProtocolEntriesV2toV1=e;g.mapProcolQueueMessageV2toV1=n;g.WAProtocolQueuePriorityHigh=o;g.WAProtocolQueuePriorityMid=p;g.WAProtocolQueuePriorityLow=q;g.WAProtocolQueuePriorityBackground=r;g.appdataApplicationProtocol=f;g.extractSubProtocolFromAppdataProtocol=s;g.numberToStanzaQueueId=t}),98);
__d("WASmaxInPreKeysIQErrorItemNotFoundMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","item-not-found");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",404);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorItemNotFoundMixin=a}),98);
__d("WASmaxInPreKeysRequestErrorsFetchDigest",["WAResultOrError","WASmaxInPreKeysIQErrorFallbackClientMixin","WASmaxInPreKeysIQErrorItemNotFoundMixin","WASmaxInPreKeysIQErrorNotAcceptableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysIQErrorNotAcceptableMixin").parseIQErrorNotAcceptableMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAcceptable",value:b.value});var c=d("WASmaxInPreKeysIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:c.value});var e=d("WASmaxInPreKeysIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return e.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorNotAcceptable","IQErrorItemNotFound","IQErrorFallbackClient"],[b,c,e])}g.parseRequestErrorsFetchDigest=a}),98);
__d("WASmaxInPreKeysFetchDigestResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrorsFetchDigest","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysRequestErrorsFetchDigest").parseRequestErrorsFetchDigest(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRequestErrorsFetchDigest:b.value}))}g.parseFetchDigestResponseRequestError=a}),98);
__d("WASmaxInPreKeysFetchDigestResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseFetchDigestResponseServerError=a}),98);
__d("WASmaxInPreKeysKeysHashMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"hash");if(!a.success)return a;a=d("WASmaxParseUtils").contentBytesRange(a.value,20,20);return!a.success?a:d("WAResultOrError").makeResult({hashElementValue:a.value})}g.parseKeysHashMixin=a}),98);
__d("WASmaxInPreKeysPreKeyIDListMixin",["WAResultOrError","WASmaxInPreKeysKeyIDMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"id");if(!b.success)return b;b=d("WASmaxInPreKeysKeyIDMixin").parseKeyIDMixin(a);return!b.success?b:b}function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"list");if(!a.success)return a;a=d("WASmaxParseUtils").mapChildrenWithTag(a.value,"id",0,2e4,h);return!a.success?a:d("WAResultOrError").makeResult({listId:a.value})}g.parsePreKeyIDListListId=h;g.parsePreKeyIDListMixin=a}),98);
__d("WASmaxInPreKeysIdentityDigestBundleMixin",["WAResultOrError","WASmaxInPreKeysIdentityKeyMixin","WASmaxInPreKeysKeyTypeMixin","WASmaxInPreKeysKeysHashMixin","WASmaxInPreKeysPreKeyIDListMixin","WASmaxInPreKeysRegistrationIDMixin","WASmaxInPreKeysSignedPreKeyMixin"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPreKeysRegistrationIDMixin").parseRegistrationIDMixin(a);if(!b.success)return b;var c=d("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(a);if(!c.success)return c;var e=d("WASmaxInPreKeysPreKeyIDListMixin").parsePreKeyIDListMixin(a);if(!e.success)return e;var f=d("WASmaxInPreKeysSignedPreKeyMixin").parseSignedPreKeyMixin(a);if(!f.success)return f;var g=d("WASmaxInPreKeysKeyTypeMixin").parseKeyTypeMixin(a);a=d("WASmaxInPreKeysKeysHashMixin").parseKeysHashMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,c.value,e.value,f.value,{keyTypeMixin:g.success?g.value:null},a.value))}g.parseIdentityDigestBundleMixin=a}),98);
__d("WASmaxInPreKeysFetchDigestResponseSuccess",["WAResultOrError","WASmaxInPreKeysIQResultResponseMixin","WASmaxInPreKeysIdentityDigestBundleMixin","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"digest");if(!c.success)return c;var e=d("WASmaxParseReference").optionalAttrStringFromReference(b,["digest","identity_type"]);if(!e.success)return e;e=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,c.value,"identity_type",e.value);if(!e.success)return e;c=d("WASmaxInPreKeysIdentityDigestBundleMixin").parseIdentityDigestBundleMixin(c.value);if(!c.success)return c;a=d("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({hasDigestIdentityType:e.value!=null,digestIdentityDigestBundleMixin:c.value},a.value))}g.parseFetchDigestResponseSuccess=a}),98);
__d("WASmaxOutPreKeysFetchDigestRequest",["WASmaxJsx","WASmaxOutPreKeysClientRequestMixin"],(function(a,b,c,d,e,f,g){function a(){var a=d("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(d("WASmaxJsx").smax("iq",{type:"get"},d("WASmaxJsx").smax("digest",null)));return a}g.makeFetchDigestRequest=a}),98);
__d("WASmaxPreKeysFetchDigestRPC",["WAComms","WASmaxInPreKeysFetchDigestResponseRequestError","WASmaxInPreKeysFetchDigestResponseServerError","WASmaxInPreKeysFetchDigestResponseSuccess","WASmaxOutPreKeysFetchDigestRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WASmaxOutPreKeysFetchDigestRequest").makeFetchDigestRequest();a=(yield d("WAComms").sendSmaxStanza(b,a));var c=d("WASmaxInPreKeysFetchDigestResponseSuccess").parseFetchDigestResponseSuccess(a,b);if(c.success)return{name:"FetchDigestResponseSuccess",value:c.value};var e=d("WASmaxInPreKeysFetchDigestResponseRequestError").parseFetchDigestResponseRequestError(a,b);if(e.success)return{name:"FetchDigestResponseRequestError",value:e.value};a=d("WASmaxInPreKeysFetchDigestResponseServerError").parseFetchDigestResponseServerError(a,b);if(a.success)return{name:"FetchDigestResponseServerError",value:a.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("FetchDigest",{Success:c,RequestError:e,ServerError:a}))});return h.apply(this,arguments)}g.sendFetchDigestRPC=a}),98);
__d("WARequestPreKeyDigestProtocol",["WABinary","WAConvertRegistrationIdMixin","WAConvertSignedPreKeyMixin","WACryptoDependencies","WACryptoUtils","WAParsableXmlNode","WAResultOrError","WASignalKeys","WASmaxPreKeysFetchDigestRPC","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": ",""]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS(["requestPreKeyDigestProtocol"]);function a(a){return d("WASmaxPreKeysFetchDigestRPC").sendFetchDigestRPC({withoutRetry:!1}).then(function(b){switch(b.name){case"FetchDigestResponseServerError":var c=b.value.errorServerErrors.name;j.ERROR(i(),b.name,c);return d("WAResultOrError").makeError({type:"server-error",payload:c});case"FetchDigestResponseRequestError":c=b.value.errorRequestErrorsFetchDigest.name;j.ERROR(h(),b.name,c);return d("WAResultOrError").makeError({type:"request-error",payload:c});default:b.name;c=k(b.value.digestIdentityDigestBundleMixin);return l(c,a).then(function(a){return a==="ok"?d("WAResultOrError").makeResult():d("WAResultOrError").makeError({type:"compare-error",payload:a})})}})}function k(a){var b=d("WAConvertRegistrationIdMixin").registrationIdMixin(a),c=d("WAConvertSignedPreKeyMixin").convertSignedPreKeyMixin(a),e=a.listId.map(function(a){return d("WASignalKeys").castToPreKeyId(d("WAParsableXmlNode").convertBytesToUint(a.elementValue,3))});a=a.hashElementValue;return{regId:b,skeyId:c.id,preKeyIds:e,hash:a}}function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(a.regId!==b.regInfo.regId)return"RegIdMismatch";if(a.skeyId!==b.signedPreKey.id)return"SignedPreKeyIdMismatch";var c=new Map();b.preKeys.forEach(function(a){return c.set(a.id,a)});var e=a.preKeyIds.some(function(a){return!c.has(a)});if(e)return"UnknownPreKey";e=a.preKeyIds.map(function(a){return c.get(a)}).filter(Boolean);b=(yield n(b,e));return!d("WACryptoUtils").uint8ArraysEqual(b,a.hash)?"HashMismatch":"ok"});return m.apply(this,arguments)}function n(a,b){var c=new(d("WABinary").Binary)();c.writeByteArray(a.regInfo.staticKeyPair.publicKey);c.writeByteArray(a.signedPreKey.keyPair.publicKey);c.writeByteArray(a.signedPreKey.signature);b.forEach(function(a){c.writeByteArray(a.keyPair.publicKey)});return d("WACryptoDependencies").getCrypto().subtle.digest("SHA-1",c.readByteArray()).then(function(a){return new Uint8Array(a)})}g.requestPreKeyDigestProtocol=a}),98);
__d("WARequestPreKeyDigest",["WABridge","WAGenerateAndUploadPreKeys","WAGetKeysForUpload","WAGlobals","WALogger","WAOdsEnums","WARequestPreKeyDigestProtocol","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error while generating and uploading prekeys: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["PreKey digest comparison failed: ",""]);i=function(){return a};return a}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield a(function(a){a=a.cryptoManager;return d("WAGetKeysForUpload").getKeysForUpload(a)}));a=(yield d("WARequestPreKeyDigestProtocol").requestPreKeyDigestProtocol(a.value));if(a.success===!1){d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PREKEY_DIGEST,key:"fail"});if(a.error.type==="compare-error"){d("WALogger").ERROR(i(),a.error.payload);d("WAGenerateAndUploadPreKeys").generateAndUploadPreKeys(null,{reason:"prekey digest comparison failed"})["catch"](function(a){d("WALogger").ERROR(h(),a)});return}throw c("err")("Error while requesting key digest: "+a.error.type+" "+a.error.payload)}a.success;d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PREKEY_DIGEST,key:"success"})});return k.apply(this,arguments)}function a(a){return j(function(a){return d("WAGlobals").getWaOneQueue().enqueue(a,{operationType:"request_prekey_digest",flush:!1})})}g.requestPreKeyDigestFn=j;g.requestPreKeyDigest=a}),98);
__d("WAWaitForUserUnblocked",["WAResolvable","WorkerScheduler"],(function(a,b,c,d,e,f,g){"use strict";f=2*60*1e3;var h=new(d("WAResolvable").Resolvable)(),i=d("WorkerScheduler").makeScheduler("offline-queue",{concurrency:1,maxConcurrency:1,timeToStuckMs:f});function a(){h.resolveWasCalled()&&(h=new(d("WAResolvable").Resolvable)(),j())}function j(){void i.runTask({name:"offline-queue",fn:function(){return h.promise},priority:d("WorkerScheduler").BLOCKING_PRIORITY})}function b(){return h.promise}function c(){h.resolve()}function e(){return!h.resolveWasCalled()}g.maybeResetWaitForUserUnblocked=a;g.markOfflineQueueAsStarted=j;g.waitForUserUnblocked=b;g.unblockUser=c;g.isStillWaitingForUserUnblocked=e}),98);
__d("isInstamadilloEB",["qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("qex")._("670")===!0}g["default"]=a}),98);
__d("isMAWUniversalSearchWithEBEnabled",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("4741")}g["default"]=a}),98);